(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"./app/assets/js/main.js":[function(require,module,exports){
(function (global){
'use strict';

var _ = window._;

global.App = {

    resizer: require('./_resize'),
    ajax: require('./_ajax'),
    debug: require('./_debug'),

    FormControls: require('./_form-controls'),
    typeAheads: require('./_typeaheads'),

    searchbuild: require('./_search'),
    search: {},

    functions: {

        getPage: function($el, iframe) {

            console.log('running globl.App.functions.getPage', $el, iframe);

            var args = {
                type:           $el.attr('data-type'),
                id:             $el.attr('data-id') || $el.parents('form:first').find('input#id').val(),
                action:         $el.attr('data-action'),
                parentID:       $el.attr('data-parent-id'),
                parentType:     $el.attr('data-parent-type'),
                parentTitle:    $el.attr('data-parent-title'),
                input:          $el.parents('.input-group:first').length ? $el.parents('.input-group:first').find('input:first').val() : false
            };

            console.log('attributes', args);

            global.App.ajax.get(

                $.extend(true, args, {

                    success: function(data) {

                        if (iframe) {

                            $('iframe').contents().find('div.content:last').slideUp().after(data);

                        } else {

                            $('div.content:last').slideUp().after(data);

                            var e = jQuery.Event( "ajaxContentAdded", { data: data } );
                            console.log('firing: ajaxContentAdded');
                            $(window).trigger(e);
                            console.log('fired: ajaxContentAdded');
                        }

                    }
                })
            );
        }
    }
};

// ???
//require('./_alerts');


(function($) {

    $(document).ready(function() {

        //global.App.debug.init();

        // create / edit buttons
        $('body').on('click', '.iframe', function(e) {

            console.log('clicked .iframe');
            e.preventDefault();
            var $el = $(this);

            $el.colorbox({
                html: '<div class="content"></div>',
                width:"90%",
                height:"90%",
                fastIframe: false,
                trapFocus: false,

                onComplete: function(a,b,c) {
                    global.App.functions.getPage($el);
                },

                onCleanup: function() {

                    for (var i = global.App.ajax.pages.length - 1; i >= 0; i--) {
                        global.App.ajax.pages[i].close();
                    }

                }
            });

        });

        // delete modals
        $('body').on('click', '.modal-popup', function(e) {

            console.log('clicked .modal-popup');

            e.stopPropagation();
            e.preventDefault();

            var href   = $(this).attr('href') || $(this).attr('data-action');
            var $modal = $('#ajax-modal');

            console.log('clicked .modal-popup');

            $modal.load(href, '', function(){

                $modal.modal();
                $modal.css(
                {
                    'max-width': '50%',
                    'left': function () {
                        return ($(window).width()/2) - ($modal.width()/2);
                    },
                    'top': function() {
                        return ($(window).height()/2) - 90;
                    }
                });

                $modal.find('form').on('submit', function(e) {

                    e.preventDefault();
                    var $form = $(this);

                    $.ajax({
                        method: $form.attr('method'),
                        url: $form.attr('action'),
                        data: $form.serialize(),

                        success:function(data) {

                            console.log("Am I running 2 ?");
                            if (data.success && data.reload === true) {

                                if (global.App.ajax.pages.length) {
                                    global.App.ajax.pages[global.App.ajax.pages.length - 1].refresh();
                                } else if (window.oTable) {
                                    // Reload parent Otable
                                    window.oTable.dataTable().api().ajax.reload(null, false);
                                } else {
                                    location.reload();
                                }

                                $modal.find('button.btn-default').click();

                            } else if (data.error) {
                                alert(data.error);
                            }
                        }
                    });
                });
            });
        });
    });

    // $(window).on('ngModalOpen', function() {

    //     console.log('>>> Open');
    //     $('.modal-dialog').css({
    //         'max-width': '40%',
    //         'top': function() {
    //             var top_offset = ($(window).height()/2) - 210;
    //             console.log(top_offset);
    //             return top_offset;
    //         }
    //     });
    // });

    // dropzone for ajax pages
    $(window).on('ajaxContentAdded', function() {

        if(!$('#venues_image_upload').length)
        {
            console.log('could not find images element');
            return false;
        }

        var form_action = $('#venues_image_upload').attr('action');
        var Dropzone = new window.Dropzone('#venues_image_upload', {
            url: form_action,
            accept: function (file, done) {

                if ((file.type).toLowerCase() !== "image/jpg" &&
                    (file.type).toLowerCase() !== "image/gif" &&
                    (file.type).toLowerCase() !== "image/jpeg" &&
                    (file.type).toLowerCase() !== "image/png")
                {
                   done("Invalid file");
                }
                else {
                    done();
                }
            },
            init: function() {

                this.on("addedfile", function(file) {
                    //console.log("Added file.");
                    global.App.ajax.pages[global.App.ajax.pages.length - 1].refresh();
                });
            }
        });

        // colorbox for displaying images
        $('a.mthumbs').volorbox({
            rel:'mthumb',
            title: function(){
                var caption = $(this).attr('data-caption');
                return caption;
            },
            maxWidth: "90%",
            maxHeight: "90%"
        });
    });

    $(document).ready(function() {

        if (!$('#search-container').length) {
            return false;
        }

        console.log(':|');

        global.App.search.companies = $.extend(true, {}, global.App.searchbuild);
        global.App.search.companies.init({name : 'companies'});

        global.App.search.venues = $.extend(true, {}, global.App.searchbuild);
        global.App.search.venues.init({name : 'venues'});

        global.App.search.contacts = $.extend(true, {}, global.App.searchbuild);
        global.App.search.contacts.init({name : 'contacts'});

        var $typeAheads = $('body').find('input.typeahead.form-control').next('.bootstrap-tagsinput').find('input:first');
        $.each($typeAheads, function() {

            var $input = $(this);
            var $parent = $input.closest('.form-group').find('input.typeahead');

            $input.attr('data-prefetch-url', $parent.attr('data-prefetch-url'));
            $input.attr('data-template-id', $parent.attr('data-template-id'));
            $input.attr('data-role', $parent.attr('data-role'));
            $input.addClass('typeahead');
            $parent.removeClass('typeahead');

            global.App.typeAheads.init($input.parent());
        });
    });

    // resize all the things on resize
    $(window).resize(function() {

        var $modal = $('#ajax-modal');
        $modal.css(
        {
            'max-width': '50%',
            'left': function () {
                return ($(window).width()/2) - ($modal.width()/2);
            },
            'top': function() {
                return ($(window).height()/2) - 90;
            }
        });

        console.log('Valid resize ???', ($(window).height()/2) - 210);
        $('.modal-content').css({
            top: function() {
                return ($(window).height()/2) - 210;
            }
        });

        global.App.resizer.resizeColorBoxes();
    });
    //global.App.resizer.resizeColorBoxes();

})(jQuery);



}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./_ajax":"/var/www/sites/aldadata/app/assets/js/_ajax.js","./_debug":"/var/www/sites/aldadata/app/assets/js/_debug.js","./_form-controls":"/var/www/sites/aldadata/app/assets/js/_form-controls.js","./_resize":"/var/www/sites/aldadata/app/assets/js/_resize.js","./_search":"/var/www/sites/aldadata/app/assets/js/_search.js","./_typeaheads":"/var/www/sites/aldadata/app/assets/js/_typeaheads.js"}],"/var/www/sites/aldadata/app/assets/js/_ajax.js":[function(require,module,exports){
(function (global){
'use strict';

$.fn.serializeObject = function()
{
    var o = {};
    var a = this.serializeArray();

    $.each(a, function() {

        if (o[this.name] !== undefined) {

            if (!o[this.name].push) {
                o[this.name] = [o[this.name]];
            }
            o[this.name].push(this.value || '');

        } else {
            o[this.name] = this.value || '';
        }
    });

    return o;
};

var AjaxPage = function(ajax, options) {

    $.extend(true, this, options);

    this.ajax  = ajax;
    this.child = undefined;

    this.typeaheads = require('./_typeaheads');
    this.formcontrols = require('./_form-controls');
    this.init();

    return this;
};

AjaxPage.prototype = {

    init: function() {

        var self = this;

        self.$form = self.$el.find('form');

        self.setTitle();
        self.hookEvents();
        self.toggleAddOtherModels();
        self.toggleCloseButtons();

        // init self controls
        self.formcontrols.initFormControls(self.$el);
        self.typeaheads.init(self.$el);

         console.log('AjaxPage init', self);
    },

    hookEvents: function() {

        var self = this;

        // Find form and disable default action (otherwise whole iframe is reloaded)
        self.$form.one('submit', function(e) {
            e.stopPropagation();
            e.preventDefault();
            self.submit();
        });

        // close
        self.$el.find('button.close-ajax-page').one('click', function(e) {

            //console.log('closing page');
            e.preventDefault();
            var $button = $(this);

            $.each(self.ajax.pages, function(index, page) {

                if (page.$el.find('button.close-ajax-page')[0] === $button[0]) {
                    if (index === self.ajax.pages.length - 1) {
                        // dit is de laatste pagina
                        page.close();
                    } else {
                        console.log('page length', self.ajax.pages.length);
                        alert('Sluit eerst de onderliggende pagina\'s');
                    }
                }
            });
        });
    },

    setTitle: function() {

        var self = this;
        var $title = self.$el.find('.page-header h3');
        $title.html($title.html() + ' <small>(to ' + self.parentTitle + ')</small>');
    },

    toggleAddOtherModels: function() {

        var self = this;
        if (self.modelID === 0) { // this is a new model, we are not in editing mode
            self.$el.find('.related-models-container').remove();
        }
    },

    toggleCloseButtons: function() {

        var self = this;
        var $closeButtons = $('body').add(self.$el).find('button.close_popup, button.close-ajax-page');

        $closeButtons.attr('disabled', 'disabled');
        $closeButtons.filter(':last').removeAttr('disabled');
    },

    close: function() {

        var self = this;

        console.log('AjaxPage Close');

        // find if current page is the top page
        // if not find the previous page to slideDown
        var $previousPage = false;
        var isTopPage     = false;

        if (self.ajax.pages.length > 1) {
            $previousPage = self.ajax.pages[self.ajax.pages.length - 2].$el.find('.content');
        } else {
            $previousPage = $('.content:first');
            isTopPage     = true;
        }

        // it's not the top page
        if (!isTopPage) {

            self.ajax.pages[self.ajax.pages.length - 2].refresh();
            self.$el.slideUp(function() {

                $(this).remove();
                self.$el.empty();
            });

            $previousPage.slideDown();

        // it is so we reload the datatable
        } else {

            if (typeof window.oTable !== 'undefined') {
                window.oTable.dataTable().api().ajax.reload(null, false);
            }

            // Close colorbox
            //self.ajax.pages.pop();
            $.colorbox.close();
        }

        // pop last page
        self.ajax.pages.pop();

        // self-destroy
        self = undefined;
    },

    submit: function() {

        var self = this;

        $('.backdrop').css('display', 'block');

        var post_data = {},
        tmp_form_data      = self.$form.serializeObject();
        var num_ajax_pages = self.ajax.pages.length;

        if(num_ajax_pages > 0 && self.ajax.pages[num_ajax_pages - 1].hasOwnProperty('parentID'))
        {
            $.extend(true, post_data, {
                    parent_model: self.ajax.pages[num_ajax_pages - 1].parentType,
                    parent_id: self.ajax.pages[num_ajax_pages - 1].parentID,
                    child_model: self.ajax.pages[num_ajax_pages - 1].modelType,
                    child_id: self.ajax.pages[num_ajax_pages - 1].modelID
            });
        }

        $.extend(true, post_data, tmp_form_data);
        console.log('AjaxPage Submit', post_data, tmp_form_data);

        self.ajax.post({
            data:       post_data,
            page:       self,

            success: function(html) {

                console.log('pages', global.App.ajax.pages, html);

                self.$el.empty();
                self.url     = $(html).attr('data-url');
                self.modelID = $(html).attr('data-id');
                self.$el.html($(html).contents());
                self.init();

                window.oTable.api().ajax.reload(null, false);

                console.log("Am I running ?");
                $('.backdrop').css('display', 'none');
            }
        });
    },

    refresh: function() {

        var self = this;

        console.log('AjaxPage Refresh');

        $.ajax({
            method: 'GET',
            url: self.url,
            success: function(html) {

                self.$el.empty();
                self.$el.html($(html).contents());
                self.init();

                var e = jQuery.Event( "ajaxContentAdded", { data: html } );
                $(window).trigger(e);
            }
        });
    }
};

var Ajax = function(options) {

    var defaults = {
        method: 'GET',
        data: {
        }
    };

    this.defaults         = $.extend(true, {}, defaults, options);
    this.pages            = [];
    this.currentPageIndex = undefined;
};

Ajax.prototype = {

    post: function(options) {

        var url = options.page.url;
        console.log('Ajax post', url, options);

        $.ajax({
            url: url,
            method: 'POST',
            data: options.data,

            success:function(data, textStatus, jqXHR) {

                if (options.success && typeof options.success === 'function') {
                    options.success(data);
                    console.log('Ajax post response', data);
                }
            }
        });
    },

    get: function(options) {

        var self = this;
        $.extend(true, options, self.defaults, options);
        var url = '/';

        if(options.type === 'tickettypes') {

            console.log('ticketype', options);
            switch (options.action) {
                case 'edit':
                    url += options.parentType.toLowerCase() + '/' + options.parentID + '/' + options.type + '/' + options.id + '/' + options.action;
                    break;
                case 'create':
                    url += options.parentType.toLowerCase() + '/' + options.parentID + '/' + options.type + '/' + options.action;
                    break;
            }

        } else {

            switch (options.action) {
                case 'edit':
                    url += options.type + '/' + options.id + '/' + options.action;
                    break;
                case 'create':
                    url += options.type + '/' + options.action;
                    break;
            }
        }

        if (options.parentID) {
            options.data.parentID = options.parentID;
        }

        console.log('Ajax get', url);

        $.ajax({
            url: url,
            method: options.method,
            data: options.data,

            success:function(data, textStatus, jqXHR) {

                var page = new AjaxPage(self, {
                    $el:            $(data),
                    url:            url,
                    modelID:        options.id || 0,
                    modelType:      options.type,
                    parentID:       options.parentID,
                    parentType:     options.parentType,
                    parentTitle:    options.parentTitle
                });

                console.log('Ajax got page :)', page);

                // set parent id on form
                var $parentField = page.$el.find('form input[name=' + [page.parentType] + '_id]');
                if ($parentField.length && !$parentField.val()) {
                    $parentField.val(page.parentID);
                }

                // inline summary buttons
                page.$el.on('click', '.ajax', function(e) {

                    e.preventDefault();
                    e.stopPropagation();

                    console.log('clicked .ajax');
                    global.App.functions.getPage($(this));
                });

                // These guys still have to go in a treelike structure (or not)
                self.pages.push(page);
                if (options.success && typeof options.success === 'function') {
                    options.success(page.$el);
                }
            }
        });
    }
};

module.exports = new Ajax();



}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./_form-controls":"/var/www/sites/aldadata/app/assets/js/_form-controls.js","./_typeaheads":"/var/www/sites/aldadata/app/assets/js/_typeaheads.js"}],"/var/www/sites/aldadata/app/assets/js/_debug.js":[function(require,module,exports){
(function (global){
'use strict';

var Debugger = function() {
	var self = this;
};

Debugger.prototype = {

	init: function() {

		var self = this;
		self.createPanel();
		var $button = $('<button type="button">').text('Click me');

		$button.on('click', function() {
			console.log(global.App.ajax.pages);
		});

		$button.appendTo(self.$panel);
	},

	createPanel: function() {

		var self = this;

		var $panel = $('<div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title">Debug</h3></div><div class="panel-body"></div></div>');
		var $panelContainer = $('<div>').css({
			position: 'absolute',
			width: 300,
			height: 400,
			bottom: 10,
			right: 10,
			"z-index": 9999
		});

		$panel.appendTo($panelContainer.appendTo($('body')));
		self.$panel = $panel.find('.panel-body');

		console.log('created panel ???');
	},

	showParentAjaxPageIDsInHeaders: function(ajaxPage) {

		var self = this;
		if (!global.App.ajax.pages.length) {
			return false;
		}

		$.each(global.App.ajax.pages, function() {
			var $html = this.$el;
			var debugString = 'id: ';
			debugString += ajaxPage.id || '';
			debugString += ', modelType: ';
			debugString += ajaxPage.modelType || '';
			debugString += ', parentID: ';
			debugString += ajaxPage.parentID || '';
			debugString += ', parentType: ';
			debugString += ajaxPage.parentType || '';
			debugString += ', parentTitle: ';
			debugString += ajaxPage.parentTitle || '';
			var $title = $html.find('.page-header h3');
			$title.html($title.html() + ' <small>' + debugString + '</small>');
			console.log('debugString', debugString);

		});
	}
};

module.exports = new Debugger();
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}],"/var/www/sites/aldadata/app/assets/js/_entity-details.js":[function(require,module,exports){
'use strict';

var EntityDetails = function() {

    this.models = {
        'company':      'companies',
        'venue':        'venues',
        'contact':      'contacts'
    };

};

EntityDetails.prototype = {

    get: function(args) {

        var self = this;

        if (!args) {
            throw 'No arguments given';
        }
        if (!args.type) {
            throw 'Entity type not set';
        }
        if (!args.id) {
            throw 'Entity ID not set';
        }

        var url = '/' + args.type + '/' + args.id + '/details';

        $.ajax({
            url: url,
            method: 'GET',
            type: 'html',
            success: function(data, status) {
                $('#search_' + args.type).find('.details').html(data);
            }
        });
    }
};

module.exports = new EntityDetails();

},{}],"/var/www/sites/aldadata/app/assets/js/_form-controls.js":[function(require,module,exports){
'use strict';

var FormControls = function() {

};

FormControls.prototype = {

    initFormControls: function($el) {

        var self = this;

        if (!$el) {
            $el = $('body');
        }

        $.datepicker.setDefaults({
            //showOn: "both",
            buttonImageOnly: true,
            formatDate: "yy-mm-dd"
            //buttonImage: "calendar.gif",
            //buttonText: "Calendar"

        });

        self.initDataSliders($el);
        self.initInputGroups($el);
        self.initDatePickers($el);
        self.initTimePickers($el);
        self.initKeyboardShortcuts($el);
    },

    initKeyboardShortcuts: function($el) {

        // On cursor down and up key, go to next or previous legend
        $el.find('.col-sm-7 input[type="text"]').on('keyup', function(e) {

            var $legends           = $el.find('.col-sm-7 legend'); // all legends in left column
            var $currentLegend     = $(this).parents('.form-group:first').prevAll().filter('legend:first');
            var currentLegendIndex = $legends.filter($currentLegend).index('legend');
            var legendCount        = $legends.length;

            if (e.keyCode === 40) { // DOWN key
                if (currentLegendIndex < legendCount - 1) {
                    $legends.eq(currentLegendIndex + 1).nextAll('.form-group:first').find('.form-control:first').focus();
                }
            }

            if (e.keyCode === 38) { // UP key
                if (currentLegendIndex > 0) {
                    $legends.eq(currentLegendIndex - 1).nextAll('.form-group:first').find('.form-control:first').focus();
                }
            }
        });
    },

    initTimePickers: function($el) {

        $el.find('input[time-picker]').each(function(ndx, val) {

            var $input = $(this);
            $input.timepicker({
                controlType: 'select',
                timeFormat: 'HH:mm',
                stepMinute: 5
            });
        });
    },

    initDatePickers: function($el) {

        $el.find('input[date-picker]').each(function(ndx, val) {

            var $input = $(this);
            var options = {dateFormat: 'yy-mm-dd'};

            $input.datepicker(options);
        });

    },

    initInputGroups: function($el) {

        $el.find('[input-group]').each(function() {

            var $input = $(this);
            var $inputGroup = $('<div>').addClass('input-group');
            var $addon = $('<span>').addClass('input-group-addon').html($input.attr('input-group-label'));

            $input.wrap($inputGroup);
            $input.after($addon);
        });
    },

    initDataSliders: function($el) {

        $el.find('input[data-slider=true]').each(function() {

            var $input = $(this);
            var $slider = $('<div>');
            $input.after($slider);

            var min = parseInt($input.attr('data-slider-min'), 10) || 0;
            var max = parseInt($input.attr('data-slider-max'), 10) || 100;
            var step = parseInt($input.attr('data-slider-step')) || 1;
            var forceStepOnInput = $input.attr('data-slider-force-input-step') ? true : false;
            var value = parseInt($input.val()) || min;

            $slider.slider({
                value: value,
                min: min,
                max: max,
                step: step,
                slide: function( event, ui ) {
                    $input.val(ui.value);
                }
            });

            var calculateCorrectValue = function(value, forceStep) {

                if (value > max) {
                    value = max;
                }
                if (value < min) {
                    value = min;
                }

                if (forceStep) {
                    if (value > 0) {
                        value = Math.ceil(value / step) * step;
                    }
                    if (value < 0) {
                        value = Math.floor(value / step) * step;
                    }
                }

                return value;
            };

            var setValues = function() {
                var value = $input.val();
                $input.val(calculateCorrectValue(value, forceStepOnInput));
                $slider.slider({
                    value: calculateCorrectValue(value, true)
                });
            };

            setValues();

            $input.on('change', function() {
                setValues();
            });
        });
    }

};

module.exports = new FormControls();

},{}],"/var/www/sites/aldadata/app/assets/js/_resize.js":[function(require,module,exports){
'use strict';

var Resizer = function() {
};

Resizer.prototype = {

    resizeColorBoxes: function() {
        if ($('#colorbox').length) {
            $.colorbox.resize({width:"90%", height:"90%"});
        }
    }
};

module.exports = new Resizer();

},{}],"/var/www/sites/aldadata/app/assets/js/_search.js":[function(require,module,exports){
'use strict';

var SearchModule = function() {

    this.name       = '';
    this.$table     = {};
    this.res        = {};
    this.dt         = {};
    this.dt_columns = [];

    this.typeaheads = undefined;
};

SearchModule.prototype = {

    init: function(options) {

        var self = this;

        self.name       = options.name;
        self.$table     = $('#search_'+options.name+'_table');
        self.res        = {};
        self.dt         = {};
        self.dt_columns = [];

        self.initData()
            .initColumns()
            .initTable()
            .initDetails()
            .initClickListener()
            .initKBListener();
    },

    initColumns: function() {

        var self = this;

        $('#search_'+self.name+'_table th').each(function(ndx) {
            self.dt_columns.push({data: $(this).attr('data-column')});
        });

        console.log('self.dt_columns', self.dt_columns);

        return self;
    },
    initData: function() {

        var self = this;

        self.res.data = JSON.parse($('#dt_'+self.name+'_init').text()).data;
        console.log('self.res.data', '#dt_'+self.name+'_init', self.res.data, $('#dt_'+self.name+'_init').text());

        return self;
    },
    initTable: function() {

        var self = this;

        console.log(self.name);
        self.dt = $('#search_'+self.name+'_table').dataTable({
            "dom": "<'row'<'col-md-6'<'row'<'col-xs-6'l><'col-xs-6 text-right'r>>><'col-md-6'f>>t<'row'<'col-md-6'i><'col-md-6'p>>",
            "pageLength": 5,
            "order": [[ 0, "desc" ]],
            "columns": self.dt_columns,
            "data": JSON.parse($('#dt_'+self.name+'_init').text()).data,
            "lengthChange": false,
            "searching": false,
            "tableTools": {
                "sRowSelect": "single",
                "aButtons": [
                ]
            }
        });

        return self;
    },
    initDetails: function() {

        var self = this;

        var $el = $('#search_' + self.name + '_table tbody tr:first');
        if($el.length) {

            var entity_id = $('#search_' + self.name + '_table tbody tr:first').attr('id');
            var entity_details = require('./_entity-details');
            entity_details.get({
                type: self.name,
                id: entity_id
            });
        }




        return self;
    },
    initClickListener: function() {

        var self = this,

        selector = '#search_' + self.name + '_table tbody tr';

        $('body').on('click', selector, function() {

            var $row = $(this);

            var entity_details = require('./_entity-details');
            entity_details.get({
                type: self.name,
                id: $row.attr('id')
            });
            $(selector).not($row).removeClass('selected');
            $row.toggleClass('selected');
        });

        return self;
    },
    initKBListener: function () {

        var self = this;
        var name = self.name;

        // typeaheads input
        $('body').on('focusout', '.tt-input', function(event) {

            $(this).hide();
            $(this).parent('span').find('.tt-hint').hide();
            event.stopPropagation();
        });

        // tags input
        $('body').on('click', '.bootstrap-tagsinput', function(event) {

            var $sel_input = $(this).find('.tt-input');
            var $sel_hint = $(this).find('.tt-hint');

            $sel_input.val('').show().focus();
            $sel_hint.show();

            event.stopPropagation();
        });

        // Main KB event pump
        $('body').on('keyup', '#search_' + name + ' input', function() {

            var req_data = {};
            $('#search_' + name + '_table thead tr th').each(function(ndx){

                var curr_property = $(this).attr('data-column');
                req_data[curr_property] = $('#'+self.name+'_'+curr_property).val();
                console.log(curr_property, req_data[curr_property]);
            });

            // extend request params
            switch(name) {
                case 'companies':
                    req_data = $.extend('true', req_data,
                        {
                            references: $('#companies_references').val()
                        });

                    break;
                case 'venues':
                    req_data = $.extend('true', req_data,
                        {
                            min_capacity: $('#venues_min_capacity').val(),
                            max_capacity: $('#venues_max_capacity').val(),
                            min_rig_capacity: $('#venues_min_rig_capacity').val()
                        });

                    break;
                default:
                    break;
            }

            // post query
            $.ajax({
                type: "POST",
                url: "/search_"+self.name+"_data",
                async: true,
                dataType: 'json',
                data: req_data,
                success: function(data, textStatus, jqXHR) {

                    self.dt.fnClearTable();
                    if (data.data && data.data.length) {
                        console.log('ajax search data', data.data);
                        self.dt.fnAddData(data.data);
                    }

                    if($('#search_' + name + '_table tbody tr:selected').length === 0)
                    {
                        $('.details').empty();
                    }
                },

                error: function(qXHR, textStatus, errorThrown) {
                    console.log(qXHR, textStatus, errorThrown);
                }
            });
        });

        return self;
    }
};

module.exports = new SearchModule();


},{"./_entity-details":"/var/www/sites/aldadata/app/assets/js/_entity-details.js"}],"/var/www/sites/aldadata/app/assets/js/_typeaheads.js":[function(require,module,exports){
(function (global){
'use strict';

var TypeAheads = function() {

};

TypeAheads.prototype = {

    init: function($el) {

        var _ = window._;
        var Bloodhound = window.Bloodhound;

        if (!$el) {
            $el = $('body');
        }

        $el.find('input.typeahead').not('.initialized').each(function() {

            var $input              = $(this);
            var $addNewButton       = $input.parents('.input-group:first').find('.input-group-btn button');
            var murl                = '/api/v1' + $input.attr('data-prefetch-url');
            var attachBaseUrl       = $input.attr('data-attach-url');
            var $suggestionTemplate = $el.find('#' + $input.attr('data-template-id')).html() || '<%= datum.value %>';
            var suggestionTemplate  = _.template($suggestionTemplate);

            console.log('suggestion template', $suggestionTemplate);

            // This is used for the search pages, combining the type-ahead features with the tag input stuff. Instead of
            // attaching this model to the parent model via attachBaseUrl
            var tagInput = ($input.attr('data-role') === 'tagsinput' ? true : false);
            console.log('is tagInput: ', $input.attr('data-role'), tagInput);

            // Disable addNewButton, it will be enabled at on change event, when there are at least 3 characters
            if ($addNewButton) {
                $addNewButton.attr('disabled', 'disabled');
            }

            // Prevent inputs from initializing multiple times
            $input.addClass('initialized');

            // Construct Bloodhound suggestion engine, we don't use the prefetch featured
            var bloodhound = new Bloodhound(
            {
                datumTokenizer: function(d) {
                    return Bloodhound.tokenizers.whitespace(d.value);
                },
                queryTokenizer: function(query) {
                    return Bloodhound.tokenizers.whitespace(query);
                },
                dupDetector: function(remoteMatch, localMatch) {
                    return remoteMatch.id === localMatch.id;
                },

                limit: 10,
                remote: {
                    url: murl + '?q=%QUERY',
                    wildcard: '%QUERY'
                }
            });

            //bloodhound.clearPrefetchCache(); bloodhound.clearRemoteCache();
            bloodhound.initialize();
            //bloodhound.clearPrefetchCache(); bloodhound.clearRemoteCache();

            //console.log('ta Bloodhound', bloodhound.ttAdapter());

            // Construct the Twitter Typeahead itself
            $input.typeahead(
            {
                hint: true,
                highlight: true,

            },
            {
                limit: 10,
                source: bloodhound.ttAdapter(),
                restrictInputToDatum: true,
                templates: {
                    header: function(datum) {
                        return '<div class="list-group typeahead-results-container">';
                    },
                    footer: function(datum) {
                        return '</div>';
                    },
                    suggestion: function(datum) {
                        var $link = $('<a href="#" class="list-group-item" data-id="' + datum.id + '">' + suggestionTemplate({datum : datum}) + '</a>');

                        // Add typeahead to begin of DOM to be able to do styling
                        // (cannot inspect elements, because the focus out clears the elements)
                        if (0) {
                            $link.on('click', function(e) {
                                e.preventDefault();
                                e.stopPropagation();
                                $(this).parent().parent().parent().parent().parent().clone().prependTo('body');
                                return true;
                            });
                        }

                        console.log('$link', $link, datum);

                        return $link;
                    }
                }
            })

            // When using the keyboard to walk through the suggestions, add bootstrap classes for visual enhancements
            .on('typeahead:cursorchanged', function(event, suggestion, dataset) {

                console.log('typeahead:cursorchanged', $(this), event, suggestion, dataset);

                if(suggestion) {
                    $(this).val(suggestion.value);
                }

                $('.tt-suggestion a').removeClass('active');
                $('.tt-suggestion.tt-cursor a').addClass('active');

            })

            // When an item is selected from the list
            .on('typeahead:selected', function(event, suggestion, dataset) {

                // attach this item to the parent item
                if (attachBaseUrl) {

                    var attachUrl = attachBaseUrl + '/' + suggestion.id + '/attach';

                    $.ajax({
                        url: attachUrl,
                        method: 'POST',

                        success: function(data) {

                            if (data.success) {
                                // reset input fields
                                $('.typeahead').typeahead('val', '');
                                console.log('typeahead:selected related model attached :)', data);

                            } else if (data.error) {
                                alert(data.error);
                            }

                            if (data.reload && global.App.ajax.pages.length) {
                                global.App.ajax.pages[global.App.ajax.pages.length - 1].refresh();
                            }

                        }
                    });

                }

                // search countries
                else if (tagInput) {

                    console.log(suggestion);

                    var $sel = $(this).closest('.form-group').find('input.form-control:first');
                    $('.typeahead').typeahead('val', '');
                    $sel.tagsinput('add', suggestion.value);

                    return false;
                }

            })

            // Enable addNewButton if at least 3 characters are present in the input box
            .on('keyup', function() {

                if ($addNewButton) {

                    if ($(this).val().length > 2) {
                        $addNewButton.removeAttr('disabled');
                    } else {
                        $addNewButton.attr('disabled', 'disabled');
                    }

                }
            });

            // Add classes for styling purposes
            var $target_el = $input.parent('.twitter-typeahead').addClass('row-fluid block').find('.tt-menu');
            $target_el.css({display: 'block'});

            console.log('tagsinput $target_el', $target_el.length, $target_el);
        });
    }
};

module.exports = new TypeAheads();

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}]},{},["./app/assets/js/main.js"])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJhcHAvYXNzZXRzL2pzL21haW4uanMiLCJhcHAvYXNzZXRzL2pzL19hamF4LmpzIiwiYXBwL2Fzc2V0cy9qcy9fZGVidWcuanMiLCJhcHAvYXNzZXRzL2pzL19lbnRpdHktZGV0YWlscy5qcyIsImFwcC9hc3NldHMvanMvX2Zvcm0tY29udHJvbHMuanMiLCJhcHAvYXNzZXRzL2pzL19yZXNpemUuanMiLCJhcHAvYXNzZXRzL2pzL19zZWFyY2guanMiLCJhcHAvYXNzZXRzL2pzL190eXBlYWhlYWRzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUM1UkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzlWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUNwRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDaE5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxudmFyIF8gPSB3aW5kb3cuXztcclxuXHJcbmdsb2JhbC5BcHAgPSB7XHJcblxyXG4gICAgcmVzaXplcjogcmVxdWlyZSgnLi9fcmVzaXplJyksXHJcbiAgICBhamF4OiByZXF1aXJlKCcuL19hamF4JyksXHJcbiAgICBkZWJ1ZzogcmVxdWlyZSgnLi9fZGVidWcnKSxcclxuXHJcbiAgICBGb3JtQ29udHJvbHM6IHJlcXVpcmUoJy4vX2Zvcm0tY29udHJvbHMnKSxcclxuICAgIHR5cGVBaGVhZHM6IHJlcXVpcmUoJy4vX3R5cGVhaGVhZHMnKSxcclxuXHJcbiAgICBzZWFyY2hidWlsZDogcmVxdWlyZSgnLi9fc2VhcmNoJyksXHJcbiAgICBzZWFyY2g6IHt9LFxyXG5cclxuICAgIGZ1bmN0aW9uczoge1xyXG5cclxuICAgICAgICBnZXRQYWdlOiBmdW5jdGlvbigkZWwsIGlmcmFtZSkge1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ3J1bm5pbmcgZ2xvYmwuQXBwLmZ1bmN0aW9ucy5nZXRQYWdlJywgJGVsLCBpZnJhbWUpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGFyZ3MgPSB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiAgICAgICAgICAgJGVsLmF0dHIoJ2RhdGEtdHlwZScpLFxyXG4gICAgICAgICAgICAgICAgaWQ6ICAgICAgICAgICAgICRlbC5hdHRyKCdkYXRhLWlkJykgfHwgJGVsLnBhcmVudHMoJ2Zvcm06Zmlyc3QnKS5maW5kKCdpbnB1dCNpZCcpLnZhbCgpLFxyXG4gICAgICAgICAgICAgICAgYWN0aW9uOiAgICAgICAgICRlbC5hdHRyKCdkYXRhLWFjdGlvbicpLFxyXG4gICAgICAgICAgICAgICAgcGFyZW50SUQ6ICAgICAgICRlbC5hdHRyKCdkYXRhLXBhcmVudC1pZCcpLFxyXG4gICAgICAgICAgICAgICAgcGFyZW50VHlwZTogICAgICRlbC5hdHRyKCdkYXRhLXBhcmVudC10eXBlJyksXHJcbiAgICAgICAgICAgICAgICBwYXJlbnRUaXRsZTogICAgJGVsLmF0dHIoJ2RhdGEtcGFyZW50LXRpdGxlJyksXHJcbiAgICAgICAgICAgICAgICBpbnB1dDogICAgICAgICAgJGVsLnBhcmVudHMoJy5pbnB1dC1ncm91cDpmaXJzdCcpLmxlbmd0aCA/ICRlbC5wYXJlbnRzKCcuaW5wdXQtZ3JvdXA6Zmlyc3QnKS5maW5kKCdpbnB1dDpmaXJzdCcpLnZhbCgpIDogZmFsc2VcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhdHRyaWJ1dGVzJywgYXJncyk7XHJcblxyXG4gICAgICAgICAgICBnbG9iYWwuQXBwLmFqYXguZ2V0KFxyXG5cclxuICAgICAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIGFyZ3MsIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlmcmFtZSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJ2lmcmFtZScpLmNvbnRlbnRzKCkuZmluZCgnZGl2LmNvbnRlbnQ6bGFzdCcpLnNsaWRlVXAoKS5hZnRlcihkYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnZGl2LmNvbnRlbnQ6bGFzdCcpLnNsaWRlVXAoKS5hZnRlcihkYXRhKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZSA9IGpRdWVyeS5FdmVudCggXCJhamF4Q29udGVudEFkZGVkXCIsIHsgZGF0YTogZGF0YSB9ICk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZmlyaW5nOiBhamF4Q29udGVudEFkZGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHdpbmRvdykudHJpZ2dlcihlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdmaXJlZDogYWpheENvbnRlbnRBZGRlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gPz8/XHJcbi8vcmVxdWlyZSgnLi9fYWxlcnRzJyk7XHJcblxyXG5cclxuKGZ1bmN0aW9uKCQpIHtcclxuXHJcbiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgLy9nbG9iYWwuQXBwLmRlYnVnLmluaXQoKTtcclxuXHJcbiAgICAgICAgLy8gY3JlYXRlIC8gZWRpdCBidXR0b25zXHJcbiAgICAgICAgJCgnYm9keScpLm9uKCdjbGljaycsICcuaWZyYW1lJywgZnVuY3Rpb24oZSkge1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2NsaWNrZWQgLmlmcmFtZScpO1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIHZhciAkZWwgPSAkKHRoaXMpO1xyXG5cclxuICAgICAgICAgICAgJGVsLmNvbG9yYm94KHtcclxuICAgICAgICAgICAgICAgIGh0bWw6ICc8ZGl2IGNsYXNzPVwiY29udGVudFwiPjwvZGl2PicsXHJcbiAgICAgICAgICAgICAgICB3aWR0aDpcIjkwJVwiLFxyXG4gICAgICAgICAgICAgICAgaGVpZ2h0OlwiOTAlXCIsXHJcbiAgICAgICAgICAgICAgICBmYXN0SWZyYW1lOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIHRyYXBGb2N1czogZmFsc2UsXHJcblxyXG4gICAgICAgICAgICAgICAgb25Db21wbGV0ZTogZnVuY3Rpb24oYSxiLGMpIHtcclxuICAgICAgICAgICAgICAgICAgICBnbG9iYWwuQXBwLmZ1bmN0aW9ucy5nZXRQYWdlKCRlbCk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG5cclxuICAgICAgICAgICAgICAgIG9uQ2xlYW51cDogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBnbG9iYWwuQXBwLmFqYXgucGFnZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsLkFwcC5hamF4LnBhZ2VzW2ldLmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBkZWxldGUgbW9kYWxzXHJcbiAgICAgICAgJCgnYm9keScpLm9uKCdjbGljaycsICcubW9kYWwtcG9wdXAnLCBmdW5jdGlvbihlKSB7XHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnY2xpY2tlZCAubW9kYWwtcG9wdXAnKTtcclxuXHJcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgICAgIHZhciBocmVmICAgPSAkKHRoaXMpLmF0dHIoJ2hyZWYnKSB8fCAkKHRoaXMpLmF0dHIoJ2RhdGEtYWN0aW9uJyk7XHJcbiAgICAgICAgICAgIHZhciAkbW9kYWwgPSAkKCcjYWpheC1tb2RhbCcpO1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2NsaWNrZWQgLm1vZGFsLXBvcHVwJyk7XHJcblxyXG4gICAgICAgICAgICAkbW9kYWwubG9hZChocmVmLCAnJywgZnVuY3Rpb24oKXtcclxuXHJcbiAgICAgICAgICAgICAgICAkbW9kYWwubW9kYWwoKTtcclxuICAgICAgICAgICAgICAgICRtb2RhbC5jc3MoXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ21heC13aWR0aCc6ICc1MCUnLFxyXG4gICAgICAgICAgICAgICAgICAgICdsZWZ0JzogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCQod2luZG93KS53aWR0aCgpLzIpIC0gKCRtb2RhbC53aWR0aCgpLzIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgJ3RvcCc6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKCQod2luZG93KS5oZWlnaHQoKS8yKSAtIDkwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICRtb2RhbC5maW5kKCdmb3JtJykub24oJ3N1Ym1pdCcsIGZ1bmN0aW9uKGUpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciAkZm9ybSA9ICQodGhpcyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJGZvcm0uYXR0cignbWV0aG9kJyksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogJGZvcm0uYXR0cignYWN0aW9uJyksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6ICRmb3JtLnNlcmlhbGl6ZSgpLFxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczpmdW5jdGlvbihkYXRhKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJBbSBJIHJ1bm5pbmcgMiA/XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuc3VjY2VzcyAmJiBkYXRhLnJlbG9hZCA9PT0gdHJ1ZSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2xvYmFsLkFwcC5hamF4LnBhZ2VzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWwuQXBwLmFqYXgucGFnZXNbZ2xvYmFsLkFwcC5hamF4LnBhZ2VzLmxlbmd0aCAtIDFdLnJlZnJlc2goKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHdpbmRvdy5vVGFibGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVsb2FkIHBhcmVudCBPdGFibGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93Lm9UYWJsZS5kYXRhVGFibGUoKS5hcGkoKS5hamF4LnJlbG9hZChudWxsLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkbW9kYWwuZmluZCgnYnV0dG9uLmJ0bi1kZWZhdWx0JykuY2xpY2soKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEuZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydChkYXRhLmVycm9yKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gJCh3aW5kb3cpLm9uKCduZ01vZGFsT3BlbicsIGZ1bmN0aW9uKCkge1xyXG5cclxuICAgIC8vICAgICBjb25zb2xlLmxvZygnPj4+IE9wZW4nKTtcclxuICAgIC8vICAgICAkKCcubW9kYWwtZGlhbG9nJykuY3NzKHtcclxuICAgIC8vICAgICAgICAgJ21heC13aWR0aCc6ICc0MCUnLFxyXG4gICAgLy8gICAgICAgICAndG9wJzogZnVuY3Rpb24oKSB7XHJcbiAgICAvLyAgICAgICAgICAgICB2YXIgdG9wX29mZnNldCA9ICgkKHdpbmRvdykuaGVpZ2h0KCkvMikgLSAyMTA7XHJcbiAgICAvLyAgICAgICAgICAgICBjb25zb2xlLmxvZyh0b3Bfb2Zmc2V0KTtcclxuICAgIC8vICAgICAgICAgICAgIHJldHVybiB0b3Bfb2Zmc2V0O1xyXG4gICAgLy8gICAgICAgICB9XHJcbiAgICAvLyAgICAgfSk7XHJcbiAgICAvLyB9KTtcclxuXHJcbiAgICAvLyBkcm9wem9uZSBmb3IgYWpheCBwYWdlc1xyXG4gICAgJCh3aW5kb3cpLm9uKCdhamF4Q29udGVudEFkZGVkJywgZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgIGlmKCEkKCcjdmVudWVzX2ltYWdlX3VwbG9hZCcpLmxlbmd0aClcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjb3VsZCBub3QgZmluZCBpbWFnZXMgZWxlbWVudCcpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgZm9ybV9hY3Rpb24gPSAkKCcjdmVudWVzX2ltYWdlX3VwbG9hZCcpLmF0dHIoJ2FjdGlvbicpO1xyXG4gICAgICAgIHZhciBEcm9wem9uZSA9IG5ldyB3aW5kb3cuRHJvcHpvbmUoJyN2ZW51ZXNfaW1hZ2VfdXBsb2FkJywge1xyXG4gICAgICAgICAgICB1cmw6IGZvcm1fYWN0aW9uLFxyXG4gICAgICAgICAgICBhY2NlcHQ6IGZ1bmN0aW9uIChmaWxlLCBkb25lKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKChmaWxlLnR5cGUpLnRvTG93ZXJDYXNlKCkgIT09IFwiaW1hZ2UvanBnXCIgJiZcclxuICAgICAgICAgICAgICAgICAgICAoZmlsZS50eXBlKS50b0xvd2VyQ2FzZSgpICE9PSBcImltYWdlL2dpZlwiICYmXHJcbiAgICAgICAgICAgICAgICAgICAgKGZpbGUudHlwZSkudG9Mb3dlckNhc2UoKSAhPT0gXCJpbWFnZS9qcGVnXCIgJiZcclxuICAgICAgICAgICAgICAgICAgICAoZmlsZS50eXBlKS50b0xvd2VyQ2FzZSgpICE9PSBcImltYWdlL3BuZ1wiKVxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgZG9uZShcIkludmFsaWQgZmlsZVwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5vbihcImFkZGVkZmlsZVwiLCBmdW5jdGlvbihmaWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcIkFkZGVkIGZpbGUuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGdsb2JhbC5BcHAuYWpheC5wYWdlc1tnbG9iYWwuQXBwLmFqYXgucGFnZXMubGVuZ3RoIC0gMV0ucmVmcmVzaCgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gY29sb3Jib3ggZm9yIGRpc3BsYXlpbmcgaW1hZ2VzXHJcbiAgICAgICAgJCgnYS5tdGh1bWJzJykudm9sb3Jib3goe1xyXG4gICAgICAgICAgICByZWw6J210aHVtYicsXHJcbiAgICAgICAgICAgIHRpdGxlOiBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgdmFyIGNhcHRpb24gPSAkKHRoaXMpLmF0dHIoJ2RhdGEtY2FwdGlvbicpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNhcHRpb247XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG1heFdpZHRoOiBcIjkwJVwiLFxyXG4gICAgICAgICAgICBtYXhIZWlnaHQ6IFwiOTAlXCJcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICBpZiAoISQoJyNzZWFyY2gtY29udGFpbmVyJykubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKCc6fCcpO1xyXG5cclxuICAgICAgICBnbG9iYWwuQXBwLnNlYXJjaC5jb21wYW5pZXMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZ2xvYmFsLkFwcC5zZWFyY2hidWlsZCk7XHJcbiAgICAgICAgZ2xvYmFsLkFwcC5zZWFyY2guY29tcGFuaWVzLmluaXQoe25hbWUgOiAnY29tcGFuaWVzJ30pO1xyXG5cclxuICAgICAgICBnbG9iYWwuQXBwLnNlYXJjaC52ZW51ZXMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZ2xvYmFsLkFwcC5zZWFyY2hidWlsZCk7XHJcbiAgICAgICAgZ2xvYmFsLkFwcC5zZWFyY2gudmVudWVzLmluaXQoe25hbWUgOiAndmVudWVzJ30pO1xyXG5cclxuICAgICAgICBnbG9iYWwuQXBwLnNlYXJjaC5jb250YWN0cyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBnbG9iYWwuQXBwLnNlYXJjaGJ1aWxkKTtcclxuICAgICAgICBnbG9iYWwuQXBwLnNlYXJjaC5jb250YWN0cy5pbml0KHtuYW1lIDogJ2NvbnRhY3RzJ30pO1xyXG5cclxuICAgICAgICB2YXIgJHR5cGVBaGVhZHMgPSAkKCdib2R5JykuZmluZCgnaW5wdXQudHlwZWFoZWFkLmZvcm0tY29udHJvbCcpLm5leHQoJy5ib290c3RyYXAtdGFnc2lucHV0JykuZmluZCgnaW5wdXQ6Zmlyc3QnKTtcclxuICAgICAgICAkLmVhY2goJHR5cGVBaGVhZHMsIGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyICRpbnB1dCA9ICQodGhpcyk7XHJcbiAgICAgICAgICAgIHZhciAkcGFyZW50ID0gJGlucHV0LmNsb3Nlc3QoJy5mb3JtLWdyb3VwJykuZmluZCgnaW5wdXQudHlwZWFoZWFkJyk7XHJcblxyXG4gICAgICAgICAgICAkaW5wdXQuYXR0cignZGF0YS1wcmVmZXRjaC11cmwnLCAkcGFyZW50LmF0dHIoJ2RhdGEtcHJlZmV0Y2gtdXJsJykpO1xyXG4gICAgICAgICAgICAkaW5wdXQuYXR0cignZGF0YS10ZW1wbGF0ZS1pZCcsICRwYXJlbnQuYXR0cignZGF0YS10ZW1wbGF0ZS1pZCcpKTtcclxuICAgICAgICAgICAgJGlucHV0LmF0dHIoJ2RhdGEtcm9sZScsICRwYXJlbnQuYXR0cignZGF0YS1yb2xlJykpO1xyXG4gICAgICAgICAgICAkaW5wdXQuYWRkQ2xhc3MoJ3R5cGVhaGVhZCcpO1xyXG4gICAgICAgICAgICAkcGFyZW50LnJlbW92ZUNsYXNzKCd0eXBlYWhlYWQnKTtcclxuXHJcbiAgICAgICAgICAgIGdsb2JhbC5BcHAudHlwZUFoZWFkcy5pbml0KCRpbnB1dC5wYXJlbnQoKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyByZXNpemUgYWxsIHRoZSB0aGluZ3Mgb24gcmVzaXplXHJcbiAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICB2YXIgJG1vZGFsID0gJCgnI2FqYXgtbW9kYWwnKTtcclxuICAgICAgICAkbW9kYWwuY3NzKFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgJ21heC13aWR0aCc6ICc1MCUnLFxyXG4gICAgICAgICAgICAnbGVmdCc6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAoJCh3aW5kb3cpLndpZHRoKCkvMikgLSAoJG1vZGFsLndpZHRoKCkvMik7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICd0b3AnOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAoJCh3aW5kb3cpLmhlaWdodCgpLzIpIC0gOTA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coJ1ZhbGlkIHJlc2l6ZSA/Pz8nLCAoJCh3aW5kb3cpLmhlaWdodCgpLzIpIC0gMjEwKTtcclxuICAgICAgICAkKCcubW9kYWwtY29udGVudCcpLmNzcyh7XHJcbiAgICAgICAgICAgIHRvcDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gKCQod2luZG93KS5oZWlnaHQoKS8yKSAtIDIxMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBnbG9iYWwuQXBwLnJlc2l6ZXIucmVzaXplQ29sb3JCb3hlcygpO1xyXG4gICAgfSk7XHJcbiAgICAvL2dsb2JhbC5BcHAucmVzaXplci5yZXNpemVDb2xvckJveGVzKCk7XHJcblxyXG59KShqUXVlcnkpO1xyXG5cclxuXHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbiQuZm4uc2VyaWFsaXplT2JqZWN0ID0gZnVuY3Rpb24oKVxyXG57XHJcbiAgICB2YXIgbyA9IHt9O1xyXG4gICAgdmFyIGEgPSB0aGlzLnNlcmlhbGl6ZUFycmF5KCk7XHJcblxyXG4gICAgJC5lYWNoKGEsIGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICBpZiAob1t0aGlzLm5hbWVdICE9PSB1bmRlZmluZWQpIHtcclxuXHJcbiAgICAgICAgICAgIGlmICghb1t0aGlzLm5hbWVdLnB1c2gpIHtcclxuICAgICAgICAgICAgICAgIG9bdGhpcy5uYW1lXSA9IFtvW3RoaXMubmFtZV1dO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9bdGhpcy5uYW1lXS5wdXNoKHRoaXMudmFsdWUgfHwgJycpO1xyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBvW3RoaXMubmFtZV0gPSB0aGlzLnZhbHVlIHx8ICcnO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBvO1xyXG59O1xyXG5cclxudmFyIEFqYXhQYWdlID0gZnVuY3Rpb24oYWpheCwgb3B0aW9ucykge1xyXG5cclxuICAgICQuZXh0ZW5kKHRydWUsIHRoaXMsIG9wdGlvbnMpO1xyXG5cclxuICAgIHRoaXMuYWpheCAgPSBhamF4O1xyXG4gICAgdGhpcy5jaGlsZCA9IHVuZGVmaW5lZDtcclxuXHJcbiAgICB0aGlzLnR5cGVhaGVhZHMgPSByZXF1aXJlKCcuL190eXBlYWhlYWRzJyk7XHJcbiAgICB0aGlzLmZvcm1jb250cm9scyA9IHJlcXVpcmUoJy4vX2Zvcm0tY29udHJvbHMnKTtcclxuICAgIHRoaXMuaW5pdCgpO1xyXG5cclxuICAgIHJldHVybiB0aGlzO1xyXG59O1xyXG5cclxuQWpheFBhZ2UucHJvdG90eXBlID0ge1xyXG5cclxuICAgIGluaXQ6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHNlbGYuJGZvcm0gPSBzZWxmLiRlbC5maW5kKCdmb3JtJyk7XHJcblxyXG4gICAgICAgIHNlbGYuc2V0VGl0bGUoKTtcclxuICAgICAgICBzZWxmLmhvb2tFdmVudHMoKTtcclxuICAgICAgICBzZWxmLnRvZ2dsZUFkZE90aGVyTW9kZWxzKCk7XHJcbiAgICAgICAgc2VsZi50b2dnbGVDbG9zZUJ1dHRvbnMoKTtcclxuXHJcbiAgICAgICAgLy8gaW5pdCBzZWxmIGNvbnRyb2xzXHJcbiAgICAgICAgc2VsZi5mb3JtY29udHJvbHMuaW5pdEZvcm1Db250cm9scyhzZWxmLiRlbCk7XHJcbiAgICAgICAgc2VsZi50eXBlYWhlYWRzLmluaXQoc2VsZi4kZWwpO1xyXG5cclxuICAgICAgICAgY29uc29sZS5sb2coJ0FqYXhQYWdlIGluaXQnLCBzZWxmKTtcclxuICAgIH0sXHJcblxyXG4gICAgaG9va0V2ZW50czogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgLy8gRmluZCBmb3JtIGFuZCBkaXNhYmxlIGRlZmF1bHQgYWN0aW9uIChvdGhlcndpc2Ugd2hvbGUgaWZyYW1lIGlzIHJlbG9hZGVkKVxyXG4gICAgICAgIHNlbGYuJGZvcm0ub25lKCdzdWJtaXQnLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgc2VsZi5zdWJtaXQoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gY2xvc2VcclxuICAgICAgICBzZWxmLiRlbC5maW5kKCdidXR0b24uY2xvc2UtYWpheC1wYWdlJykub25lKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcclxuXHJcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ2Nsb3NpbmcgcGFnZScpO1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIHZhciAkYnV0dG9uID0gJCh0aGlzKTtcclxuXHJcbiAgICAgICAgICAgICQuZWFjaChzZWxmLmFqYXgucGFnZXMsIGZ1bmN0aW9uKGluZGV4LCBwYWdlKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHBhZ2UuJGVsLmZpbmQoJ2J1dHRvbi5jbG9zZS1hamF4LXBhZ2UnKVswXSA9PT0gJGJ1dHRvblswXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gc2VsZi5hamF4LnBhZ2VzLmxlbmd0aCAtIDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGl0IGlzIGRlIGxhYXRzdGUgcGFnaW5hXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2UuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncGFnZSBsZW5ndGgnLCBzZWxmLmFqYXgucGFnZXMubGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ1NsdWl0IGVlcnN0IGRlIG9uZGVybGlnZ2VuZGUgcGFnaW5hXFwncycpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG5cclxuICAgIHNldFRpdGxlOiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHZhciAkdGl0bGUgPSBzZWxmLiRlbC5maW5kKCcucGFnZS1oZWFkZXIgaDMnKTtcclxuICAgICAgICAkdGl0bGUuaHRtbCgkdGl0bGUuaHRtbCgpICsgJyA8c21hbGw+KHRvICcgKyBzZWxmLnBhcmVudFRpdGxlICsgJyk8L3NtYWxsPicpO1xyXG4gICAgfSxcclxuXHJcbiAgICB0b2dnbGVBZGRPdGhlck1vZGVsczogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgICBpZiAoc2VsZi5tb2RlbElEID09PSAwKSB7IC8vIHRoaXMgaXMgYSBuZXcgbW9kZWwsIHdlIGFyZSBub3QgaW4gZWRpdGluZyBtb2RlXHJcbiAgICAgICAgICAgIHNlbGYuJGVsLmZpbmQoJy5yZWxhdGVkLW1vZGVscy1jb250YWluZXInKS5yZW1vdmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIHRvZ2dsZUNsb3NlQnV0dG9uczogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgICB2YXIgJGNsb3NlQnV0dG9ucyA9ICQoJ2JvZHknKS5hZGQoc2VsZi4kZWwpLmZpbmQoJ2J1dHRvbi5jbG9zZV9wb3B1cCwgYnV0dG9uLmNsb3NlLWFqYXgtcGFnZScpO1xyXG5cclxuICAgICAgICAkY2xvc2VCdXR0b25zLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XHJcbiAgICAgICAgJGNsb3NlQnV0dG9ucy5maWx0ZXIoJzpsYXN0JykucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcclxuICAgIH0sXHJcblxyXG4gICAgY2xvc2U6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdBamF4UGFnZSBDbG9zZScpO1xyXG5cclxuICAgICAgICAvLyBmaW5kIGlmIGN1cnJlbnQgcGFnZSBpcyB0aGUgdG9wIHBhZ2VcclxuICAgICAgICAvLyBpZiBub3QgZmluZCB0aGUgcHJldmlvdXMgcGFnZSB0byBzbGlkZURvd25cclxuICAgICAgICB2YXIgJHByZXZpb3VzUGFnZSA9IGZhbHNlO1xyXG4gICAgICAgIHZhciBpc1RvcFBhZ2UgICAgID0gZmFsc2U7XHJcblxyXG4gICAgICAgIGlmIChzZWxmLmFqYXgucGFnZXMubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICAkcHJldmlvdXNQYWdlID0gc2VsZi5hamF4LnBhZ2VzW3NlbGYuYWpheC5wYWdlcy5sZW5ndGggLSAyXS4kZWwuZmluZCgnLmNvbnRlbnQnKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAkcHJldmlvdXNQYWdlID0gJCgnLmNvbnRlbnQ6Zmlyc3QnKTtcclxuICAgICAgICAgICAgaXNUb3BQYWdlICAgICA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBpdCdzIG5vdCB0aGUgdG9wIHBhZ2VcclxuICAgICAgICBpZiAoIWlzVG9wUGFnZSkge1xyXG5cclxuICAgICAgICAgICAgc2VsZi5hamF4LnBhZ2VzW3NlbGYuYWpheC5wYWdlcy5sZW5ndGggLSAyXS5yZWZyZXNoKCk7XHJcbiAgICAgICAgICAgIHNlbGYuJGVsLnNsaWRlVXAoZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgIHNlbGYuJGVsLmVtcHR5KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJHByZXZpb3VzUGFnZS5zbGlkZURvd24oKTtcclxuXHJcbiAgICAgICAgLy8gaXQgaXMgc28gd2UgcmVsb2FkIHRoZSBkYXRhdGFibGVcclxuICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cub1RhYmxlICE9PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAgICAgd2luZG93Lm9UYWJsZS5kYXRhVGFibGUoKS5hcGkoKS5hamF4LnJlbG9hZChudWxsLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIENsb3NlIGNvbG9yYm94XHJcbiAgICAgICAgICAgIC8vc2VsZi5hamF4LnBhZ2VzLnBvcCgpO1xyXG4gICAgICAgICAgICAkLmNvbG9yYm94LmNsb3NlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBwb3AgbGFzdCBwYWdlXHJcbiAgICAgICAgc2VsZi5hamF4LnBhZ2VzLnBvcCgpO1xyXG5cclxuICAgICAgICAvLyBzZWxmLWRlc3Ryb3lcclxuICAgICAgICBzZWxmID0gdW5kZWZpbmVkO1xyXG4gICAgfSxcclxuXHJcbiAgICBzdWJtaXQ6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgICQoJy5iYWNrZHJvcCcpLmNzcygnZGlzcGxheScsICdibG9jaycpO1xyXG5cclxuICAgICAgICB2YXIgcG9zdF9kYXRhID0ge30sXHJcbiAgICAgICAgdG1wX2Zvcm1fZGF0YSAgICAgID0gc2VsZi4kZm9ybS5zZXJpYWxpemVPYmplY3QoKTtcclxuICAgICAgICB2YXIgbnVtX2FqYXhfcGFnZXMgPSBzZWxmLmFqYXgucGFnZXMubGVuZ3RoO1xyXG5cclxuICAgICAgICBpZihudW1fYWpheF9wYWdlcyA+IDAgJiYgc2VsZi5hamF4LnBhZ2VzW251bV9hamF4X3BhZ2VzIC0gMV0uaGFzT3duUHJvcGVydHkoJ3BhcmVudElEJykpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCBwb3N0X2RhdGEsIHtcclxuICAgICAgICAgICAgICAgICAgICBwYXJlbnRfbW9kZWw6IHNlbGYuYWpheC5wYWdlc1tudW1fYWpheF9wYWdlcyAtIDFdLnBhcmVudFR5cGUsXHJcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50X2lkOiBzZWxmLmFqYXgucGFnZXNbbnVtX2FqYXhfcGFnZXMgLSAxXS5wYXJlbnRJRCxcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZF9tb2RlbDogc2VsZi5hamF4LnBhZ2VzW251bV9hamF4X3BhZ2VzIC0gMV0ubW9kZWxUeXBlLFxyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkX2lkOiBzZWxmLmFqYXgucGFnZXNbbnVtX2FqYXhfcGFnZXMgLSAxXS5tb2RlbElEXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJC5leHRlbmQodHJ1ZSwgcG9zdF9kYXRhLCB0bXBfZm9ybV9kYXRhKTtcclxuICAgICAgICBjb25zb2xlLmxvZygnQWpheFBhZ2UgU3VibWl0JywgcG9zdF9kYXRhLCB0bXBfZm9ybV9kYXRhKTtcclxuXHJcbiAgICAgICAgc2VsZi5hamF4LnBvc3Qoe1xyXG4gICAgICAgICAgICBkYXRhOiAgICAgICBwb3N0X2RhdGEsXHJcbiAgICAgICAgICAgIHBhZ2U6ICAgICAgIHNlbGYsXHJcblxyXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihodG1sKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3BhZ2VzJywgZ2xvYmFsLkFwcC5hamF4LnBhZ2VzLCBodG1sKTtcclxuXHJcbiAgICAgICAgICAgICAgICBzZWxmLiRlbC5lbXB0eSgpO1xyXG4gICAgICAgICAgICAgICAgc2VsZi51cmwgICAgID0gJChodG1sKS5hdHRyKCdkYXRhLXVybCcpO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5tb2RlbElEID0gJChodG1sKS5hdHRyKCdkYXRhLWlkJyk7XHJcbiAgICAgICAgICAgICAgICBzZWxmLiRlbC5odG1sKCQoaHRtbCkuY29udGVudHMoKSk7XHJcbiAgICAgICAgICAgICAgICBzZWxmLmluaXQoKTtcclxuXHJcbiAgICAgICAgICAgICAgICB3aW5kb3cub1RhYmxlLmFwaSgpLmFqYXgucmVsb2FkKG51bGwsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkFtIEkgcnVubmluZyA/XCIpO1xyXG4gICAgICAgICAgICAgICAgJCgnLmJhY2tkcm9wJykuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuXHJcbiAgICByZWZyZXNoOiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZygnQWpheFBhZ2UgUmVmcmVzaCcpO1xyXG5cclxuICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgICB1cmw6IHNlbGYudXJsLFxyXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihodG1sKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgc2VsZi4kZWwuZW1wdHkoKTtcclxuICAgICAgICAgICAgICAgIHNlbGYuJGVsLmh0bWwoJChodG1sKS5jb250ZW50cygpKTtcclxuICAgICAgICAgICAgICAgIHNlbGYuaW5pdCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBlID0galF1ZXJ5LkV2ZW50KCBcImFqYXhDb250ZW50QWRkZWRcIiwgeyBkYXRhOiBodG1sIH0gKTtcclxuICAgICAgICAgICAgICAgICQod2luZG93KS50cmlnZ2VyKGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG52YXIgQWpheCA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuXHJcbiAgICB2YXIgZGVmYXVsdHMgPSB7XHJcbiAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmRlZmF1bHRzICAgICAgICAgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdHMsIG9wdGlvbnMpO1xyXG4gICAgdGhpcy5wYWdlcyAgICAgICAgICAgID0gW107XHJcbiAgICB0aGlzLmN1cnJlbnRQYWdlSW5kZXggPSB1bmRlZmluZWQ7XHJcbn07XHJcblxyXG5BamF4LnByb3RvdHlwZSA9IHtcclxuXHJcbiAgICBwb3N0OiBmdW5jdGlvbihvcHRpb25zKSB7XHJcblxyXG4gICAgICAgIHZhciB1cmwgPSBvcHRpb25zLnBhZ2UudXJsO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdBamF4IHBvc3QnLCB1cmwsIG9wdGlvbnMpO1xyXG5cclxuICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICAgICAgICAgIGRhdGE6IG9wdGlvbnMuZGF0YSxcclxuXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6ZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywganFYSFIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5zdWNjZXNzICYmIHR5cGVvZiBvcHRpb25zLnN1Y2Nlc3MgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnN1Y2Nlc3MoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0FqYXggcG9zdCByZXNwb25zZScsIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG5cclxuICAgIGdldDogZnVuY3Rpb24ob3B0aW9ucykge1xyXG5cclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgJC5leHRlbmQodHJ1ZSwgb3B0aW9ucywgc2VsZi5kZWZhdWx0cywgb3B0aW9ucyk7XHJcbiAgICAgICAgdmFyIHVybCA9ICcvJztcclxuXHJcbiAgICAgICAgaWYob3B0aW9ucy50eXBlID09PSAndGlja2V0dHlwZXMnKSB7XHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygndGlja2V0eXBlJywgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgIHN3aXRjaCAob3B0aW9ucy5hY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2VkaXQnOlxyXG4gICAgICAgICAgICAgICAgICAgIHVybCArPSBvcHRpb25zLnBhcmVudFR5cGUudG9Mb3dlckNhc2UoKSArICcvJyArIG9wdGlvbnMucGFyZW50SUQgKyAnLycgKyBvcHRpb25zLnR5cGUgKyAnLycgKyBvcHRpb25zLmlkICsgJy8nICsgb3B0aW9ucy5hY3Rpb247XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdjcmVhdGUnOlxyXG4gICAgICAgICAgICAgICAgICAgIHVybCArPSBvcHRpb25zLnBhcmVudFR5cGUudG9Mb3dlckNhc2UoKSArICcvJyArIG9wdGlvbnMucGFyZW50SUQgKyAnLycgKyBvcHRpb25zLnR5cGUgKyAnLycgKyBvcHRpb25zLmFjdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgc3dpdGNoIChvcHRpb25zLmFjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnZWRpdCc6XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsICs9IG9wdGlvbnMudHlwZSArICcvJyArIG9wdGlvbnMuaWQgKyAnLycgKyBvcHRpb25zLmFjdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2NyZWF0ZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsICs9IG9wdGlvbnMudHlwZSArICcvJyArIG9wdGlvbnMuYWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAob3B0aW9ucy5wYXJlbnRJRCkge1xyXG4gICAgICAgICAgICBvcHRpb25zLmRhdGEucGFyZW50SUQgPSBvcHRpb25zLnBhcmVudElEO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coJ0FqYXggZ2V0JywgdXJsKTtcclxuXHJcbiAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgdXJsOiB1cmwsXHJcbiAgICAgICAgICAgIG1ldGhvZDogb3B0aW9ucy5tZXRob2QsXHJcbiAgICAgICAgICAgIGRhdGE6IG9wdGlvbnMuZGF0YSxcclxuXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6ZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywganFYSFIpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcGFnZSA9IG5ldyBBamF4UGFnZShzZWxmLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGVsOiAgICAgICAgICAgICQoZGF0YSksXHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiAgICAgICAgICAgIHVybCxcclxuICAgICAgICAgICAgICAgICAgICBtb2RlbElEOiAgICAgICAgb3B0aW9ucy5pZCB8fCAwLFxyXG4gICAgICAgICAgICAgICAgICAgIG1vZGVsVHlwZTogICAgICBvcHRpb25zLnR5cGUsXHJcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50SUQ6ICAgICAgIG9wdGlvbnMucGFyZW50SUQsXHJcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50VHlwZTogICAgIG9wdGlvbnMucGFyZW50VHlwZSxcclxuICAgICAgICAgICAgICAgICAgICBwYXJlbnRUaXRsZTogICAgb3B0aW9ucy5wYXJlbnRUaXRsZVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0FqYXggZ290IHBhZ2UgOiknLCBwYWdlKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyBzZXQgcGFyZW50IGlkIG9uIGZvcm1cclxuICAgICAgICAgICAgICAgIHZhciAkcGFyZW50RmllbGQgPSBwYWdlLiRlbC5maW5kKCdmb3JtIGlucHV0W25hbWU9JyArIFtwYWdlLnBhcmVudFR5cGVdICsgJ19pZF0nKTtcclxuICAgICAgICAgICAgICAgIGlmICgkcGFyZW50RmllbGQubGVuZ3RoICYmICEkcGFyZW50RmllbGQudmFsKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAkcGFyZW50RmllbGQudmFsKHBhZ2UucGFyZW50SUQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vIGlubGluZSBzdW1tYXJ5IGJ1dHRvbnNcclxuICAgICAgICAgICAgICAgIHBhZ2UuJGVsLm9uKCdjbGljaycsICcuYWpheCcsIGZ1bmN0aW9uKGUpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjbGlja2VkIC5hamF4Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2xvYmFsLkFwcC5mdW5jdGlvbnMuZ2V0UGFnZSgkKHRoaXMpKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIFRoZXNlIGd1eXMgc3RpbGwgaGF2ZSB0byBnbyBpbiBhIHRyZWVsaWtlIHN0cnVjdHVyZSAob3Igbm90KVxyXG4gICAgICAgICAgICAgICAgc2VsZi5wYWdlcy5wdXNoKHBhZ2UpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuc3VjY2VzcyAmJiB0eXBlb2Ygb3B0aW9ucy5zdWNjZXNzID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5zdWNjZXNzKHBhZ2UuJGVsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBuZXcgQWpheCgpO1xyXG5cclxuXHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbnZhciBEZWJ1Z2dlciA9IGZ1bmN0aW9uKCkge1xyXG5cdHZhciBzZWxmID0gdGhpcztcclxufTtcclxuXHJcbkRlYnVnZ2VyLnByb3RvdHlwZSA9IHtcclxuXHJcblx0aW5pdDogZnVuY3Rpb24oKSB7XHJcblxyXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xyXG5cdFx0c2VsZi5jcmVhdGVQYW5lbCgpO1xyXG5cdFx0dmFyICRidXR0b24gPSAkKCc8YnV0dG9uIHR5cGU9XCJidXR0b25cIj4nKS50ZXh0KCdDbGljayBtZScpO1xyXG5cclxuXHRcdCRidXR0b24ub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XHJcblx0XHRcdGNvbnNvbGUubG9nKGdsb2JhbC5BcHAuYWpheC5wYWdlcyk7XHJcblx0XHR9KTtcclxuXHJcblx0XHQkYnV0dG9uLmFwcGVuZFRvKHNlbGYuJHBhbmVsKTtcclxuXHR9LFxyXG5cclxuXHRjcmVhdGVQYW5lbDogZnVuY3Rpb24oKSB7XHJcblxyXG5cdFx0dmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuXHRcdHZhciAkcGFuZWwgPSAkKCc8ZGl2IGNsYXNzPVwicGFuZWwgcGFuZWwtZGVmYXVsdFwiPjxkaXYgY2xhc3M9XCJwYW5lbC1oZWFkaW5nXCI+PGgzIGNsYXNzPVwicGFuZWwtdGl0bGVcIj5EZWJ1ZzwvaDM+PC9kaXY+PGRpdiBjbGFzcz1cInBhbmVsLWJvZHlcIj48L2Rpdj48L2Rpdj4nKTtcclxuXHRcdHZhciAkcGFuZWxDb250YWluZXIgPSAkKCc8ZGl2PicpLmNzcyh7XHJcblx0XHRcdHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxyXG5cdFx0XHR3aWR0aDogMzAwLFxyXG5cdFx0XHRoZWlnaHQ6IDQwMCxcclxuXHRcdFx0Ym90dG9tOiAxMCxcclxuXHRcdFx0cmlnaHQ6IDEwLFxyXG5cdFx0XHRcInotaW5kZXhcIjogOTk5OVxyXG5cdFx0fSk7XHJcblxyXG5cdFx0JHBhbmVsLmFwcGVuZFRvKCRwYW5lbENvbnRhaW5lci5hcHBlbmRUbygkKCdib2R5JykpKTtcclxuXHRcdHNlbGYuJHBhbmVsID0gJHBhbmVsLmZpbmQoJy5wYW5lbC1ib2R5Jyk7XHJcblxyXG5cdFx0Y29uc29sZS5sb2coJ2NyZWF0ZWQgcGFuZWwgPz8/Jyk7XHJcblx0fSxcclxuXHJcblx0c2hvd1BhcmVudEFqYXhQYWdlSURzSW5IZWFkZXJzOiBmdW5jdGlvbihhamF4UGFnZSkge1xyXG5cclxuXHRcdHZhciBzZWxmID0gdGhpcztcclxuXHRcdGlmICghZ2xvYmFsLkFwcC5hamF4LnBhZ2VzLmxlbmd0aCkge1xyXG5cdFx0XHRyZXR1cm4gZmFsc2U7XHJcblx0XHR9XHJcblxyXG5cdFx0JC5lYWNoKGdsb2JhbC5BcHAuYWpheC5wYWdlcywgZnVuY3Rpb24oKSB7XHJcblx0XHRcdHZhciAkaHRtbCA9IHRoaXMuJGVsO1xyXG5cdFx0XHR2YXIgZGVidWdTdHJpbmcgPSAnaWQ6ICc7XHJcblx0XHRcdGRlYnVnU3RyaW5nICs9IGFqYXhQYWdlLmlkIHx8ICcnO1xyXG5cdFx0XHRkZWJ1Z1N0cmluZyArPSAnLCBtb2RlbFR5cGU6ICc7XHJcblx0XHRcdGRlYnVnU3RyaW5nICs9IGFqYXhQYWdlLm1vZGVsVHlwZSB8fCAnJztcclxuXHRcdFx0ZGVidWdTdHJpbmcgKz0gJywgcGFyZW50SUQ6ICc7XHJcblx0XHRcdGRlYnVnU3RyaW5nICs9IGFqYXhQYWdlLnBhcmVudElEIHx8ICcnO1xyXG5cdFx0XHRkZWJ1Z1N0cmluZyArPSAnLCBwYXJlbnRUeXBlOiAnO1xyXG5cdFx0XHRkZWJ1Z1N0cmluZyArPSBhamF4UGFnZS5wYXJlbnRUeXBlIHx8ICcnO1xyXG5cdFx0XHRkZWJ1Z1N0cmluZyArPSAnLCBwYXJlbnRUaXRsZTogJztcclxuXHRcdFx0ZGVidWdTdHJpbmcgKz0gYWpheFBhZ2UucGFyZW50VGl0bGUgfHwgJyc7XHJcblx0XHRcdHZhciAkdGl0bGUgPSAkaHRtbC5maW5kKCcucGFnZS1oZWFkZXIgaDMnKTtcclxuXHRcdFx0JHRpdGxlLmh0bWwoJHRpdGxlLmh0bWwoKSArICcgPHNtYWxsPicgKyBkZWJ1Z1N0cmluZyArICc8L3NtYWxsPicpO1xyXG5cdFx0XHRjb25zb2xlLmxvZygnZGVidWdTdHJpbmcnLCBkZWJ1Z1N0cmluZyk7XHJcblxyXG5cdFx0fSk7XHJcblx0fVxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBuZXcgRGVidWdnZXIoKTsiLCIndXNlIHN0cmljdCc7XHJcblxyXG52YXIgRW50aXR5RGV0YWlscyA9IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgIHRoaXMubW9kZWxzID0ge1xyXG4gICAgICAgICdjb21wYW55JzogICAgICAnY29tcGFuaWVzJyxcclxuICAgICAgICAndmVudWUnOiAgICAgICAgJ3ZlbnVlcycsXHJcbiAgICAgICAgJ2NvbnRhY3QnOiAgICAgICdjb250YWN0cydcclxuICAgIH07XHJcblxyXG59O1xyXG5cclxuRW50aXR5RGV0YWlscy5wcm90b3R5cGUgPSB7XHJcblxyXG4gICAgZ2V0OiBmdW5jdGlvbihhcmdzKSB7XHJcblxyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgaWYgKCFhcmdzKSB7XHJcbiAgICAgICAgICAgIHRocm93ICdObyBhcmd1bWVudHMgZ2l2ZW4nO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWFyZ3MudHlwZSkge1xyXG4gICAgICAgICAgICB0aHJvdyAnRW50aXR5IHR5cGUgbm90IHNldCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghYXJncy5pZCkge1xyXG4gICAgICAgICAgICB0aHJvdyAnRW50aXR5IElEIG5vdCBzZXQnO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyIHVybCA9ICcvJyArIGFyZ3MudHlwZSArICcvJyArIGFyZ3MuaWQgKyAnL2RldGFpbHMnO1xyXG5cclxuICAgICAgICAkLmFqYXgoe1xyXG4gICAgICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICAgICAgbWV0aG9kOiAnR0VUJyxcclxuICAgICAgICAgICAgdHlwZTogJ2h0bWwnLFxyXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhLCBzdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICQoJyNzZWFyY2hfJyArIGFyZ3MudHlwZSkuZmluZCgnLmRldGFpbHMnKS5odG1sKGRhdGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBFbnRpdHlEZXRhaWxzKCk7XHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbnZhciBGb3JtQ29udHJvbHMgPSBmdW5jdGlvbigpIHtcclxuXHJcbn07XHJcblxyXG5Gb3JtQ29udHJvbHMucHJvdG90eXBlID0ge1xyXG5cclxuICAgIGluaXRGb3JtQ29udHJvbHM6IGZ1bmN0aW9uKCRlbCkge1xyXG5cclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIGlmICghJGVsKSB7XHJcbiAgICAgICAgICAgICRlbCA9ICQoJ2JvZHknKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgICQuZGF0ZXBpY2tlci5zZXREZWZhdWx0cyh7XHJcbiAgICAgICAgICAgIC8vc2hvd09uOiBcImJvdGhcIixcclxuICAgICAgICAgICAgYnV0dG9uSW1hZ2VPbmx5OiB0cnVlLFxyXG4gICAgICAgICAgICBmb3JtYXREYXRlOiBcInl5LW1tLWRkXCJcclxuICAgICAgICAgICAgLy9idXR0b25JbWFnZTogXCJjYWxlbmRhci5naWZcIixcclxuICAgICAgICAgICAgLy9idXR0b25UZXh0OiBcIkNhbGVuZGFyXCJcclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHNlbGYuaW5pdERhdGFTbGlkZXJzKCRlbCk7XHJcbiAgICAgICAgc2VsZi5pbml0SW5wdXRHcm91cHMoJGVsKTtcclxuICAgICAgICBzZWxmLmluaXREYXRlUGlja2VycygkZWwpO1xyXG4gICAgICAgIHNlbGYuaW5pdFRpbWVQaWNrZXJzKCRlbCk7XHJcbiAgICAgICAgc2VsZi5pbml0S2V5Ym9hcmRTaG9ydGN1dHMoJGVsKTtcclxuICAgIH0sXHJcblxyXG4gICAgaW5pdEtleWJvYXJkU2hvcnRjdXRzOiBmdW5jdGlvbigkZWwpIHtcclxuXHJcbiAgICAgICAgLy8gT24gY3Vyc29yIGRvd24gYW5kIHVwIGtleSwgZ28gdG8gbmV4dCBvciBwcmV2aW91cyBsZWdlbmRcclxuICAgICAgICAkZWwuZmluZCgnLmNvbC1zbS03IGlucHV0W3R5cGU9XCJ0ZXh0XCJdJykub24oJ2tleXVwJywgZnVuY3Rpb24oZSkge1xyXG5cclxuICAgICAgICAgICAgdmFyICRsZWdlbmRzICAgICAgICAgICA9ICRlbC5maW5kKCcuY29sLXNtLTcgbGVnZW5kJyk7IC8vIGFsbCBsZWdlbmRzIGluIGxlZnQgY29sdW1uXHJcbiAgICAgICAgICAgIHZhciAkY3VycmVudExlZ2VuZCAgICAgPSAkKHRoaXMpLnBhcmVudHMoJy5mb3JtLWdyb3VwOmZpcnN0JykucHJldkFsbCgpLmZpbHRlcignbGVnZW5kOmZpcnN0Jyk7XHJcbiAgICAgICAgICAgIHZhciBjdXJyZW50TGVnZW5kSW5kZXggPSAkbGVnZW5kcy5maWx0ZXIoJGN1cnJlbnRMZWdlbmQpLmluZGV4KCdsZWdlbmQnKTtcclxuICAgICAgICAgICAgdmFyIGxlZ2VuZENvdW50ICAgICAgICA9ICRsZWdlbmRzLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIGlmIChlLmtleUNvZGUgPT09IDQwKSB7IC8vIERPV04ga2V5XHJcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudExlZ2VuZEluZGV4IDwgbGVnZW5kQ291bnQgLSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGxlZ2VuZHMuZXEoY3VycmVudExlZ2VuZEluZGV4ICsgMSkubmV4dEFsbCgnLmZvcm0tZ3JvdXA6Zmlyc3QnKS5maW5kKCcuZm9ybS1jb250cm9sOmZpcnN0JykuZm9jdXMoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMzgpIHsgLy8gVVAga2V5XHJcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudExlZ2VuZEluZGV4ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICRsZWdlbmRzLmVxKGN1cnJlbnRMZWdlbmRJbmRleCAtIDEpLm5leHRBbGwoJy5mb3JtLWdyb3VwOmZpcnN0JykuZmluZCgnLmZvcm0tY29udHJvbDpmaXJzdCcpLmZvY3VzKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcblxyXG4gICAgaW5pdFRpbWVQaWNrZXJzOiBmdW5jdGlvbigkZWwpIHtcclxuXHJcbiAgICAgICAgJGVsLmZpbmQoJ2lucHV0W3RpbWUtcGlja2VyXScpLmVhY2goZnVuY3Rpb24obmR4LCB2YWwpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpO1xyXG4gICAgICAgICAgICAkaW5wdXQudGltZXBpY2tlcih7XHJcbiAgICAgICAgICAgICAgICBjb250cm9sVHlwZTogJ3NlbGVjdCcsXHJcbiAgICAgICAgICAgICAgICB0aW1lRm9ybWF0OiAnSEg6bW0nLFxyXG4gICAgICAgICAgICAgICAgc3RlcE1pbnV0ZTogNVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcblxyXG4gICAgaW5pdERhdGVQaWNrZXJzOiBmdW5jdGlvbigkZWwpIHtcclxuXHJcbiAgICAgICAgJGVsLmZpbmQoJ2lucHV0W2RhdGUtcGlja2VyXScpLmVhY2goZnVuY3Rpb24obmR4LCB2YWwpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciAkaW5wdXQgPSAkKHRoaXMpO1xyXG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHtkYXRlRm9ybWF0OiAneXktbW0tZGQnfTtcclxuXHJcbiAgICAgICAgICAgICRpbnB1dC5kYXRlcGlja2VyKG9wdGlvbnMpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH0sXHJcblxyXG4gICAgaW5pdElucHV0R3JvdXBzOiBmdW5jdGlvbigkZWwpIHtcclxuXHJcbiAgICAgICAgJGVsLmZpbmQoJ1tpbnB1dC1ncm91cF0nKS5lYWNoKGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyICRpbnB1dCA9ICQodGhpcyk7XHJcbiAgICAgICAgICAgIHZhciAkaW5wdXRHcm91cCA9ICQoJzxkaXY+JykuYWRkQ2xhc3MoJ2lucHV0LWdyb3VwJyk7XHJcbiAgICAgICAgICAgIHZhciAkYWRkb24gPSAkKCc8c3Bhbj4nKS5hZGRDbGFzcygnaW5wdXQtZ3JvdXAtYWRkb24nKS5odG1sKCRpbnB1dC5hdHRyKCdpbnB1dC1ncm91cC1sYWJlbCcpKTtcclxuXHJcbiAgICAgICAgICAgICRpbnB1dC53cmFwKCRpbnB1dEdyb3VwKTtcclxuICAgICAgICAgICAgJGlucHV0LmFmdGVyKCRhZGRvbik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG5cclxuICAgIGluaXREYXRhU2xpZGVyczogZnVuY3Rpb24oJGVsKSB7XHJcblxyXG4gICAgICAgICRlbC5maW5kKCdpbnB1dFtkYXRhLXNsaWRlcj10cnVlXScpLmVhY2goZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgJGlucHV0ID0gJCh0aGlzKTtcclxuICAgICAgICAgICAgdmFyICRzbGlkZXIgPSAkKCc8ZGl2PicpO1xyXG4gICAgICAgICAgICAkaW5wdXQuYWZ0ZXIoJHNsaWRlcik7XHJcblxyXG4gICAgICAgICAgICB2YXIgbWluID0gcGFyc2VJbnQoJGlucHV0LmF0dHIoJ2RhdGEtc2xpZGVyLW1pbicpLCAxMCkgfHwgMDtcclxuICAgICAgICAgICAgdmFyIG1heCA9IHBhcnNlSW50KCRpbnB1dC5hdHRyKCdkYXRhLXNsaWRlci1tYXgnKSwgMTApIHx8IDEwMDtcclxuICAgICAgICAgICAgdmFyIHN0ZXAgPSBwYXJzZUludCgkaW5wdXQuYXR0cignZGF0YS1zbGlkZXItc3RlcCcpKSB8fCAxO1xyXG4gICAgICAgICAgICB2YXIgZm9yY2VTdGVwT25JbnB1dCA9ICRpbnB1dC5hdHRyKCdkYXRhLXNsaWRlci1mb3JjZS1pbnB1dC1zdGVwJykgPyB0cnVlIDogZmFsc2U7XHJcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHBhcnNlSW50KCRpbnB1dC52YWwoKSkgfHwgbWluO1xyXG5cclxuICAgICAgICAgICAgJHNsaWRlci5zbGlkZXIoe1xyXG4gICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxyXG4gICAgICAgICAgICAgICAgbWluOiBtaW4sXHJcbiAgICAgICAgICAgICAgICBtYXg6IG1heCxcclxuICAgICAgICAgICAgICAgIHN0ZXA6IHN0ZXAsXHJcbiAgICAgICAgICAgICAgICBzbGlkZTogZnVuY3Rpb24oIGV2ZW50LCB1aSApIHtcclxuICAgICAgICAgICAgICAgICAgICAkaW5wdXQudmFsKHVpLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgY2FsY3VsYXRlQ29ycmVjdFZhbHVlID0gZnVuY3Rpb24odmFsdWUsIGZvcmNlU3RlcCkge1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+IG1heCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gbWF4O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlIDwgbWluKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBtaW47XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGZvcmNlU3RlcCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBNYXRoLmNlaWwodmFsdWUgLyBzdGVwKSAqIHN0ZXA7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBNYXRoLmZsb29yKHZhbHVlIC8gc3RlcCkgKiBzdGVwO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICB2YXIgc2V0VmFsdWVzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSAkaW5wdXQudmFsKCk7XHJcbiAgICAgICAgICAgICAgICAkaW5wdXQudmFsKGNhbGN1bGF0ZUNvcnJlY3RWYWx1ZSh2YWx1ZSwgZm9yY2VTdGVwT25JbnB1dCkpO1xyXG4gICAgICAgICAgICAgICAgJHNsaWRlci5zbGlkZXIoe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiBjYWxjdWxhdGVDb3JyZWN0VmFsdWUodmFsdWUsIHRydWUpXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHNldFZhbHVlcygpO1xyXG5cclxuICAgICAgICAgICAgJGlucHV0Lm9uKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHNldFZhbHVlcygpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBGb3JtQ29udHJvbHMoKTtcclxuIiwiJ3VzZSBzdHJpY3QnO1xyXG5cclxudmFyIFJlc2l6ZXIgPSBmdW5jdGlvbigpIHtcclxufTtcclxuXHJcblJlc2l6ZXIucHJvdG90eXBlID0ge1xyXG5cclxuICAgIHJlc2l6ZUNvbG9yQm94ZXM6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIGlmICgkKCcjY29sb3Jib3gnKS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgJC5jb2xvcmJveC5yZXNpemUoe3dpZHRoOlwiOTAlXCIsIGhlaWdodDpcIjkwJVwifSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBuZXcgUmVzaXplcigpO1xyXG4iLCIndXNlIHN0cmljdCc7XHJcblxyXG52YXIgU2VhcmNoTW9kdWxlID0gZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgdGhpcy5uYW1lICAgICAgID0gJyc7XHJcbiAgICB0aGlzLiR0YWJsZSAgICAgPSB7fTtcclxuICAgIHRoaXMucmVzICAgICAgICA9IHt9O1xyXG4gICAgdGhpcy5kdCAgICAgICAgID0ge307XHJcbiAgICB0aGlzLmR0X2NvbHVtbnMgPSBbXTtcclxuXHJcbiAgICB0aGlzLnR5cGVhaGVhZHMgPSB1bmRlZmluZWQ7XHJcbn07XHJcblxyXG5TZWFyY2hNb2R1bGUucHJvdG90eXBlID0ge1xyXG5cclxuICAgIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcclxuXHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICBzZWxmLm5hbWUgICAgICAgPSBvcHRpb25zLm5hbWU7XHJcbiAgICAgICAgc2VsZi4kdGFibGUgICAgID0gJCgnI3NlYXJjaF8nK29wdGlvbnMubmFtZSsnX3RhYmxlJyk7XHJcbiAgICAgICAgc2VsZi5yZXMgICAgICAgID0ge307XHJcbiAgICAgICAgc2VsZi5kdCAgICAgICAgID0ge307XHJcbiAgICAgICAgc2VsZi5kdF9jb2x1bW5zID0gW107XHJcblxyXG4gICAgICAgIHNlbGYuaW5pdERhdGEoKVxyXG4gICAgICAgICAgICAuaW5pdENvbHVtbnMoKVxyXG4gICAgICAgICAgICAuaW5pdFRhYmxlKClcclxuICAgICAgICAgICAgLmluaXREZXRhaWxzKClcclxuICAgICAgICAgICAgLmluaXRDbGlja0xpc3RlbmVyKClcclxuICAgICAgICAgICAgLmluaXRLQkxpc3RlbmVyKCk7XHJcbiAgICB9LFxyXG5cclxuICAgIGluaXRDb2x1bW5zOiBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICAkKCcjc2VhcmNoXycrc2VsZi5uYW1lKydfdGFibGUgdGgnKS5lYWNoKGZ1bmN0aW9uKG5keCkge1xyXG4gICAgICAgICAgICBzZWxmLmR0X2NvbHVtbnMucHVzaCh7ZGF0YTogJCh0aGlzKS5hdHRyKCdkYXRhLWNvbHVtbicpfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdzZWxmLmR0X2NvbHVtbnMnLCBzZWxmLmR0X2NvbHVtbnMpO1xyXG5cclxuICAgICAgICByZXR1cm4gc2VsZjtcclxuICAgIH0sXHJcbiAgICBpbml0RGF0YTogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgc2VsZi5yZXMuZGF0YSA9IEpTT04ucGFyc2UoJCgnI2R0Xycrc2VsZi5uYW1lKydfaW5pdCcpLnRleHQoKSkuZGF0YTtcclxuICAgICAgICBjb25zb2xlLmxvZygnc2VsZi5yZXMuZGF0YScsICcjZHRfJytzZWxmLm5hbWUrJ19pbml0Jywgc2VsZi5yZXMuZGF0YSwgJCgnI2R0Xycrc2VsZi5uYW1lKydfaW5pdCcpLnRleHQoKSk7XHJcblxyXG4gICAgICAgIHJldHVybiBzZWxmO1xyXG4gICAgfSxcclxuICAgIGluaXRUYWJsZTogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgY29uc29sZS5sb2coc2VsZi5uYW1lKTtcclxuICAgICAgICBzZWxmLmR0ID0gJCgnI3NlYXJjaF8nK3NlbGYubmFtZSsnX3RhYmxlJykuZGF0YVRhYmxlKHtcclxuICAgICAgICAgICAgXCJkb21cIjogXCI8J3Jvdyc8J2NvbC1tZC02Jzwncm93JzwnY29sLXhzLTYnbD48J2NvbC14cy02IHRleHQtcmlnaHQncj4+PjwnY29sLW1kLTYnZj4+dDwncm93JzwnY29sLW1kLTYnaT48J2NvbC1tZC02J3A+PlwiLFxyXG4gICAgICAgICAgICBcInBhZ2VMZW5ndGhcIjogNSxcclxuICAgICAgICAgICAgXCJvcmRlclwiOiBbWyAwLCBcImRlc2NcIiBdXSxcclxuICAgICAgICAgICAgXCJjb2x1bW5zXCI6IHNlbGYuZHRfY29sdW1ucyxcclxuICAgICAgICAgICAgXCJkYXRhXCI6IEpTT04ucGFyc2UoJCgnI2R0Xycrc2VsZi5uYW1lKydfaW5pdCcpLnRleHQoKSkuZGF0YSxcclxuICAgICAgICAgICAgXCJsZW5ndGhDaGFuZ2VcIjogZmFsc2UsXHJcbiAgICAgICAgICAgIFwic2VhcmNoaW5nXCI6IGZhbHNlLFxyXG4gICAgICAgICAgICBcInRhYmxlVG9vbHNcIjoge1xyXG4gICAgICAgICAgICAgICAgXCJzUm93U2VsZWN0XCI6IFwic2luZ2xlXCIsXHJcbiAgICAgICAgICAgICAgICBcImFCdXR0b25zXCI6IFtcclxuICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gc2VsZjtcclxuICAgIH0sXHJcbiAgICBpbml0RGV0YWlsczogZnVuY3Rpb24oKSB7XHJcblxyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgdmFyICRlbCA9ICQoJyNzZWFyY2hfJyArIHNlbGYubmFtZSArICdfdGFibGUgdGJvZHkgdHI6Zmlyc3QnKTtcclxuICAgICAgICBpZigkZWwubGVuZ3RoKSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgZW50aXR5X2lkID0gJCgnI3NlYXJjaF8nICsgc2VsZi5uYW1lICsgJ190YWJsZSB0Ym9keSB0cjpmaXJzdCcpLmF0dHIoJ2lkJyk7XHJcbiAgICAgICAgICAgIHZhciBlbnRpdHlfZGV0YWlscyA9IHJlcXVpcmUoJy4vX2VudGl0eS1kZXRhaWxzJyk7XHJcbiAgICAgICAgICAgIGVudGl0eV9kZXRhaWxzLmdldCh7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBzZWxmLm5hbWUsXHJcbiAgICAgICAgICAgICAgICBpZDogZW50aXR5X2lkXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcblxyXG5cclxuXHJcbiAgICAgICAgcmV0dXJuIHNlbGY7XHJcbiAgICB9LFxyXG4gICAgaW5pdENsaWNrTGlzdGVuZXI6IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXMsXHJcblxyXG4gICAgICAgIHNlbGVjdG9yID0gJyNzZWFyY2hfJyArIHNlbGYubmFtZSArICdfdGFibGUgdGJvZHkgdHInO1xyXG5cclxuICAgICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgc2VsZWN0b3IsIGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyICRyb3cgPSAkKHRoaXMpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGVudGl0eV9kZXRhaWxzID0gcmVxdWlyZSgnLi9fZW50aXR5LWRldGFpbHMnKTtcclxuICAgICAgICAgICAgZW50aXR5X2RldGFpbHMuZ2V0KHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IHNlbGYubmFtZSxcclxuICAgICAgICAgICAgICAgIGlkOiAkcm93LmF0dHIoJ2lkJylcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICQoc2VsZWN0b3IpLm5vdCgkcm93KS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcclxuICAgICAgICAgICAgJHJvdy50b2dnbGVDbGFzcygnc2VsZWN0ZWQnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlbGY7XHJcbiAgICB9LFxyXG4gICAgaW5pdEtCTGlzdGVuZXI6IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHZhciBuYW1lID0gc2VsZi5uYW1lO1xyXG5cclxuICAgICAgICAvLyB0eXBlYWhlYWRzIGlucHV0XHJcbiAgICAgICAgJCgnYm9keScpLm9uKCdmb2N1c291dCcsICcudHQtaW5wdXQnLCBmdW5jdGlvbihldmVudCkge1xyXG5cclxuICAgICAgICAgICAgJCh0aGlzKS5oaWRlKCk7XHJcbiAgICAgICAgICAgICQodGhpcykucGFyZW50KCdzcGFuJykuZmluZCgnLnR0LWhpbnQnKS5oaWRlKCk7XHJcbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyB0YWdzIGlucHV0XHJcbiAgICAgICAgJCgnYm9keScpLm9uKCdjbGljaycsICcuYm9vdHN0cmFwLXRhZ3NpbnB1dCcsIGZ1bmN0aW9uKGV2ZW50KSB7XHJcblxyXG4gICAgICAgICAgICB2YXIgJHNlbF9pbnB1dCA9ICQodGhpcykuZmluZCgnLnR0LWlucHV0Jyk7XHJcbiAgICAgICAgICAgIHZhciAkc2VsX2hpbnQgPSAkKHRoaXMpLmZpbmQoJy50dC1oaW50Jyk7XHJcblxyXG4gICAgICAgICAgICAkc2VsX2lucHV0LnZhbCgnJykuc2hvdygpLmZvY3VzKCk7XHJcbiAgICAgICAgICAgICRzZWxfaGludC5zaG93KCk7XHJcblxyXG4gICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gTWFpbiBLQiBldmVudCBwdW1wXHJcbiAgICAgICAgJCgnYm9keScpLm9uKCdrZXl1cCcsICcjc2VhcmNoXycgKyBuYW1lICsgJyBpbnB1dCcsIGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICAgICAgdmFyIHJlcV9kYXRhID0ge307XHJcbiAgICAgICAgICAgICQoJyNzZWFyY2hfJyArIG5hbWUgKyAnX3RhYmxlIHRoZWFkIHRyIHRoJykuZWFjaChmdW5jdGlvbihuZHgpe1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBjdXJyX3Byb3BlcnR5ID0gJCh0aGlzKS5hdHRyKCdkYXRhLWNvbHVtbicpO1xyXG4gICAgICAgICAgICAgICAgcmVxX2RhdGFbY3Vycl9wcm9wZXJ0eV0gPSAkKCcjJytzZWxmLm5hbWUrJ18nK2N1cnJfcHJvcGVydHkpLnZhbCgpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coY3Vycl9wcm9wZXJ0eSwgcmVxX2RhdGFbY3Vycl9wcm9wZXJ0eV0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8vIGV4dGVuZCByZXF1ZXN0IHBhcmFtc1xyXG4gICAgICAgICAgICBzd2l0Y2gobmFtZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnY29tcGFuaWVzJzpcclxuICAgICAgICAgICAgICAgICAgICByZXFfZGF0YSA9ICQuZXh0ZW5kKCd0cnVlJywgcmVxX2RhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZXM6ICQoJyNjb21wYW5pZXNfcmVmZXJlbmNlcycpLnZhbCgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3ZlbnVlcyc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmVxX2RhdGEgPSAkLmV4dGVuZCgndHJ1ZScsIHJlcV9kYXRhLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW5fY2FwYWNpdHk6ICQoJyN2ZW51ZXNfbWluX2NhcGFjaXR5JykudmFsKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXhfY2FwYWNpdHk6ICQoJyN2ZW51ZXNfbWF4X2NhcGFjaXR5JykudmFsKCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW5fcmlnX2NhcGFjaXR5OiAkKCcjdmVudWVzX21pbl9yaWdfY2FwYWNpdHknKS52YWwoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBwb3N0IHF1ZXJ5XHJcbiAgICAgICAgICAgICQuYWpheCh7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBcIlBPU1RcIixcclxuICAgICAgICAgICAgICAgIHVybDogXCIvc2VhcmNoX1wiK3NlbGYubmFtZStcIl9kYXRhXCIsXHJcbiAgICAgICAgICAgICAgICBhc3luYzogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXHJcbiAgICAgICAgICAgICAgICBkYXRhOiByZXFfZGF0YSxcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIGpxWEhSKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZHQuZm5DbGVhclRhYmxlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuZGF0YSAmJiBkYXRhLmRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhamF4IHNlYXJjaCBkYXRhJywgZGF0YS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5kdC5mbkFkZERhdGEoZGF0YS5kYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmKCQoJyNzZWFyY2hfJyArIG5hbWUgKyAnX3RhYmxlIHRib2R5IHRyOnNlbGVjdGVkJykubGVuZ3RoID09PSAwKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmRldGFpbHMnKS5lbXB0eSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKHFYSFIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlbGY7XHJcbiAgICB9XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBTZWFyY2hNb2R1bGUoKTtcclxuXHJcbiIsIid1c2Ugc3RyaWN0JztcclxuXHJcbnZhciBUeXBlQWhlYWRzID0gZnVuY3Rpb24oKSB7XHJcblxyXG59O1xyXG5cclxuVHlwZUFoZWFkcy5wcm90b3R5cGUgPSB7XHJcblxyXG4gICAgaW5pdDogZnVuY3Rpb24oJGVsKSB7XHJcblxyXG4gICAgICAgIHZhciBfID0gd2luZG93Ll87XHJcbiAgICAgICAgdmFyIEJsb29kaG91bmQgPSB3aW5kb3cuQmxvb2Rob3VuZDtcclxuXHJcbiAgICAgICAgaWYgKCEkZWwpIHtcclxuICAgICAgICAgICAgJGVsID0gJCgnYm9keScpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJGVsLmZpbmQoJ2lucHV0LnR5cGVhaGVhZCcpLm5vdCgnLmluaXRpYWxpemVkJykuZWFjaChmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgIHZhciAkaW5wdXQgICAgICAgICAgICAgID0gJCh0aGlzKTtcclxuICAgICAgICAgICAgdmFyICRhZGROZXdCdXR0b24gICAgICAgPSAkaW5wdXQucGFyZW50cygnLmlucHV0LWdyb3VwOmZpcnN0JykuZmluZCgnLmlucHV0LWdyb3VwLWJ0biBidXR0b24nKTtcclxuICAgICAgICAgICAgdmFyIG11cmwgICAgICAgICAgICAgICAgPSAnL2FwaS92MScgKyAkaW5wdXQuYXR0cignZGF0YS1wcmVmZXRjaC11cmwnKTtcclxuICAgICAgICAgICAgdmFyIGF0dGFjaEJhc2VVcmwgICAgICAgPSAkaW5wdXQuYXR0cignZGF0YS1hdHRhY2gtdXJsJyk7XHJcbiAgICAgICAgICAgIHZhciAkc3VnZ2VzdGlvblRlbXBsYXRlID0gJGVsLmZpbmQoJyMnICsgJGlucHV0LmF0dHIoJ2RhdGEtdGVtcGxhdGUtaWQnKSkuaHRtbCgpIHx8ICc8JT0gZGF0dW0udmFsdWUgJT4nO1xyXG4gICAgICAgICAgICB2YXIgc3VnZ2VzdGlvblRlbXBsYXRlICA9IF8udGVtcGxhdGUoJHN1Z2dlc3Rpb25UZW1wbGF0ZSk7XHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc3VnZ2VzdGlvbiB0ZW1wbGF0ZScsICRzdWdnZXN0aW9uVGVtcGxhdGUpO1xyXG5cclxuICAgICAgICAgICAgLy8gVGhpcyBpcyB1c2VkIGZvciB0aGUgc2VhcmNoIHBhZ2VzLCBjb21iaW5pbmcgdGhlIHR5cGUtYWhlYWQgZmVhdHVyZXMgd2l0aCB0aGUgdGFnIGlucHV0IHN0dWZmLiBJbnN0ZWFkIG9mXHJcbiAgICAgICAgICAgIC8vIGF0dGFjaGluZyB0aGlzIG1vZGVsIHRvIHRoZSBwYXJlbnQgbW9kZWwgdmlhIGF0dGFjaEJhc2VVcmxcclxuICAgICAgICAgICAgdmFyIHRhZ0lucHV0ID0gKCRpbnB1dC5hdHRyKCdkYXRhLXJvbGUnKSA9PT0gJ3RhZ3NpbnB1dCcgPyB0cnVlIDogZmFsc2UpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnaXMgdGFnSW5wdXQ6ICcsICRpbnB1dC5hdHRyKCdkYXRhLXJvbGUnKSwgdGFnSW5wdXQpO1xyXG5cclxuICAgICAgICAgICAgLy8gRGlzYWJsZSBhZGROZXdCdXR0b24sIGl0IHdpbGwgYmUgZW5hYmxlZCBhdCBvbiBjaGFuZ2UgZXZlbnQsIHdoZW4gdGhlcmUgYXJlIGF0IGxlYXN0IDMgY2hhcmFjdGVyc1xyXG4gICAgICAgICAgICBpZiAoJGFkZE5ld0J1dHRvbikge1xyXG4gICAgICAgICAgICAgICAgJGFkZE5ld0J1dHRvbi5hdHRyKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBQcmV2ZW50IGlucHV0cyBmcm9tIGluaXRpYWxpemluZyBtdWx0aXBsZSB0aW1lc1xyXG4gICAgICAgICAgICAkaW5wdXQuYWRkQ2xhc3MoJ2luaXRpYWxpemVkJyk7XHJcblxyXG4gICAgICAgICAgICAvLyBDb25zdHJ1Y3QgQmxvb2Rob3VuZCBzdWdnZXN0aW9uIGVuZ2luZSwgd2UgZG9uJ3QgdXNlIHRoZSBwcmVmZXRjaCBmZWF0dXJlZFxyXG4gICAgICAgICAgICB2YXIgYmxvb2Rob3VuZCA9IG5ldyBCbG9vZGhvdW5kKFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBkYXR1bVRva2VuaXplcjogZnVuY3Rpb24oZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBCbG9vZGhvdW5kLnRva2VuaXplcnMud2hpdGVzcGFjZShkLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBxdWVyeVRva2VuaXplcjogZnVuY3Rpb24ocXVlcnkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gQmxvb2Rob3VuZC50b2tlbml6ZXJzLndoaXRlc3BhY2UocXVlcnkpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGR1cERldGVjdG9yOiBmdW5jdGlvbihyZW1vdGVNYXRjaCwgbG9jYWxNYXRjaCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZW1vdGVNYXRjaC5pZCA9PT0gbG9jYWxNYXRjaC5pZDtcclxuICAgICAgICAgICAgICAgIH0sXHJcblxyXG4gICAgICAgICAgICAgICAgbGltaXQ6IDEwLFxyXG4gICAgICAgICAgICAgICAgcmVtb3RlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBtdXJsICsgJz9xPSVRVUVSWScsXHJcbiAgICAgICAgICAgICAgICAgICAgd2lsZGNhcmQ6ICclUVVFUlknXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy9ibG9vZGhvdW5kLmNsZWFyUHJlZmV0Y2hDYWNoZSgpOyBibG9vZGhvdW5kLmNsZWFyUmVtb3RlQ2FjaGUoKTtcclxuICAgICAgICAgICAgYmxvb2Rob3VuZC5pbml0aWFsaXplKCk7XHJcbiAgICAgICAgICAgIC8vYmxvb2Rob3VuZC5jbGVhclByZWZldGNoQ2FjaGUoKTsgYmxvb2Rob3VuZC5jbGVhclJlbW90ZUNhY2hlKCk7XHJcblxyXG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKCd0YSBCbG9vZGhvdW5kJywgYmxvb2Rob3VuZC50dEFkYXB0ZXIoKSk7XHJcblxyXG4gICAgICAgICAgICAvLyBDb25zdHJ1Y3QgdGhlIFR3aXR0ZXIgVHlwZWFoZWFkIGl0c2VsZlxyXG4gICAgICAgICAgICAkaW5wdXQudHlwZWFoZWFkKFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBoaW50OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgaGlnaGxpZ2h0OiB0cnVlLFxyXG5cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgbGltaXQ6IDEwLFxyXG4gICAgICAgICAgICAgICAgc291cmNlOiBibG9vZGhvdW5kLnR0QWRhcHRlcigpLFxyXG4gICAgICAgICAgICAgICAgcmVzdHJpY3RJbnB1dFRvRGF0dW06IHRydWUsXHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZXM6IHtcclxuICAgICAgICAgICAgICAgICAgICBoZWFkZXI6IGZ1bmN0aW9uKGRhdHVtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz1cImxpc3QtZ3JvdXAgdHlwZWFoZWFkLXJlc3VsdHMtY29udGFpbmVyXCI+JztcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGZvb3RlcjogZnVuY3Rpb24oZGF0dW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8L2Rpdj4nO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgc3VnZ2VzdGlvbjogZnVuY3Rpb24oZGF0dW0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRsaW5rID0gJCgnPGEgaHJlZj1cIiNcIiBjbGFzcz1cImxpc3QtZ3JvdXAtaXRlbVwiIGRhdGEtaWQ9XCInICsgZGF0dW0uaWQgKyAnXCI+JyArIHN1Z2dlc3Rpb25UZW1wbGF0ZSh7ZGF0dW0gOiBkYXR1bX0pICsgJzwvYT4nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZCB0eXBlYWhlYWQgdG8gYmVnaW4gb2YgRE9NIHRvIGJlIGFibGUgdG8gZG8gc3R5bGluZ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyAoY2Fubm90IGluc3BlY3QgZWxlbWVudHMsIGJlY2F1c2UgdGhlIGZvY3VzIG91dCBjbGVhcnMgdGhlIGVsZW1lbnRzKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGxpbmsub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkucGFyZW50KCkucGFyZW50KCkucGFyZW50KCkucGFyZW50KCkuY2xvbmUoKS5wcmVwZW5kVG8oJ2JvZHknKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnJGxpbmsnLCAkbGluaywgZGF0dW0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRsaW5rO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgIC8vIFdoZW4gdXNpbmcgdGhlIGtleWJvYXJkIHRvIHdhbGsgdGhyb3VnaCB0aGUgc3VnZ2VzdGlvbnMsIGFkZCBib290c3RyYXAgY2xhc3NlcyBmb3IgdmlzdWFsIGVuaGFuY2VtZW50c1xyXG4gICAgICAgICAgICAub24oJ3R5cGVhaGVhZDpjdXJzb3JjaGFuZ2VkJywgZnVuY3Rpb24oZXZlbnQsIHN1Z2dlc3Rpb24sIGRhdGFzZXQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndHlwZWFoZWFkOmN1cnNvcmNoYW5nZWQnLCAkKHRoaXMpLCBldmVudCwgc3VnZ2VzdGlvbiwgZGF0YXNldCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYoc3VnZ2VzdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICQodGhpcykudmFsKHN1Z2dlc3Rpb24udmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICQoJy50dC1zdWdnZXN0aW9uIGEnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICAkKCcudHQtc3VnZ2VzdGlvbi50dC1jdXJzb3IgYScpLmFkZENsYXNzKCdhY3RpdmUnKTtcclxuXHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICAvLyBXaGVuIGFuIGl0ZW0gaXMgc2VsZWN0ZWQgZnJvbSB0aGUgbGlzdFxyXG4gICAgICAgICAgICAub24oJ3R5cGVhaGVhZDpzZWxlY3RlZCcsIGZ1bmN0aW9uKGV2ZW50LCBzdWdnZXN0aW9uLCBkYXRhc2V0KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gYXR0YWNoIHRoaXMgaXRlbSB0byB0aGUgcGFyZW50IGl0ZW1cclxuICAgICAgICAgICAgICAgIGlmIChhdHRhY2hCYXNlVXJsKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhdHRhY2hVcmwgPSBhdHRhY2hCYXNlVXJsICsgJy8nICsgc3VnZ2VzdGlvbi5pZCArICcvYXR0YWNoJztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiBhdHRhY2hVcmwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnN1Y2Nlc3MpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByZXNldCBpbnB1dCBmaWVsZHNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcudHlwZWFoZWFkJykudHlwZWFoZWFkKCd2YWwnLCAnJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3R5cGVhaGVhZDpzZWxlY3RlZCByZWxhdGVkIG1vZGVsIGF0dGFjaGVkIDopJywgZGF0YSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChkYXRhLmVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoZGF0YS5lcnJvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEucmVsb2FkICYmIGdsb2JhbC5BcHAuYWpheC5wYWdlcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnbG9iYWwuQXBwLmFqYXgucGFnZXNbZ2xvYmFsLkFwcC5hamF4LnBhZ2VzLmxlbmd0aCAtIDFdLnJlZnJlc2goKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gc2VhcmNoIGNvdW50cmllc1xyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGFnSW5wdXQpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coc3VnZ2VzdGlvbik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHZhciAkc2VsID0gJCh0aGlzKS5jbG9zZXN0KCcuZm9ybS1ncm91cCcpLmZpbmQoJ2lucHV0LmZvcm0tY29udHJvbDpmaXJzdCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJy50eXBlYWhlYWQnKS50eXBlYWhlYWQoJ3ZhbCcsICcnKTtcclxuICAgICAgICAgICAgICAgICAgICAkc2VsLnRhZ3NpbnB1dCgnYWRkJywgc3VnZ2VzdGlvbi52YWx1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICAvLyBFbmFibGUgYWRkTmV3QnV0dG9uIGlmIGF0IGxlYXN0IDMgY2hhcmFjdGVycyBhcmUgcHJlc2VudCBpbiB0aGUgaW5wdXQgYm94XHJcbiAgICAgICAgICAgIC5vbigna2V5dXAnLCBmdW5jdGlvbigpIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoJGFkZE5ld0J1dHRvbikge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS52YWwoKS5sZW5ndGggPiAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRhZGROZXdCdXR0b24ucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkYWRkTmV3QnV0dG9uLmF0dHIoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBBZGQgY2xhc3NlcyBmb3Igc3R5bGluZyBwdXJwb3Nlc1xyXG4gICAgICAgICAgICB2YXIgJHRhcmdldF9lbCA9ICRpbnB1dC5wYXJlbnQoJy50d2l0dGVyLXR5cGVhaGVhZCcpLmFkZENsYXNzKCdyb3ctZmx1aWQgYmxvY2snKS5maW5kKCcudHQtbWVudScpO1xyXG4gICAgICAgICAgICAkdGFyZ2V0X2VsLmNzcyh7ZGlzcGxheTogJ2Jsb2NrJ30pO1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ3RhZ3NpbnB1dCAkdGFyZ2V0X2VsJywgJHRhcmdldF9lbC5sZW5ndGgsICR0YXJnZXRfZWwpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBuZXcgVHlwZUFoZWFkcygpO1xyXG4iXX0=
