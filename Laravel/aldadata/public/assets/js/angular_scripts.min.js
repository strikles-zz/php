(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"./app/assets/js/angular/main.js":[function(require,module,exports){
(function (global){
'use strict';

var angular = window.angular;
var _ = window._;

global.App = {

	promoters: {
		app: require('./app.js'),
        filters: require('./filters/index.js'),
		run: require('./config/run.js'),
		router: require('./config/router.js'),
		factories: require('./factories/index.js'),
		directives: require('./directives/index.js'),
		controllers: {
			promoters: require('./controllers/promoters.js'),
			tasks: require('./controllers/tasks.js'),
			tickets: require('./controllers/tickets.js')
		}
	},
	registration: require('./zzz/promoters_registration_app.js')
};

(function() {

    // promoters kb listener
    $(document).on('keypress', function(e) {

        if($('#promoterTickets').length !== 0) {

            var code = e.keyCode || e.which;
            console.log('kb code', code, code === 13);

            if(code === 13) {

                console.log('ppp');
                $('.save-btn').first().trigger('click');
                e.preventDefault();
                e.stopPropagation();

                return false;
            }
        }
    });

})();
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{"./app.js":"/var/www/sites/aldadata/app/assets/js/angular/app.js","./config/router.js":"/var/www/sites/aldadata/app/assets/js/angular/config/router.js","./config/run.js":"/var/www/sites/aldadata/app/assets/js/angular/config/run.js","./controllers/promoters.js":"/var/www/sites/aldadata/app/assets/js/angular/controllers/promoters.js","./controllers/tasks.js":"/var/www/sites/aldadata/app/assets/js/angular/controllers/tasks.js","./controllers/tickets.js":"/var/www/sites/aldadata/app/assets/js/angular/controllers/tickets.js","./directives/index.js":"/var/www/sites/aldadata/app/assets/js/angular/directives/index.js","./factories/index.js":"/var/www/sites/aldadata/app/assets/js/angular/factories/index.js","./filters/index.js":"/var/www/sites/aldadata/app/assets/js/angular/filters/index.js","./zzz/promoters_registration_app.js":"/var/www/sites/aldadata/app/assets/js/angular/zzz/promoters_registration_app.js"}],"/var/www/sites/aldadata/app/assets/js/angular/app.js":[function(require,module,exports){
window.angular.module('promotersApp', ['ngAnimate', 'ngResource', 'ui.router', 'angular.filter', 'ui.bootstrap', 'angularFileUpload', 'highcharts-ng']);

},{}],"/var/www/sites/aldadata/app/assets/js/angular/config/router.js":[function(require,module,exports){
// configuring our routes
// =============================================================================
window.angular.module('promotersApp').config(['$stateProvider', '$urlRouterProvider', '$locationProvider', function($stateProvider, $urlRouterProvider, $locationProvider) {

    'use strict';

    var form = {
        name: 'form',
        templateUrl: 'form.html',
        url: '/my-events',
        controller: 'PromoterController'
    };

    var formEvents = {
        name: 'form.events',
        parent: form,
        templateUrl: 'events.html',
        abstract: true,
        url: '/events'
    };

    var formEventsBtns = {
        name: 'form.events.buttons',
        parent: formEvents,
        templateUrl: 'events_buttons.html',
        url: '/btns',
        data: {
            name: 'events'
        }
    };

    var formEventsRows = {
        name: 'form.events.rows',
        parent: formEvents,
        templateUrl: 'events_rows.html',
        url: '/rows',
        data: {
            name: 'events'
        }
    };

    var formDashboard = {
        name: 'form.dashboard',
        parent: form,
        templateUrl: 'templates/dashboard.html',
        url: '/:eventId/dashboard?taskId',
        controller: function($scope, $stateParams) {

            $scope.taskId = $stateParams.taskId;
        },
        data: {
            name: 'overview'
        }
    };

    var formG1 = {
        name: 'form.group1',
        parent: form,
        templateUrl: 'templates/group1.html',
        url: '/:eventId/group1',
        data: {
            name: '1'
        }
    };

    var formG2 = {
        name: 'form.group2',
        parent: form,
        templateUrl: 'templates/group2.html',
        url: '/:eventId/group2',
        data: {
            name: '2'
        }
    };

    var formG3 = {
        name: 'form.group3',
        parent: form,
        templateUrl: 'templates/group3.html',
        url: '/:eventId/group3',
        data: {
            name: '3'
        }
    };

    var formG4 = {
        name: 'form.group4',
        parent: form,
        templateUrl: 'templates/group4.html',
        url: '/:eventId/group4',
        data: {
            name: '4'
        }
    };

    var formEventDetails = {
        name: 'form.event_details',
        parent: form,
        templateUrl: 'event_details.html',
        abstract: true,
        url: '/:eventId/details',
        data: {
            name: 'event details'
        }
    };

    var formEventVenue = {
        name: 'form.event_venue',
        parent: formEventDetails,
        templateUrl: 'venue.html',
        url: '/venue',
        data: {
            name: 'event venue details'
        }
    };

    var formEventHospitality = {
        name: 'form.event_hospitality',
        parent: formEventDetails,
        templateUrl: 'hospitality.html',
        url: '/hospitality',
        data: {
            name: 'event hospitality details'
        }
    };

    var formEventTickets = {
        name: 'form.tickets',
        parent: form,
        templateUrl: 'tickets.html',
        url: '/:eventId/tickets',
        data: {
            name: 'tickets'
        }
    };

    // unmatched route catcher 
    $urlRouterProvider
        .otherwise('/my-events');

    // nested states
    // each of these sections will have their own view
    // url will be nested (/form/profile)
    $stateProvider
        .state(form)
        .state(formEvents)
        .state(formEventsBtns)
        .state(formEventsRows)
        .state(formDashboard)
        .state(formG1)
        .state(formG2)
        .state(formG3)
        .state(formG4)
        .state(formEventDetails)
        .state(formEventVenue)
        .state(formEventHospitality)
        .state(formEventTickets);


    // HTML5 mode
    $locationProvider.html5Mode({
        enabled: true,
        requireBase: true
    });
}]);


},{}],"/var/www/sites/aldadata/app/assets/js/angular/config/run.js":[function(require,module,exports){
window.angular.module('promotersApp').run(['$http', '$log', '$rootScope', '$templateCache', '$timeout', 'eventsService',
    function($http, $log, $rootScope, $templateCache, $timeout, eventsService) {

    'use strict';

    // get templates
    $http.get('masters3.html', {

        cache: $templateCache

    }).then(function(result) {

        console.log('res', result);

        var dashboard_html = result.data;
        var dashboard_h = dashboard_html.replace('%GROUP_TASKS%', '$root.promoter_events[$root.event_ndx].tasks').replace('%LIMIT_FILTER%', '| limitTo:$root.max_items');
        $templateCache.put("templates/dashboard.html", dashboard_h);

        var tour_html = result.data;
        var tour_h = tour_html.replace('%GROUP_TASKS%', '$root.promoter_events[$root.event_ndx].cat_tasks.group_1').replace('%LIMIT_FILTER%', '');
        $templateCache.put("templates/group1.html", tour_h);

        var technical_html = result.data;
        var technical_h = technical_html.replace('%GROUP_TASKS%', '$root.promoter_events[$root.event_ndx].cat_tasks.group_2').replace('%LIMIT_FILTER%', '');
        $templateCache.put("templates/group2.html", technical_h);

        var marketing_html = result.data;
        var marketing_h = marketing_html.replace('%GROUP_TASKS%', '$root.promoter_events[$root.event_ndx].cat_tasks.group_3').replace('%LIMIT_FILTER%', '');
        $templateCache.put("templates/group3.html", marketing_h);

        var travel_html = result.data;
        var travel_h = travel_html.replace('%GROUP_TASKS%', '$root.promoter_events[$root.event_ndx].cat_tasks.group_4').replace('%LIMIT_FILTER%', '');
        $templateCache.put("templates/group4.html", travel_h);
    });

    /////////////
    // GLOBALS //
    /////////////

    $rootScope.cats                 = undefined;
    $rootScope.invalid_event_id     = false;
    $rootScope.event_ndx            = 0;
    $rootScope.max_items            = 5;
    $rootScope.active_dashboard_btn = false;
    $rootScope.active_event_btn     = false;
    $rootScope.active_venue_btn     = false;
    $rootScope.active_tickets_btn   = false;

    $rootScope.promoter_events      = undefined;
    $rootScope.num_events           = 0;

    $rootScope.today =              new Date();

    $rootScope.cleanActiveDetailsBtns = function() {

        $log.log('clearing...');

        $rootScope.active_dashboard_btn = false;
        $rootScope.active_event_btn     = false;
        $rootScope.active_venue_btn     = false;
        $rootScope.active_tickets_btn   = false;
    };


    $rootScope.getCats = function() {

        $('.backdrop').css('display', 'none');
        eventsService.getServerData('/api/v1/my-events/cats').then(function(cats) {
            $rootScope.cats = cats;
        });
    };

    $rootScope.initData = function(cb) {

        $('.backdrop').css('display', 'block');
        eventsService.getServerData('/api/v1/my-events').then(function(evs) {

            $rootScope.promoter_events = evs;
            $rootScope.num_events      = $rootScope.promoter_events.length;

            $log.log('InitData', $rootScope.promoter_events, 'callback', cb);
            if(cb) {
                $log.log('running cb');
                cb();
            }

            $('.backdrop').css('display', 'none');
        });
    };

    $timeout(function(){
        var cb = $rootScope.getCats();
        $rootScope.initData(cb);
    });

}]);


},{}],"/var/www/sites/aldadata/app/assets/js/angular/controllers/promoters.js":[function(require,module,exports){
// main controller
// =============================================================================
window.angular.module('promotersApp').controller('PromoterController', ['$rootScope', '$scope', '$state', '$modal', '$log', '$http','$timeout', 'eventsService', function ($rootScope, $scope, $state, $modal, $log, $http, $timeout, eventsService) {

    'use strict';

    var angular = window.angular;
    var _       = window._;

    // vars
    $scope.event_id                 = undefined;

    $scope.$state                   = $state;
    $scope.show_rows                = true;
    $scope.show_buttons             = false;
    $scope.obj                      = undefined;

    $scope.venueData                = { curfew: new Date(1970, 0, 1, 0, 0, 0) };
    $scope.hospitalityData          = {};

    $scope.ev_dt_setup              = undefined;
    $scope.ev_dt_break              = undefined;
    $scope.info_complete            = true;

    $scope.selected_event           = undefined;

    // state change event watcher
    $rootScope.$on('$stateChangeStart', function (event, nextState, currentState) {
        $log.log('$state change', event, $state.params, nextState, currentState);
    });



    $scope.setEvent = function(event_id) {

        // find the item in the array
        var new_selected = _.filter($rootScope.promoter_events , function(item) {
            $log.log('setEvent filter', item.event.id, event_id, item.event.id === event_id);
            if (parseInt(item.event.id, 10) === parseInt(event_id, 10)) {

                $rootScope.invalid_event_id = false;
                return item;
            }
        });

        // get the index
        if(new_selected.length) {

            $scope.selected_event = new_selected[0];
            $scope.event_id       = event_id;
            $rootScope.event_ndx  = _.indexOf($rootScope.promoter_events , $scope.selected_event);

            $log.log('setEvent '+event_id+' found', $scope.selected_event, 'ndx', $rootScope.event_ndx);
            $scope.setFormdata();

            if($scope.selected_event) {
                $log.log($scope.selected_event.event, $scope.selected_event.event.curfew, $scope.selected_event.event.minimal_age_limit);
                $scope.info_complete = $scope.venueData.curfew !== "" && $scope.venueData.minimal_age_limit !== "";
            }

            return;

        } else {

            //$scope.info_complete = false;
            $rootScope.invalid_event_id = true;
            $log.log('ERROR: event ndx NOT FOUND');
        }
    };

    /////////////
    // SETTERS //
    /////////////
    $rootScope.selectEvent = function(event_id, transition_view) {

        $rootScope.cleanActiveDetailsBtns();
        $scope.setEvent(event_id);

        $log.log('Setting Event', $scope.info_complete);
    };

    $scope.selectEventView = function(view, event_id) {

        $rootScope.cleanActiveDetailsBtns();
        if(event_id) {
            $scope.setEvent(event_id);
        }


        $log.log('event id', $scope.event_id, event_id);
        if(!$scope.info_complete) {
            $log.log('info_incomplete');
            $state.transitionTo('form.event_venue', {eventId: event_id});
        } else if($scope.event_id) {
            $state.transitionTo(view, {eventId: $scope.event_id});
        } else {
            $state.transitionTo(view);
        }

        if(view !== "form.dashboard" && !$state.params.taskId) {
            $(".form-container").scrollTop(0);
        }
    };

    $scope.aldaSelectEventView = function(view, event_id) {

        $rootScope.cleanActiveDetailsBtns();
        if(event_id) {
            $scope.setEvent(event_id);
        }

        $log.log('event id', $scope.event_id, event_id);
        if($scope.event_id) {
            $state.transitionTo(view, {eventId: $scope.event_id});
        } else {
            $state.transitionTo(view);
        }
    };

    $scope.init = function() {

        //the code which needs to run after dom rendering
        $log.log('state params', $state.params);
        if ($state.params.hasOwnProperty('eventId')) {
            $log.log('init $state.params.eventId -> event_id', $scope.event_id);
            $scope.event_id = $state.params.eventId;
        }

        // clear form + tickets buttons
        $rootScope.cleanActiveDetailsBtns();

        if ($scope.event_id) {
            $log.log('init setEvent event_id', $scope.event_id);
            $scope.setEvent($scope.event_id);
        }


        // expand for task urls
        if($state.params.taskId && $rootScope.promoter_events && $rootScope.cats) {

            // expand dashboard to get all tasks
            $rootScope.max_items = $rootScope.promoter_events[$rootScope.event_ndx].tasks.length;

            // find the task
            var $task = $('#task_'+$state.params.taskId);

            if($task.length) {

                var $el = $(".form-container");

                var $entry_details  = $task.closest('.entry_container').find('.entry_details');
                var details_display = $entry_details.css('display');

                //$('body').find('.entry_details').slideUp();
                $('body').find('.entry').css('color', '#555');
                $task.css('color', '#000');

                // make content large enough tp scroll in case task is at bottom
                var original_content_height = $('.content_host').height();
                $('.content_host').height(original_content_height + $('#promotersRoot').height());

                // find the task offset from the top
                console.log('task_top_offset', $task.offset().top, $el.offset().top);

                // scroll to the task
                $el.scrollTop($task.offset().top - $el.offset().top);

                $entry_details.slideDown();
            }
        }
    };

    $scope.showStatusBtns = function() {

        return $state.current.name === 'form.dashboard' ||
                $state.current.name === 'form.group1' ||
                $state.current.name === 'form.group2' ||
                $state.current.name === 'form.group3' ||
                $state.current.name === 'form.group4';

    };

    $scope.getSName = function() {

        if(!$state.current.hasOwnProperty('data') || !$state.current.data.hasOwnProperty('name')) {

            $log.log('state is missing data property');
            return '';
        }

        if ($state.current.name !== 'form.group1' &&
            $state.current.name !== 'form.group2' &&
            $state.current.name !== 'form.group3' &&
            $state.current.name !== 'form.group4') {

            return $state.current.data.name;

        } else {

            if($rootScope.cats && $rootScope.cats.length > 0) {

                $log.log('getSName cats exist');

                // its or strings id's D:
                var cat_item = _.findWhere($rootScope.cats, {id: parseInt($state.current.data.name, 10)});
                if(cat_item) {
                    $log.log('getSName - found int cat', cat_item);
                    return cat_item.name;
                } else {
                    cat_item = _.findWhere($rootScope.cats, {id: $state.current.data.name});
                    if(cat_item) {
                        $log.log('getSName - found string cat', cat_item);
                        return cat_item.name;
                    }
                }
            }
        }
    };

    $scope.setFormdata = function() {

        var exploded_curfew = $rootScope.promoter_events[$rootScope.event_ndx].event.curfew.split(':');
        if(exploded_curfew.length > 1) {

            var curfew_hour = parseInt(exploded_curfew[0], 10);
            var curfew_min = parseInt(exploded_curfew[1].split('.')[0], 10);

            if(curfew_hour >= 0 && curfew_hour < 24 && curfew_min >= 0 && curfew_min < 60) {
                $scope.venueData.curfew = new Date(1970, 0, 1, curfew_hour, curfew_min, 0);
            } else {
                $scope.venueData.curfew = new Date(1970, 0, 1, 0, 0, 0);
            }
        }

        $scope.venueData.minimal_age_limit                     = $rootScope.promoter_events[$rootScope.event_ndx].event.minimal_age_limit;
        $scope.venueData.alcohol_license                       = $rootScope.promoter_events[$rootScope.event_ndx].event.alcohol_license;
        $scope.venueData.restrictions_on_merchandise_sales     = $rootScope.promoter_events[$rootScope.event_ndx].event.restrictions_on_merchandise_sales;
        $scope.venueData.sound_restrictions                    = $rootScope.promoter_events[$rootScope.event_ndx].event.sound_restrictions;

        // booked for setup from
        if($rootScope.promoter_events[$rootScope.event_ndx].event.booked_for_setup_from === "0000-00-00")
        {
            var yyyy = $rootScope.today.getFullYear().toString();
            var mm   = ($rootScope.today.getMonth()+1).toString();
            var dd   = $rootScope.today.getDate().toString();

            $scope.venueData.booked_for_setup_from = yyyy+'-'+(mm[1]?mm:"0"+mm[0])+'-'+(dd[1]?dd:"0"+dd[0]); // padding
        }
        else
        {
            $scope.venueData.booked_for_setup_from = $rootScope.promoter_events[$rootScope.event_ndx].event.booked_for_setup_from;
        }

        // booked for break until
        if($rootScope.promoter_events[$rootScope.event_ndx].event.booked_for_break_until === "0000-00-00")
        {
            $scope.venueData.booked_for_break_until = undefined;
        }
        else
        {
            $scope.venueData.booked_for_break_until = $rootScope.promoter_events[$rootScope.event_ndx].event.booked_for_break_until;
        }

        $scope.hospitalityData.hotel1_name                     = $rootScope.promoter_events[$rootScope.event_ndx].event.hotel1_name;
        $scope.hospitalityData.hotel1_website                  = $rootScope.promoter_events[$rootScope.event_ndx].event.hotel1_website;
        $scope.hospitalityData.hotel1_travel_time_from_airport = $rootScope.promoter_events[$rootScope.event_ndx].event.hotel1_travel_time_from_airport;
        $scope.hospitalityData.hotel1_travel_time_from_venue   = $rootScope.promoter_events[$rootScope.event_ndx].event.hotel1_travel_time_from_venue;
        $scope.hospitalityData.hotel2_name                     = $rootScope.promoter_events[$rootScope.event_ndx].event.hotel2_name;
        $scope.hospitalityData.hotel2_website                  = $rootScope.promoter_events[$rootScope.event_ndx].event.hotel2_website;
        $scope.hospitalityData.hotel2_travel_time_from_airport = $rootScope.promoter_events[$rootScope.event_ndx].event.hotel2_travel_time_from_airport;
        $scope.hospitalityData.hotel2_travel_time_from_venue   = $rootScope.promoter_events[$rootScope.event_ndx].event.hotel2_travel_time_from_venue;
    };

    $scope.registrationSubmission = function(type, state) {

        // type is what we are submitting, state is where we are going
        var post_url, post_data;
        var el        = document.getElementById("promotersRoot");
        var token_str = angular.element(el).data('token');

        var ndx;
        switch(type) {
            case 'venue':
                post_url  = "/my-events/"+$scope.event_id+"/details/venue";
                post_data = angular.extend({}, {_token: token_str}, $scope.venueData);
                var adjusted_date = new Date($scope.venueData.curfew.getTime() - $scope.venueData.curfew.getTimezoneOffset() * 60000);
                post_data.curfew = adjusted_date;
                ndx = 1;
                break;
            case 'hospitality':
                post_url  = "/my-events/"+$scope.event_id+"/details/hospitality";
                post_data = angular.extend({}, {_token: token_str}, $scope.hospitalityData);
                ndx = 2;
                break;
            default:
                break;
        }

        eventsService.postServerData(post_url, post_data).then(function(data) {

            $log.log('posted '+type+' to '+post_url, post_data, data === 'OK');
            if(data === 'OK')
            {
                $scope.info_complete = true;

                $log.log("state", state);
                //$scope.selectEventView(state, $scope.event_id);
                $state.transitionTo(state, {eventId: $scope.event_id});
                //$rootScope.initData();
            }
        });
    };

    $scope.goBack = function(type, state) {

        var ndx;
        switch(type) {
            case 'overview':
                ndx = 2;
                break;
            case 'hospitality':
                ndx = 1;
                break;
            case 'venue':
                ndx = 0;
                break;
            default:
                break;
        }

        $log.log(type, ndx);

        // overview is max atm = 4
        if(ndx < 4 && ndx > 0) {

            $(".progress_bar li").eq(ndx).removeClass("active");

            // if validation ok go to next
            $scope.selectEventView(state);
        }
    };

    //////////
    // JUNK //
    //////////
    $scope.setMaxTasks = function() {

        if($rootScope.max_items < $rootScope.promoter_events[$rootScope.event_ndx].tasks.length) {
            $rootScope.max_items = $rootScope.promoter_events[$rootScope.event_ndx].tasks.length;
        } else {
            $rootScope.max_items = 5;
            $(".form-container").scrollTop(0);
            $log.log('>>>> new js');
        }
    };

    // switch between event rows and event btns views
    $scope.toggleView = function(type)
    {
        if(type === 'rows') {

            $scope.show_rows = true;
            $scope.show_buttons = false;

            $('.view-sel').removeClass('active');
            $('.list-sel').addClass('active');

        } else {

            $scope.show_rows = false;
            $scope.show_buttons = true;

            $('.view-sel').removeClass('active');
            $('.btn-sel').addClass('active');
        }
    };

    $scope.getEventCompletionString = function(ev)
    {
        if(!ev) {
            return '0/0';
        }

        var done  = ev.details.completion.group1.completed + ev.details.completion.group2.completed + ev.details.completion.group3.completed + ev.details.completion.group4.completed;
        var total = ev.details.completion.group1.total + ev.details.completion.group2.total + ev.details.completion.group3.total + ev.details.completion.group4.total;

        return done+" / "+total;
    };

    $scope.eventsExist = function() {

        $log.log('num_events', $rootScope.promoter_events .length);
    };

    $scope.tasksRemaining = function() {

        if($rootScope.promoter_events === undefined || !$rootScope.promoter_events.length) {
            return 0;
        }

        var group1_remaining = $rootScope.promoter_events[$rootScope.event_ndx].details.completion.group1.total - $rootScope.promoter_events[$rootScope.event_ndx].details.completion.group1.completed;
        var group2_remaining = $rootScope.promoter_events[$rootScope.event_ndx].details.completion.group2.total - $rootScope.promoter_events[$rootScope.event_ndx].details.completion.group2.completed;
        var group3_remaining = $rootScope.promoter_events[$rootScope.event_ndx].details.completion.group3.total - $rootScope.promoter_events[$rootScope.event_ndx].details.completion.group3.completed;
        var group4_remaining = $rootScope.promoter_events[$rootScope.event_ndx].details.completion.group4.total - $rootScope.promoter_events[$rootScope.event_ndx].details.completion.group4.completed;

        return group1_remaining + group2_remaining + group3_remaining + group4_remaining;
    };

    // notifications modal
    $scope.openNotificationsModal = function (task, email_obj, size) {

        $scope.email_obj = email_obj;

        $modal.open({
            templateUrl: 'myModalContent.html',
            backdrop: true,
            windowClass: 'ngmodal',
            controller: function ($scope, $modalInstance, $log, email_obj) {

                $scope.email_obj = email_obj;

                $modalInstance.opened.then(function() {
                    // var e = $.Event( "ngModalOpen", { data: '' });
                    // $log.log('>>> event triggered');
                    // $(window).trigger(e);

                    $timeout(function() {
                        var windowHeight = $(window).height() ? $(window).height() : window.innerHeight,
                            top_offset = (windowHeight/2) - 210;
                        $log.log('>> OFFSET', top_offset);
                        $('.modal-content').css({
                            top: top_offset
                        });
                    });

                    $(window).resize(function() {

                        $log.log('Valid resize ???', ($(window).height()/2) - 210);
                        $('.modal-content').css({
                            top: function() {
                                return ($(window).height()/2) - 210;
                            }
                        });
                    });
                });

                $scope.ok = function () {

                    // resolve promise and get all the things
                    eventsService.postServerData('/api/v1/my-events/'+task.info.events_id+'/tasks/'+task.info.id+'/email', {email_subject: email_obj.subject, email_content: email_obj.message}).then(function() {
                        $log.log("Notification sent...");
                    });

                    $modalInstance.dismiss('cancel');
                };

                $scope.cancel = function () {
                    $modalInstance.dismiss('cancel');
                };
            },
            resolve: {
                email_obj: function() {
                    return $scope.email_obj;
                }
            }
        });

    };

    $scope.str2Date = function(date){

        if(!date) {
            return new Date();
        }

        var ed         = date.replace(/-/g, "/");
        var event_date = new Date(ed);

        return event_date;
    };

    $scope.daysLeft = function(deadline) {

        // num days left till task deadline
        if(!deadline) {
            return -1;
        }

        var today      = new Date();
        var ed         = deadline.replace(/-/g, "/");
        var event_date = new Date(ed);
        var days_diff  = Math.round( (event_date.getTime()-today.getTime()) / (24*60*60*1000) );

        return days_diff;
    };


    /////////
    // CSS //
    /////////
    $scope.getEventDeadlineClass = function(due_date)
    {
        if(!due_date) {
            return '';
        }

        var days_left  = $scope.daysLeft(due_date);

        var urgency_class = "urgency_green";
        if(days_left < 15) {
            urgency_class = "urgency_red";
        } else if(days_left < 20) {
            urgency_class = "urgency_yellow";
        }

        return urgency_class;
    };

    $scope.getActive = function(type)
    {
        if(type === 'rows') {
            return $scope.show_rows ? 'active' : '';
        } else if(type === 'btns') {
            return $scope.show_buttons ? 'active' : '';
        }

        return '';
    };

    $scope.getCompletionBarCSS = function(tg) {

        if(!tg) {
            return {width: '0%'};
        }

        var total = tg.total;
        var done  = tg.completed;
        var perc  = (total <= 0 ? 100 : 100*(done/total));

        return {width: perc+'%'};
    };

    $scope.getEventCompletionCSS = function(ev)
    {
        if(!ev) {
            return {width: '0%'};
        }

        var done  = ev.details.completion.group1.completed + ev.details.completion.group2.completed + ev.details.completion.group3.completed + ev.details.completion.group4.completed;
        var total = ev.details.completion.group1.total + ev.details.completion.group2.total + ev.details.completion.group3.total + ev.details.completion.group4.total;
        var perc  = (total <= 0 ? 100 : 100*(done/total));

        return {width: perc+'%'};
    };

    var waitForRenderAndDoSomething = function() {

      if($http.pendingRequests.length > 0) {

          $timeout(waitForRenderAndDoSomething); // Wait for all templates to be loaded

      } else {

        //the code which needs to run after dom rendering
        $scope.init();
        if($('#promotersRoot').length) {

            if($state.current.name === 'form') {
                if($(".default-btns").length) {
                    $state.transitionTo('form.events.buttons');
                }
                else {
                    $state.transitionTo('form.events.rows');
                }
            }
        }
      }
    };
    $timeout(waitForRenderAndDoSomething); // Waits for first digest cycle
}]);


},{}],"/var/www/sites/aldadata/app/assets/js/angular/controllers/tasks.js":[function(require,module,exports){
// Task Controller for per task isolated scoping
window.angular.module('promotersApp').controller('TaskController', ['$scope', '$rootScope', '$state', '$modal', '$log', '$upload', 'eventsService', function ($scope, $rootScope, $state, $modal, $log, $upload, eventsService) {

    'use strict';

    var _ = window._;

    $scope.itask              = undefined;
    $scope.ifiles             = undefined;
    $scope.comment            = "";
    $scope.completion_status  = true;
    $scope.active_status      = true;

    $scope.progressPercentage = 0;
    $scope.uploadsComplete    = true;
    $scope.s3                 = { policy: "", signature: "" };

    $scope.datepicker_open    = false;

    $scope.$watch('ufiles', function () {
        $scope.upload($scope.ufiles);
    });

    // files
    $scope.downloadFile = function(fileID) {

        $.ajax({
            url: '/taskfiles/' + fileID + '/url',
            method: 'GET',

            success : function(response) {

                console.log(response);

                    var downloadURL = function downloadURL(response) {
                        var hiddenIFrameID = 'hiddenDownloader',
                            iframe = document.getElementById(hiddenIFrameID);
                        if (iframe === null) {
                            iframe = document.createElement('iframe');
                            iframe.id = hiddenIFrameID;
                            iframe.style.display = 'none';
                            document.body.appendChild(iframe);
                        }

                        iframe.src = response;
                    };

                    var download = new downloadURL(response);
            }
        });
    };

    $scope.renameFile = function(file) {

        var curr_timestamp = new Date().getTime();
        var curr_day       = new Date().getDate();
        var random_str     = Math.random().toString(36).substr(8);

        return curr_day+'-'+random_str+'-'+file.name;
    };

    $scope.upload = function(files)
    {
        //$log.log('lll', $scope.s3policy, $scope.s3signature);
        if (files && files.length)
        {
            $('#task_'+$scope.itask.info.id+' .taskfile_progress').show();

            $scope.uploadsComplete = false;
            for (var i = 0; i < files.length; i++)
            {
                $scope.progressPercentage = 0;

                var file          = files[i];
                var new_file_name = $scope.renameFile(file);

                // use me
                var dir_prefix = 'events/'+$scope.itask.info.events_id;
                $log.log('file', file);

                $upload.upload({
                    url: "https://alda-promoters.s3-eu-west-1.amazonaws.com/",  //S3 upload url including bucket name
                    method: 'POST',
                    fields : {
                        key: 'files/'+dir_prefix+'/'+new_file_name,             // the key to store the file on S3, could be file name or customized
                        AWSAccessKeyId: "AKIAJ5YGKDS3CH3BT2MA",
                        acl: 'public-read',                                     // sets the access to the uploaded file in the bucket: private or public
                        success_action_status: "201",
                        policy: $scope.s3.policy,                               // base64-encoded json policy (see article below)
                        signature: $scope.s3.signature,                         // base64-encoded signature based on policy string (see article below)
                        "Content-Type": file.type !== '' ? file.type : "application/octet-stream", // content type of the file (NotEmpty)
                        name: new_file_name,
                        Filename: 'files/'+dir_prefix+'/'+new_file_name,        // this is needed for Flash polyfill IE8-9
                    },
                    file: file

                }).progress(function (evt) {

                    $scope.progressPercentage = parseInt(100.0 * evt.loaded / evt.total);
                    $('#task_'+$scope.itask.info.id+' .progress-bar').width($scope.progressPercentage+'%');

                    var selector = '#task_'+$scope.itask.info.id;
                    var prog_selector = '#task_'+$scope.itask.info.id+' .progress-bar';

                    $log.log('progress: ' + $scope.progressPercentage + '% ' + evt.config.file.name, selector, prog_selector, $(selector).length, $(prog_selector).length);

                }).success(function (data, status, headers, config) {

                    // resolve promise and get all the things
                    eventsService.postServerData('/api/v1/my-events/'+$scope.itask.info.events_id+'/tasks/'+$scope.itask.info.id+'/s3upload', {path: new_file_name, original_name: file.name}).then(function() {

                        $log.log("File uploaded...");
                        $scope.getTask($scope.itask.info.id);
                        $scope.progressPercentage = 0;
                        $scope.uploadsComplete = true;
                        $('#task_'+$scope.itask.info.id+' .progress-bar').width(0);
                        $('#task_'+$scope.itask.info.id+' .taskfile_progress').hide();
                    });

                    $log.log('file ' + config.file.name + 'uploaded. Response: ' + data);
                });
            }
        }
    };

    $scope.getProgressWidth = function() {

        return "{width: (progressPercentage * 100)%}";
    };

    $scope.deleteFile = function(file, task_id) {

        eventsService.postServerData('/taskfiles/'+file.id+'/delete').then(function(data) {
            $scope.getTask(task_id);
        });
    };

    // tasks
    $scope.setItask = function(task) {

        //$log.log(task);
        $scope.itask   = task;
        $scope.comment = $scope.itask.info.comment;
        $scope.ifiles  = $scope.itask.files;
    };

    $scope.getTask = function(task_id) {

        $('.backdrop').css('display', 'block');
        eventsService.getServerData('/api/v1/my-events/tasks/'+task_id).then(function(response) {

            $log.log('getTask', response, task_id);

            // get the item in the array
            var new_selected = _.filter($rootScope.promoter_events[$rootScope.event_ndx].tasks, function(item){
                if (item.info.id === task_id) {
                    return item;
                }
            });

            if(new_selected.length) {

                // get the index
                var task_ndx = _.indexOf($rootScope.promoter_events[$rootScope.event_ndx].tasks, new_selected[0]);
                // inject the task files in the global object
                $rootScope.promoter_events[$rootScope.event_ndx].tasks[task_ndx].files = response[0].files;
                $rootScope.promoter_events[$rootScope.event_ndx].tasks[task_ndx].info  = response[0].info;

                $log.log('task ndx found at: '+task_ndx);

                // same for cats
                var task_cat = new_selected[0].info.group_id;
                var cat_tasks;

                // same for cats
                var new_cat_selected = _.filter($rootScope.promoter_events[$rootScope.event_ndx].cat_tasks['group_'+task_cat], function(item){
                    if (item.info.id === task_id) {
                        return item;
                    }
                });

                var task_cat_ndx = _.indexOf($rootScope.promoter_events[$rootScope.event_ndx].cat_tasks['group_'+task_cat], new_cat_selected[0]);
                $log.log('task cat_ndx found at: '+task_cat_ndx, new_cat_selected[0]);

                if (task_cat_ndx !== -1) {
                    $rootScope.promoter_events[$rootScope.event_ndx].cat_tasks['group_'+task_cat][task_cat_ndx].files = response[0].files;
                    $rootScope.promoter_events[$rootScope.event_ndx].cat_tasks['group_'+task_cat][task_cat_ndx].info  = response[0].info;
                }

            } else {

                $log.log('ERROR: task ndx NOT FOUND');

            }

            // find task in global storage
            $scope.itask   = response[0];
            $scope.comment = $scope.itask.info.comment;
            $scope.ifiles  = $scope.itask.files;

            $('.backdrop').css('display', 'none');
        });
    };

    // comments
    $scope.saveComment = function() {

        eventsService.postServerData('/api/v1/my-events/'+$scope.itask.info.events_id+'/tasks/'+$scope.itask.info.id+'/comment', {comment_content: $scope.comment}).then(function(response) {

            $log.log('saveCommentresponse', response);
            $scope.getTask($scope.itask.info.id);
        });
    };

    $scope.setActive = function($event) {

        $event.stopPropagation();
        eventsService.postServerData('/api/v1/my-events/'+$scope.itask.info.events_id+'/tasks/'+$scope.itask.info.id+'/active', {active_status: $scope.active_status}).then(function(response) {

            $log.log('setActive response', response);

            $scope.getTask($scope.itask.info.id);
        });
    };

    $scope.setStatus = function($event) {

        $event.stopPropagation();
        eventsService.postServerData('/api/v1/my-events/'+$scope.itask.info.events_id+'/tasks/'+$scope.itask.info.id+'/status', {task_status: $scope.completion_status}).then(function(response) {

            $log.log('setStatus response', response);

            //$scope.getTask($scope.itask.info.id);
            $rootScope.initData();
        });
    };

    // hide show task details
    $scope.toggleDetails = function(task) {

        if ($scope.datepicker_open){
            return false;
        }

        var $selected_row   = $('#task_'+task.info.id);
        var $entry_details  = $selected_row.closest('.entry_container').find('.entry_details');
        var details_display = $entry_details.css('display');
        if(details_display === 'none')
        {
            $('body').find('.entry_details').slideUp();
            $('body').find('.entry').css('color', '#555');
            $selected_row.css('color', '#000');
            $entry_details.slideDown();
        }
        else
        {
            $entry_details.slideUp();
        }
    };

    $scope.getTaskOpacity = function(status) {

        return (status === 'complete' ? {opacity: 0.4} : {opacity: 1});
    };

    $scope.catName = function(cat_id) {

        var ret = _.findWhere($rootScope.cats, {id: cat_id});
        return ret ? ret.name : '';
    };

    $scope.getBadgeCSS = function(logged, updated) {

        // return css class for coloring
        //$log.log('getBadgeCSS', logged, updated);
        if(logged === updated) {
            return "same_user";
        }

        return "diff_user";
    };

    $scope.getDeadlineClass = function(due_date) {

        var days_left = $scope.daysLeft(due_date);

        var urgency_class = "urgency_green";
        if(days_left < 15)
        {
            urgency_class = "urgency_red";
        }
        else if(days_left < 20)
        {
            urgency_class = "urgency_yellow";
        }

        return urgency_class;
    };

    // FIXME
    $scope.selectDate = function(date_txt) {

        $log.log('selected date', $scope.dt);
        var parsed_date, parsed_date_str;

        if(date_txt) {
            parsed_date_str = date_txt;
        } else {
            parsed_date = new Date($scope.dt);
            parsed_date_str = parsed_date.getFullYear()+'-'+(parsed_date.getMonth()+1)+'-'+parsed_date.getDate();
        }

        // resolve promise and get all the things
        eventsService.postServerData('/api/v1/my-events/'+$scope.itask.info.events_id+'/tasks/'+$scope.itask.info.id+'/due_date', {selected_date: parsed_date_str}).then(function() {
            $log.log("Task deadline set...", $scope.dt);
            $rootScope.initData();
        });
    };

    // FIXME
    $scope.convertDate = function(date_val) {

        var exploded_date = date_val.split('-');
        var ret = exploded_date[2]+'-'+exploded_date[1]+'-'+exploded_date[0];

        return ret;
    };


}]);


},{}],"/var/www/sites/aldadata/app/assets/js/angular/controllers/tickets.js":[function(require,module,exports){
window.angular.module('promotersApp').controller('TicketController', ['$scope', '$rootScope', '$state', '$modal', '$log', '$upload', 'eventsService', function ($scope, $rootScope, $state, $modal, $log, $upload, eventsService) {

    'use strict';

    var _       = window._;
    var angular = window.angular;

    $scope.selectedWeek    = 0;
    $scope.selectedYear    = new Date().getFullYear();
    $scope.editor_expanded = [];
    $scope.ticket_sales    = [];

    $scope.grouped_tickets = [];
    $scope.last_n_weeks    = null;
    $scope.num_items       = 0;
    $scope.slice_start     = undefined;
    $scope.slice_end       = undefined;

    $scope.grand_total_cnt = 0;
    $scope.grand_total_amt = 0;

    $scope.onlyNumbers = /^\d+$/;

    $scope.chart = null;
    $scope.highcharts_config = {
        chart: {
            renderTo: 'hccontainer',
        },
        tooltip: {
            crosshairs: true,
            shared: true
        },
        plotOptions: {
            line: {
                marker: {
                    enabled: false
                }
            },
            spline: {
                marker: {
                    enabled: false
                }
            }
        },
        xAxis: {
            title: {
                text: 'week'
            },
            tickInterval: 1
        },
        yAxis: [{ // Primary yAxis
            title: {
                text: 'Number Tickets Sold'
            },
            type: 'linear',
            min: 0
        }, { // Secondary yAxis
            title: {
                text: 'Tickets Sold Revenue'
            },
            type: 'linear',
            opposite: true
        }],
        series: [],
        title: {
            text: 'Ticket Sales'
        },
        loading: false
    };

    // generic
    $scope.init = function() {

        if($scope.promoter_events && $scope.promoter_events.length) {

            // $rootScope.setEvent($state.params.eventId);
            $log.log('Running tickets controller init');

            // editor expanded
            var tickets_weekly_entries = $scope.promoter_events[$rootScope.event_ndx].tickets;
            for(var weekly_ndx = 0; weekly_ndx < tickets_weekly_entries.length; weekly_ndx++) {
                $scope.editor_expanded[weekly_ndx] = false;
            }

            // slice tickets into groups of 6 weeks pages
            if($('#promoterTickets').length > 0) {

                $scope.num_items = $scope.promoter_events[$rootScope.event_ndx].tickets.length;
                if($scope.slice_start === undefined) {
                    $scope.slice_start = Math.max($scope.num_items - 6, 1);

                }

                $log.log('SS', $scope.slice_start);
                if($scope.slice_end === undefined) {
                    $scope.slice_end = $scope.promoter_events[$rootScope.event_ndx].tickets.length;
                    $log.log('SEU', $scope.slice_end);
                } else {
                    $scope.slice_end = $scope.slice_start + Math.min(6, $scope.num_items);
                    $log.log('SE', $scope.slice_end);
                }

                $scope.nonav = ($scope.num_items < 6);
                $log.log('num_items', $scope.num_items);

                $scope.last_n_weeks = $scope.promoter_events[$rootScope.event_ndx].tickets.slice($scope.slice_start, $scope.slice_end);
                $scope.curr_page = 0;
            }
        }

        // alda view
        if($('#aldaTickets').length > 0) {
            $scope.initHighCharts();
            $scope.calcGrandTotal();
        }
    };

    $scope.initHighCharts = function() {

        // highcharts points
        $scope.highcharts_config.series = [];

        var tickets_yearly_summary = $scope.promoter_events[$rootScope.event_ndx].tickets_yearly;

        var yearly_ndx = 0;
        for(yearly_ndx = 0; yearly_ndx < tickets_yearly_summary.length; yearly_ndx++) {

            //$log.log('highcharts yearly entry' tickets_yearly_summary[yearly_ndx]);
            $scope.highcharts_config.series.push({ name: '# '+tickets_yearly_summary[yearly_ndx].name,
                                                    yAxis: 0,
                                                    type: 'line',
                                                    zIndex: 2,
                                                    data: tickets_yearly_summary[yearly_ndx].points});
        }

        $scope.highcharts_config.series.push({ name: 'Revenue ',
                                yAxis: 1,
                                type: 'column',
                                zIndex: 1,
                                data: $scope.promoter_events[$rootScope.event_ndx].global_sales.points,
                                dashStyle: 'dash'});

        // $scope.highcharts_config.series.push({ name: 'Cumulative $ ',
        //                         yAxis: 1,
        //                         type: 'line',
        //                         data: $scope.promoter_events[$rootScope.event_ndx].global_sales.cum_points,
        //                         dashStyle: 'dash'});

        if($scope.chart) {
            $scope.chart.destroy();
        }

        $scope.chart = new window.Highcharts.Chart($scope.highcharts_config);

        $log.log('highcharts series', $scope.highcharts_config.series);
    };

    $scope.calcGrandTotal = function() {

        $scope.grand_total_cnt = 0;
        $scope.grand_total_amt = 0;
        var tickets_yearly_summary = $scope.promoter_events[$rootScope.event_ndx].tickets_yearly;
        for(var yearly_ndx = 0; yearly_ndx < tickets_yearly_summary.length; yearly_ndx++) {

            $scope.grand_total_cnt += tickets_yearly_summary[yearly_ndx].num_sold;
            $scope.grand_total_amt += tickets_yearly_summary[yearly_ndx].amt;
        }
    };

    $scope.getCurrency = function() {

        //$log.log('promoter_events', $scope.promoter_events, 'event ndx', $rootScope.event_ndx);
        if($scope.promoter_events && $rootScope.event_ndx !== undefined) {

            var currency_id    = $scope.promoter_events[$rootScope.event_ndx].event.currency_id;
            var currencies     = $scope.promoter_events[$rootScope.event_ndx].currencies;
            var currency_entry = _.findWhere(currencies, {id: currency_id});

            if(currency_entry) {
                return currency_entry.symbol;
            }
        }

        return "?";
    };

    // promoters nav
    $scope.promotersNextWeek = function() {

        if($scope.nonav) {
            return;
        }

        if($scope.slice_end < $scope.num_items) {

            $scope.slice_start  += 1;
            $scope.slice_end    += 1;
            $scope.last_n_weeks = $scope.promoter_events[$rootScope.event_ndx].tickets.slice($scope.slice_start, $scope.slice_end);
        }
    };

    // promoters nav
    $scope.promotersPrevWeek = function() {

        if($scope.nonav) {
            return;
        }

        if($scope.slice_start > 0) {

            $scope.slice_start  -= 1;
            $scope.slice_end    -= 1;
            $scope.last_n_weeks = $scope.promoter_events[$rootScope.event_ndx].tickets.slice($scope.slice_start, $scope.slice_end);
        }
    };

    // promoters
    $scope.echoNumSold = function(tt, week) {

        $log.log('echoNumSold', tt, week);

        // get the weekly sales entry for the given ticket type
        for(var ndx = 0; ndx < week.ticket_details.length; ndx++) {
            if(week.ticket_details[ndx].ticket_type.id === parseInt(tt.id, 10) || week.ticket_details[ndx].ticket_type.id === tt.id) {

                $log.log('echoNumSold found details for tickettype '+tt.id, week.ticket_details[ndx].tickets_sold);
                return week.ticket_details[ndx].tickets_sold ? week.ticket_details[ndx].tickets_sold.num_sold : 0;
            }
        }

        // error could not match ticket type
        $log.log('echoNumSold could not find details for tickettype ', tt, week);
        return 0;
    };

    // promoters
    $scope.conditionalInput = function(tt, week) {

        // get the weekly sales entry for the given ticket type
        for(var ndx = 0; ndx < week.ticket_details.length; ndx++) {

            if(week.ticket_details[ndx].ticket_type.id === tt.id) {

                var visible = week.ticket_details[ndx].input_visible;
                return visible;
            }
        }

        // error could not match ticket type
        return false;
    };

    // alda
    $scope.submitWeeklyTickets = function(mode) {

        var el        = document.getElementById("ticketsRoot");
        var token_str = angular.element(el).data('token');
        var post_url  = '/api/v1/my-events/'+$scope.event_id+"/event-tickets-sold";

        var form_inputs = mode === 'promoter' ? $("#promoter_sales_form input") : $("#weekly_sales_"+$scope.selectedWeek+"_"+$scope.selectedYear+" input[name=num_sold]");

        var ticket_sales_input = [];
        form_inputs.each(function(ndx, ttype_el) {
            var curr_el = angular.element(ttype_el);
            ticket_sales_input.push({ttype_id: curr_el.data('ttype'), week: curr_el.data('week'), year: curr_el.data('year'), sold: curr_el.val()});
        });

        var post_data = angular.extend({}, {_token: token_str, week: $scope.selectedWeek, year: $scope.selectedYear, sales_data: ticket_sales_input});
        $log.log('submitWeeklyTickets', post_data, post_url);
        eventsService.postServerData(post_url, post_data).then(function(data) {

            $log.log('submitWeeklyTickets got ', data);
            var cb = $scope.init;
            $rootScope.initData(cb);
        });
    };

    // alda
    $scope.weeklyAction = function(sales_week, sales_year) {

        $log.log('weeklyAction', sales_week, sales_year);
        if($scope.editor_expanded[sales_week]) {

            $log.log('submitting sales');
            // submit
            $scope.submitWeeklyTickets('alda');
            $scope.editor_expanded[sales_week] = false;

        } else {

            $log.log('expanding editor');
            // set selected
            $scope.selectedWeek = sales_week;
            $scope.selectedYear = sales_year;

            // is this what we want ???
            for(var weekly_ndx = 0; weekly_ndx < $scope.editor_expanded.length; weekly_ndx++) {
                $scope.editor_expanded[weekly_ndx] = false;
            }

            $scope.editor_expanded[sales_week] = true;
        }
    };

    $(document).ready(function() {

        if($('#ticketsRoot').length > 0) {
            var cb = $scope.init;
            $rootScope.initData(cb);
        }
    });

}]);


},{}],"/var/www/sites/aldadata/app/assets/js/angular/directives/index.js":[function(require,module,exports){
window.angular.module('promotersApp').directive("edatepicker", function () {

    'use strict';
    return {
        restrict: "A",
        require: "ngModel",
        link: function (scope, elem, attrs, ngModelCtrl) {

            //console.log('attrs', attrs.value);
            var updateModel = function (dateText) {
                scope.$apply(function () {
                    ngModelCtrl.$setViewValue(dateText);
                });
            };

            var options = {
                dateFormat: "dd-mm-yy",
                defaultDate: scope.convertDate(scope.task.info.due_date),
                onSelect: function (dateText) {
                    updateModel(dateText);
                    scope.selectDate(scope.dt);
                },
                onClose: function () {
                    scope.datepicker_open = false;
                }
            };
            elem.datepicker(options);
        }
    };
})

.directive("sdatepicker", function () {

    'use strict';
    return {
        restrict: "A",
        require: "ngModel",
        link: function (scope, elem, attrs, ngModelCtrl) {

            //console.log('attrs', attrs.value);
            var updateModel = function (dateText) {
                scope.$apply(function () {
                    ngModelCtrl.$setViewValue(dateText);
                });
            };

            var options = {
                dateFormat: "yy-mm-dd",
                onSelect: function (dateText) {
                    updateModel(dateText);
                    //scope.selectDate(scope.dt);
                },
                onClose: function () {
                    scope.datepicker_open = false;
                }
            };
            elem.datepicker(options);
        }
    };
})

.directive("bdatepicker", function () {

    'use strict';
    return {
        restrict: "A",
        require: "ngModel",
        link: function (scope, elem, attrs, ngModelCtrl) {

            //console.log('attrs', attrs.value);
            var updateModel = function (dateText) {
                scope.$apply(function () {
                    ngModelCtrl.$setViewValue(dateText);
                });
            };

            var options = {
                dateFormat: "yy-mm-dd",
                onSelect: function (dateText) {
                    updateModel(dateText);
                    //scope.selectDate(scope.dt);
                },
                onClose: function () {
                    scope.datepicker_open = false;
                }
            };
            elem.datepicker(options);
        }
    };
})

.directive('datepickerPopup', function (dateFilter, datepickerPopupConfig) {

    'use strict';
    return {
        restrict: 'A',
        priority: 1,
        require: 'ngModel',
        link: function(scope, element, attr, ngModel) {
            var dateFormat = attr.datepickerPopup || datepickerPopupConfig.datepickerPopup;
            ngModel.$formatters.push(function (value) {
                return dateFilter(value, dateFormat);
            });
        }
    };
})

.directive("timeFormat", function($filter) {

    'use strict';
    var angular = window.angular;

    return {
        restrict : 'A',
        require : 'ngModel',
        scope : {
            showMeridian : '=',
        },
        link : function(scope, element, attrs, ngModel) {

            var parseTime = function(viewValue) {

                if (!viewValue) {
                    ngModel.$setValidity('time', true);
                    return null;
                } else if (angular.isDate(viewValue) && !isNaN(viewValue)) {
                    ngModel.$setValidity('time', true);
                    return viewValue;
                } else if (angular.isString(viewValue)) {
                    var timeRegex = /^(0?[0-9]|1[0-2]):[0-5][0-9] ?[a|p]m$/i;
                    if (!scope.showMeridian) {
                        timeRegex = /^([01]?[0-9]|2[0-3]):[0-5][0-9]$/;
                    }
                    if (!timeRegex.test(viewValue)) {
                        ngModel.$setValidity('time', false);
                        return undefined;
                    } else {
                        ngModel.$setValidity('time', true);
                        var date = new Date();
                        var sp = viewValue.split(":");
                        var apm = sp[1].match(/[a|p]m/i);
                        if (apm) {
                            sp[1] = sp[1].replace(/[a|p]m/i, '');
                            if (apm[0].toLowerCase() === 'pm') {
                                sp[0] = sp[0] + 12;
                            }
                        }
                        date.setHours(sp[0], sp[1]);
                        return date;
                    }
                } else {
                    ngModel.$setValidity('time', false);
                    return undefined;
                }
            };

            ngModel.$parsers.push(parseTime);

            var showTime = function(data) {
                parseTime(data);
                var timeFormat = (!scope.showMeridian) ? "HH:mm" : "hh:mm a";
                return $filter('date')(data, timeFormat);
            };
            ngModel.$formatters.push(showTime);
            scope.$watch('showMeridian', function(value) {
                var myTime = ngModel.$modelValue;
                if (myTime) {
                    element.val(showTime(myTime));
                }

            });
        }
    };
})

.directive('timepickerPop', function($document, timepickerState) {

    'use strict';
    var angular = window.angular;

    return {
        restrict : 'E',
        transclude : false,
        scope : {
            inputTime : "=",
            showMeridian : "=",
            disabled : "="
        },
        controller : function($scope, $element) {

            $scope.isOpen = false;
            $scope.disabledInt = angular.isUndefined($scope.disabled)? false : $scope.disabled;

            $scope.toggle = function() {
                if ($scope.isOpen) {
                    $scope.close();
                } else {
                    $scope.open();
                }
            };
        },
        link : function(scope, element, attrs) {

            var picker = {
                open : function () {
                    timepickerState.closeAll();
                    scope.isOpen = true;
                },
                close: function () {
                    scope.isOpen = false;
                }

            };
            timepickerState.addPicker(picker);

            scope.open = picker.open;
            scope.close = picker.close;

            scope.$watch("disabled", function(value) {
                scope.disabledInt = angular.isUndefined(scope.disabled)? false : scope.disabled;
            });

            scope.$watch("inputTime", function(value) {

                if (!scope.inputTime) {
                    element.addClass('has-error');
                } else {
                    element.removeClass('has-error');
                }

            });

            element.bind('click', function(event) {
                event.preventDefault();
                event.stopPropagation();
            });

            $document.bind('click', function(event) {
                scope.$apply(function() {
                    scope.isOpen = false;
                });
            });

        },
        template : "<input type='text' class='form-control' ng-model='inputTime' ng-disabled='disabledInt' time-format show-meridian='showMeridian' ng-focus='open()' />" +
            "  <div ng-class='{open:isOpen}'> " +
            //"    <button type='button' ng-disabled='disabledInt' style='height:34px;' class='btn btn-default ' ng-class=\"{'btn-primary':isOpen}\" data-toggle='dropdown' ng-click='toggle()'> " +
            //"        <i class='glyphicon glyphicon-time'></i></button> " +
            "          <div class='dropdown-menu pull-right'> " +
            "            <timepicker ng-model='inputTime' show-meridian='showMeridian'></timepicker> " +
            "           </div> " +
            " </div>"
    };
});

},{}],"/var/www/sites/aldadata/app/assets/js/angular/factories/index.js":[function(require,module,exports){
window.angular.module('promotersApp').factory('eventsService', ['$resource', '$q', '$http', function($resource, $q, $http){

    'use strict';

    return {

        getServerData: function(url) {

            // Le promise
            var defer = $q.defer();

            $http.get(url)
            .success(function (data, status, headers, config) {
                defer.resolve(data);
            }).error(function (data, status, headers, config) {
                console.log(status);
            });

            // return promise
            return defer.promise;
        },
        deleteServerData: function(url) {

            var defer = $q.defer();

            $http.delete(url)
            .success(function (data, status, headers, config) {
                defer.resolve(data);
            }).error(function (data, status, headers, config) {
                console.log(status);
            });

            return defer.promise;
        },
        postServerData: function(url, post_data) {

            var defer = $q.defer();

            $http.post(url, post_data)
            .success(function (data, status, headers, config) {
                defer.resolve(data);
            }).error(function (data, status, headers, config) {
                console.log(status);
            });

            return defer.promise;
        },
        getTemplate: function(type) {

        }
    };
}])

.factory('timepickerState', function() {

    'use strict';
    var pickers = [];

    return {
        addPicker: function(picker) {
            pickers.push(picker);
        },
        closeAll: function() {
            for (var i=0; i<pickers.length; i++) {
                pickers[i].close();
            }
        }
    };
});


},{}],"/var/www/sites/aldadata/app/assets/js/angular/filters/index.js":[function(require,module,exports){
window.angular.module('promotersApp').filter('reverse', function() {

	'use strict';
	
    return function(items) {
        return (items && items.length > 0 ? items.slice().reverse() : items);
    };
});
},{}],"/var/www/sites/aldadata/app/assets/js/angular/zzz/promoters_registration_app.js":[function(require,module,exports){
// app.js

(function (angular) {
    "use strict";
    // create our angular app and inject ngAnimate and ui-router
    // =============================================================================
    var promoter_registration_app = angular.module('promotersRegistrationApp', ['ngAnimate', 'ngResource', 'ui.router']);

    promoter_registration_app.factory('eventsService', ['$resource', '$q', '$http', function ($resource, $q, $http){

        //var promoter_events;
        return {

            getServerData: function(url) {

                // Le promise
                var defer = $q.defer();

                $http.get(url)
                .success(function (data, status, headers, config) {
                    defer.resolve(data);
                }).error(function (data, status, headers, config) {
                    console.log(status);
                });

                // return promise
                return defer.promise;
            },
            deleteServerData: function(url) {

                // Le promise
                var defer = $q.defer();

                $http.delete(url)
                .success(function (data, status, headers, config) {
                    defer.resolve(data);
                }).error(function (data, status, headers, config) {
                    console.log(status);
                });

                // return promise
                return defer.promise;
            },
            postServerData: function(url, post_data) {

                // Le promise
                var defer = $q.defer();

                $http.post(url, post_data)
                .success(function (data, status, headers, config) {
                    defer.resolve(data);
                }).error(function (data, status, headers, config) {
                    console.log(status);
                });

                // return promise
                return defer.promise;
            }
        };
    }]);

    // configuring our routes
    // =============================================================================
    promoter_registration_app.config(function($stateProvider, $urlRouterProvider) {

        $stateProvider

            // route to show our basic form (/form)
            .state('form', {
                url: '/step',
                templateUrl: 'form.html',
                controller: 'PromoterRegistrationController'
            })

            // nested states
            // each of these sections will have their own view
            // url will be nested (/form/profile)
            .state('form.company_details', {
                url: '/company',
                templateUrl: 'company.html',
                data: { ndx: 0 }
            })

            .state('form.personal_details', {
                url: '/personal',
                templateUrl: 'personal.html',
                data: { ndx: 1 }
            })

            // url will be /form/payment
            .state('form.overview', {
                url: '/overview',
                templateUrl: 'overview.html',
                data: { ndx: 2 }
            });

        // catch all route
        // send users to the form page
        $urlRouterProvider.otherwise('/step/company');
    })

    // our controller for the form
    // =============================================================================
    .controller('PromoterRegistrationController', ['$scope', '$state', '$log', 'eventsService', function ($scope, $state, $log, eventsService) {

        // we will store all of our form data in this object

        $scope.$log = $log;

        $scope.companyData = {};
        $scope.personalData = {};
        $scope.addressData = {};

        $scope.countries = undefined;
        eventsService.getServerData('/api/v1/countries').then(function(data) {
            $scope.countries = data;

            var $li_el = $("#progressbar li");
            $li_el.removeClass("active");
            for(var curr_ndx = 0; curr_ndx <= $state.current.data.ndx; curr_ndx++){
                if(!$li_el.eq(curr_ndx).hasClass("active")) {
                    $li_el.eq(curr_ndx).addClass("active");
                }
            }
        });

        $scope.getRegistrationInfo = function() {

            eventsService.getServerData('/registration/company').then(function(data) {

                console.log(data);

                $scope.companyData.company_name = data.user_company.name;
                $scope.companyData.company_type = data.user_company.type;
                $scope.companyData.company_bank_details = data.user_company.bank_details;
                $scope.companyData.company_tax_number = data.user_company.tax_number;
                $scope.companyData.notes = data.user_company.notes;

                $scope.addressData.country_id = data.company_address.country_id;
                $scope.addressData.address = data.company_address.address;
                $scope.addressData.post_code = data.company_address.postal_code;
                $scope.addressData.city = data.company_address.city;
                $scope.addressData.state_province = data.company_address.state_province;
                $scope.addressData.phone = data.company_address.phone;
                $scope.addressData.fax = data.company_address.fax;
                $scope.addressData.website = data.company_address.website;
            });

            eventsService.getServerData('/registration/personal').then(function(data) {
                $scope.personalData.personal_phone = data.personal_phone;
                $scope.personalData.email = data.email;
            });
        };
        $scope.getRegistrationInfo();


        $scope.registrationSubmission = function(type, state) {

            // type is what we are submitting, state is where we are going
            var post_url, post_data;
            var el = document.getElementById("promotersRegistrationRoot");
            var token_str = angular.element(el).data('token');

            var ndx;
            switch(type) {

                case 'personal':
                    post_url = "/registration/personal";
                    post_data = angular.extend({}, {_token: token_str}, $scope.personalData);
                    ndx = 2;
                    break;
                case 'company':
                    post_url = "/registration/company";
                    post_data = angular.extend({}, {_token: token_str}, $scope.companyData, $scope.addressData);
                    ndx = 1;
                    break;
                default:
                    break;
            }

            eventsService.postServerData(post_url, post_data).then(function(data) {
                console.log('posted '+type+' to '+post_url, post_data, data);
            });

            var $li_el = $("#progressbar li");
            for(var curr_ndx = 0; curr_ndx <= ndx; curr_ndx++) {
                if(!$li_el.eq(curr_ndx).hasClass("active")) {
                    $li_el.eq(curr_ndx).addClass("active");
                }
            }

            // if validation ok go to next
            $state.go(state);
        };

        $scope.goBack = function(type, state) {

            var ndx;
            switch(type) {
                case 'overview':
                    ndx = 2;
                    break;
                case 'personal':
                    ndx = 1;
                    break;
                case 'company':
                    ndx = 0;
                    break;
                default:
                    break;
            }

            console.log(type, ndx);

            // overview is max atm = 4
            if(ndx < 4 && ndx > 0) {

                $("#progressbar li").eq(ndx).removeClass("active");

                // if validation ok go to next
                $state.go(state);
            }
        };

    }]);
}(window.angular));

},{}]},{},["./app/assets/js/angular/main.js"])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJhcHAvYXNzZXRzL2pzL2FuZ3VsYXIvbWFpbi5qcyIsImFwcC9hc3NldHMvanMvYW5ndWxhci9hcHAuanMiLCJhcHAvYXNzZXRzL2pzL2FuZ3VsYXIvY29uZmlnL3JvdXRlci5qcyIsImFwcC9hc3NldHMvanMvYW5ndWxhci9jb25maWcvcnVuLmpzIiwiYXBwL2Fzc2V0cy9qcy9hbmd1bGFyL2NvbnRyb2xsZXJzL3Byb21vdGVycy5qcyIsImFwcC9hc3NldHMvanMvYW5ndWxhci9jb250cm9sbGVycy90YXNrcy5qcyIsImFwcC9hc3NldHMvanMvYW5ndWxhci9jb250cm9sbGVycy90aWNrZXRzLmpzIiwiYXBwL2Fzc2V0cy9qcy9hbmd1bGFyL2RpcmVjdGl2ZXMvaW5kZXguanMiLCJhcHAvYXNzZXRzL2pzL2FuZ3VsYXIvZmFjdG9yaWVzL2luZGV4LmpzIiwiYXBwL2Fzc2V0cy9qcy9hbmd1bGFyL2ZpbHRlcnMvaW5kZXguanMiLCJhcHAvYXNzZXRzL2pzL2FuZ3VsYXIvenp6L3Byb21vdGVyc19yZWdpc3RyYXRpb25fYXBwLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDN0NBO0FBQ0E7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN0S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JrQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOVBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIndXNlIHN0cmljdCc7XG5cbnZhciBhbmd1bGFyID0gd2luZG93LmFuZ3VsYXI7XG52YXIgXyA9IHdpbmRvdy5fO1xuXG5nbG9iYWwuQXBwID0ge1xuXG5cdHByb21vdGVyczoge1xuXHRcdGFwcDogcmVxdWlyZSgnLi9hcHAuanMnKSxcbiAgICAgICAgZmlsdGVyczogcmVxdWlyZSgnLi9maWx0ZXJzL2luZGV4LmpzJyksXG5cdFx0cnVuOiByZXF1aXJlKCcuL2NvbmZpZy9ydW4uanMnKSxcblx0XHRyb3V0ZXI6IHJlcXVpcmUoJy4vY29uZmlnL3JvdXRlci5qcycpLFxuXHRcdGZhY3RvcmllczogcmVxdWlyZSgnLi9mYWN0b3JpZXMvaW5kZXguanMnKSxcblx0XHRkaXJlY3RpdmVzOiByZXF1aXJlKCcuL2RpcmVjdGl2ZXMvaW5kZXguanMnKSxcblx0XHRjb250cm9sbGVyczoge1xuXHRcdFx0cHJvbW90ZXJzOiByZXF1aXJlKCcuL2NvbnRyb2xsZXJzL3Byb21vdGVycy5qcycpLFxuXHRcdFx0dGFza3M6IHJlcXVpcmUoJy4vY29udHJvbGxlcnMvdGFza3MuanMnKSxcblx0XHRcdHRpY2tldHM6IHJlcXVpcmUoJy4vY29udHJvbGxlcnMvdGlja2V0cy5qcycpXG5cdFx0fVxuXHR9LFxuXHRyZWdpc3RyYXRpb246IHJlcXVpcmUoJy4venp6L3Byb21vdGVyc19yZWdpc3RyYXRpb25fYXBwLmpzJylcbn07XG5cbihmdW5jdGlvbigpIHtcblxuICAgIC8vIHByb21vdGVycyBrYiBsaXN0ZW5lclxuICAgICQoZG9jdW1lbnQpLm9uKCdrZXlwcmVzcycsIGZ1bmN0aW9uKGUpIHtcblxuICAgICAgICBpZigkKCcjcHJvbW90ZXJUaWNrZXRzJykubGVuZ3RoICE9PSAwKSB7XG5cbiAgICAgICAgICAgIHZhciBjb2RlID0gZS5rZXlDb2RlIHx8IGUud2hpY2g7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygna2IgY29kZScsIGNvZGUsIGNvZGUgPT09IDEzKTtcblxuICAgICAgICAgICAgaWYoY29kZSA9PT0gMTMpIHtcblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdwcHAnKTtcbiAgICAgICAgICAgICAgICAkKCcuc2F2ZS1idG4nKS5maXJzdCgpLnRyaWdnZXIoJ2NsaWNrJyk7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcblxufSkoKTsiLCJ3aW5kb3cuYW5ndWxhci5tb2R1bGUoJ3Byb21vdGVyc0FwcCcsIFsnbmdBbmltYXRlJywgJ25nUmVzb3VyY2UnLCAndWkucm91dGVyJywgJ2FuZ3VsYXIuZmlsdGVyJywgJ3VpLmJvb3RzdHJhcCcsICdhbmd1bGFyRmlsZVVwbG9hZCcsICdoaWdoY2hhcnRzLW5nJ10pO1xuIiwiLy8gY29uZmlndXJpbmcgb3VyIHJvdXRlc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbndpbmRvdy5hbmd1bGFyLm1vZHVsZSgncHJvbW90ZXJzQXBwJykuY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLCAnJHVybFJvdXRlclByb3ZpZGVyJywgJyRsb2NhdGlvblByb3ZpZGVyJywgZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpIHtcblxuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBmb3JtID0ge1xuICAgICAgICBuYW1lOiAnZm9ybScsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnZm9ybS5odG1sJyxcbiAgICAgICAgdXJsOiAnL215LWV2ZW50cycsXG4gICAgICAgIGNvbnRyb2xsZXI6ICdQcm9tb3RlckNvbnRyb2xsZXInXG4gICAgfTtcblxuICAgIHZhciBmb3JtRXZlbnRzID0ge1xuICAgICAgICBuYW1lOiAnZm9ybS5ldmVudHMnLFxuICAgICAgICBwYXJlbnQ6IGZvcm0sXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnZXZlbnRzLmh0bWwnLFxuICAgICAgICBhYnN0cmFjdDogdHJ1ZSxcbiAgICAgICAgdXJsOiAnL2V2ZW50cydcbiAgICB9O1xuXG4gICAgdmFyIGZvcm1FdmVudHNCdG5zID0ge1xuICAgICAgICBuYW1lOiAnZm9ybS5ldmVudHMuYnV0dG9ucycsXG4gICAgICAgIHBhcmVudDogZm9ybUV2ZW50cyxcbiAgICAgICAgdGVtcGxhdGVVcmw6ICdldmVudHNfYnV0dG9ucy5odG1sJyxcbiAgICAgICAgdXJsOiAnL2J0bnMnLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBuYW1lOiAnZXZlbnRzJ1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHZhciBmb3JtRXZlbnRzUm93cyA9IHtcbiAgICAgICAgbmFtZTogJ2Zvcm0uZXZlbnRzLnJvd3MnLFxuICAgICAgICBwYXJlbnQ6IGZvcm1FdmVudHMsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnZXZlbnRzX3Jvd3MuaHRtbCcsXG4gICAgICAgIHVybDogJy9yb3dzJyxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgbmFtZTogJ2V2ZW50cydcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgZm9ybURhc2hib2FyZCA9IHtcbiAgICAgICAgbmFtZTogJ2Zvcm0uZGFzaGJvYXJkJyxcbiAgICAgICAgcGFyZW50OiBmb3JtLFxuICAgICAgICB0ZW1wbGF0ZVVybDogJ3RlbXBsYXRlcy9kYXNoYm9hcmQuaHRtbCcsXG4gICAgICAgIHVybDogJy86ZXZlbnRJZC9kYXNoYm9hcmQ/dGFza0lkJyxcbiAgICAgICAgY29udHJvbGxlcjogZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGVQYXJhbXMpIHtcblxuICAgICAgICAgICAgJHNjb3BlLnRhc2tJZCA9ICRzdGF0ZVBhcmFtcy50YXNrSWQ7XG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIG5hbWU6ICdvdmVydmlldydcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgZm9ybUcxID0ge1xuICAgICAgICBuYW1lOiAnZm9ybS5ncm91cDEnLFxuICAgICAgICBwYXJlbnQ6IGZvcm0sXG4gICAgICAgIHRlbXBsYXRlVXJsOiAndGVtcGxhdGVzL2dyb3VwMS5odG1sJyxcbiAgICAgICAgdXJsOiAnLzpldmVudElkL2dyb3VwMScsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIG5hbWU6ICcxJ1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHZhciBmb3JtRzIgPSB7XG4gICAgICAgIG5hbWU6ICdmb3JtLmdyb3VwMicsXG4gICAgICAgIHBhcmVudDogZm9ybSxcbiAgICAgICAgdGVtcGxhdGVVcmw6ICd0ZW1wbGF0ZXMvZ3JvdXAyLmh0bWwnLFxuICAgICAgICB1cmw6ICcvOmV2ZW50SWQvZ3JvdXAyJyxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgbmFtZTogJzInXG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgdmFyIGZvcm1HMyA9IHtcbiAgICAgICAgbmFtZTogJ2Zvcm0uZ3JvdXAzJyxcbiAgICAgICAgcGFyZW50OiBmb3JtLFxuICAgICAgICB0ZW1wbGF0ZVVybDogJ3RlbXBsYXRlcy9ncm91cDMuaHRtbCcsXG4gICAgICAgIHVybDogJy86ZXZlbnRJZC9ncm91cDMnLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBuYW1lOiAnMydcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgZm9ybUc0ID0ge1xuICAgICAgICBuYW1lOiAnZm9ybS5ncm91cDQnLFxuICAgICAgICBwYXJlbnQ6IGZvcm0sXG4gICAgICAgIHRlbXBsYXRlVXJsOiAndGVtcGxhdGVzL2dyb3VwNC5odG1sJyxcbiAgICAgICAgdXJsOiAnLzpldmVudElkL2dyb3VwNCcsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIG5hbWU6ICc0J1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHZhciBmb3JtRXZlbnREZXRhaWxzID0ge1xuICAgICAgICBuYW1lOiAnZm9ybS5ldmVudF9kZXRhaWxzJyxcbiAgICAgICAgcGFyZW50OiBmb3JtLFxuICAgICAgICB0ZW1wbGF0ZVVybDogJ2V2ZW50X2RldGFpbHMuaHRtbCcsXG4gICAgICAgIGFic3RyYWN0OiB0cnVlLFxuICAgICAgICB1cmw6ICcvOmV2ZW50SWQvZGV0YWlscycsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIG5hbWU6ICdldmVudCBkZXRhaWxzJ1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHZhciBmb3JtRXZlbnRWZW51ZSA9IHtcbiAgICAgICAgbmFtZTogJ2Zvcm0uZXZlbnRfdmVudWUnLFxuICAgICAgICBwYXJlbnQ6IGZvcm1FdmVudERldGFpbHMsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAndmVudWUuaHRtbCcsXG4gICAgICAgIHVybDogJy92ZW51ZScsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIG5hbWU6ICdldmVudCB2ZW51ZSBkZXRhaWxzJ1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHZhciBmb3JtRXZlbnRIb3NwaXRhbGl0eSA9IHtcbiAgICAgICAgbmFtZTogJ2Zvcm0uZXZlbnRfaG9zcGl0YWxpdHknLFxuICAgICAgICBwYXJlbnQ6IGZvcm1FdmVudERldGFpbHMsXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnaG9zcGl0YWxpdHkuaHRtbCcsXG4gICAgICAgIHVybDogJy9ob3NwaXRhbGl0eScsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIG5hbWU6ICdldmVudCBob3NwaXRhbGl0eSBkZXRhaWxzJ1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIHZhciBmb3JtRXZlbnRUaWNrZXRzID0ge1xuICAgICAgICBuYW1lOiAnZm9ybS50aWNrZXRzJyxcbiAgICAgICAgcGFyZW50OiBmb3JtLFxuICAgICAgICB0ZW1wbGF0ZVVybDogJ3RpY2tldHMuaHRtbCcsXG4gICAgICAgIHVybDogJy86ZXZlbnRJZC90aWNrZXRzJyxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgbmFtZTogJ3RpY2tldHMnXG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gdW5tYXRjaGVkIHJvdXRlIGNhdGNoZXIgXG4gICAgJHVybFJvdXRlclByb3ZpZGVyXG4gICAgICAgIC5vdGhlcndpc2UoJy9teS1ldmVudHMnKTtcblxuICAgIC8vIG5lc3RlZCBzdGF0ZXNcbiAgICAvLyBlYWNoIG9mIHRoZXNlIHNlY3Rpb25zIHdpbGwgaGF2ZSB0aGVpciBvd24gdmlld1xuICAgIC8vIHVybCB3aWxsIGJlIG5lc3RlZCAoL2Zvcm0vcHJvZmlsZSlcbiAgICAkc3RhdGVQcm92aWRlclxuICAgICAgICAuc3RhdGUoZm9ybSlcbiAgICAgICAgLnN0YXRlKGZvcm1FdmVudHMpXG4gICAgICAgIC5zdGF0ZShmb3JtRXZlbnRzQnRucylcbiAgICAgICAgLnN0YXRlKGZvcm1FdmVudHNSb3dzKVxuICAgICAgICAuc3RhdGUoZm9ybURhc2hib2FyZClcbiAgICAgICAgLnN0YXRlKGZvcm1HMSlcbiAgICAgICAgLnN0YXRlKGZvcm1HMilcbiAgICAgICAgLnN0YXRlKGZvcm1HMylcbiAgICAgICAgLnN0YXRlKGZvcm1HNClcbiAgICAgICAgLnN0YXRlKGZvcm1FdmVudERldGFpbHMpXG4gICAgICAgIC5zdGF0ZShmb3JtRXZlbnRWZW51ZSlcbiAgICAgICAgLnN0YXRlKGZvcm1FdmVudEhvc3BpdGFsaXR5KVxuICAgICAgICAuc3RhdGUoZm9ybUV2ZW50VGlja2V0cyk7XG5cblxuICAgIC8vIEhUTUw1IG1vZGVcbiAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUoe1xuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICByZXF1aXJlQmFzZTogdHJ1ZVxuICAgIH0pO1xufV0pO1xuXG4iLCJ3aW5kb3cuYW5ndWxhci5tb2R1bGUoJ3Byb21vdGVyc0FwcCcpLnJ1bihbJyRodHRwJywgJyRsb2cnLCAnJHJvb3RTY29wZScsICckdGVtcGxhdGVDYWNoZScsICckdGltZW91dCcsICdldmVudHNTZXJ2aWNlJyxcbiAgICBmdW5jdGlvbigkaHR0cCwgJGxvZywgJHJvb3RTY29wZSwgJHRlbXBsYXRlQ2FjaGUsICR0aW1lb3V0LCBldmVudHNTZXJ2aWNlKSB7XG5cbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICAvLyBnZXQgdGVtcGxhdGVzXG4gICAgJGh0dHAuZ2V0KCdtYXN0ZXJzMy5odG1sJywge1xuXG4gICAgICAgIGNhY2hlOiAkdGVtcGxhdGVDYWNoZVxuXG4gICAgfSkudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcblxuICAgICAgICBjb25zb2xlLmxvZygncmVzJywgcmVzdWx0KTtcblxuICAgICAgICB2YXIgZGFzaGJvYXJkX2h0bWwgPSByZXN1bHQuZGF0YTtcbiAgICAgICAgdmFyIGRhc2hib2FyZF9oID0gZGFzaGJvYXJkX2h0bWwucmVwbGFjZSgnJUdST1VQX1RBU0tTJScsICckcm9vdC5wcm9tb3Rlcl9ldmVudHNbJHJvb3QuZXZlbnRfbmR4XS50YXNrcycpLnJlcGxhY2UoJyVMSU1JVF9GSUxURVIlJywgJ3wgbGltaXRUbzokcm9vdC5tYXhfaXRlbXMnKTtcbiAgICAgICAgJHRlbXBsYXRlQ2FjaGUucHV0KFwidGVtcGxhdGVzL2Rhc2hib2FyZC5odG1sXCIsIGRhc2hib2FyZF9oKTtcblxuICAgICAgICB2YXIgdG91cl9odG1sID0gcmVzdWx0LmRhdGE7XG4gICAgICAgIHZhciB0b3VyX2ggPSB0b3VyX2h0bWwucmVwbGFjZSgnJUdST1VQX1RBU0tTJScsICckcm9vdC5wcm9tb3Rlcl9ldmVudHNbJHJvb3QuZXZlbnRfbmR4XS5jYXRfdGFza3MuZ3JvdXBfMScpLnJlcGxhY2UoJyVMSU1JVF9GSUxURVIlJywgJycpO1xuICAgICAgICAkdGVtcGxhdGVDYWNoZS5wdXQoXCJ0ZW1wbGF0ZXMvZ3JvdXAxLmh0bWxcIiwgdG91cl9oKTtcblxuICAgICAgICB2YXIgdGVjaG5pY2FsX2h0bWwgPSByZXN1bHQuZGF0YTtcbiAgICAgICAgdmFyIHRlY2huaWNhbF9oID0gdGVjaG5pY2FsX2h0bWwucmVwbGFjZSgnJUdST1VQX1RBU0tTJScsICckcm9vdC5wcm9tb3Rlcl9ldmVudHNbJHJvb3QuZXZlbnRfbmR4XS5jYXRfdGFza3MuZ3JvdXBfMicpLnJlcGxhY2UoJyVMSU1JVF9GSUxURVIlJywgJycpO1xuICAgICAgICAkdGVtcGxhdGVDYWNoZS5wdXQoXCJ0ZW1wbGF0ZXMvZ3JvdXAyLmh0bWxcIiwgdGVjaG5pY2FsX2gpO1xuXG4gICAgICAgIHZhciBtYXJrZXRpbmdfaHRtbCA9IHJlc3VsdC5kYXRhO1xuICAgICAgICB2YXIgbWFya2V0aW5nX2ggPSBtYXJrZXRpbmdfaHRtbC5yZXBsYWNlKCclR1JPVVBfVEFTS1MlJywgJyRyb290LnByb21vdGVyX2V2ZW50c1skcm9vdC5ldmVudF9uZHhdLmNhdF90YXNrcy5ncm91cF8zJykucmVwbGFjZSgnJUxJTUlUX0ZJTFRFUiUnLCAnJyk7XG4gICAgICAgICR0ZW1wbGF0ZUNhY2hlLnB1dChcInRlbXBsYXRlcy9ncm91cDMuaHRtbFwiLCBtYXJrZXRpbmdfaCk7XG5cbiAgICAgICAgdmFyIHRyYXZlbF9odG1sID0gcmVzdWx0LmRhdGE7XG4gICAgICAgIHZhciB0cmF2ZWxfaCA9IHRyYXZlbF9odG1sLnJlcGxhY2UoJyVHUk9VUF9UQVNLUyUnLCAnJHJvb3QucHJvbW90ZXJfZXZlbnRzWyRyb290LmV2ZW50X25keF0uY2F0X3Rhc2tzLmdyb3VwXzQnKS5yZXBsYWNlKCclTElNSVRfRklMVEVSJScsICcnKTtcbiAgICAgICAgJHRlbXBsYXRlQ2FjaGUucHV0KFwidGVtcGxhdGVzL2dyb3VwNC5odG1sXCIsIHRyYXZlbF9oKTtcbiAgICB9KTtcblxuICAgIC8vLy8vLy8vLy8vLy9cbiAgICAvLyBHTE9CQUxTIC8vXG4gICAgLy8vLy8vLy8vLy8vL1xuXG4gICAgJHJvb3RTY29wZS5jYXRzICAgICAgICAgICAgICAgICA9IHVuZGVmaW5lZDtcbiAgICAkcm9vdFNjb3BlLmludmFsaWRfZXZlbnRfaWQgICAgID0gZmFsc2U7XG4gICAgJHJvb3RTY29wZS5ldmVudF9uZHggICAgICAgICAgICA9IDA7XG4gICAgJHJvb3RTY29wZS5tYXhfaXRlbXMgICAgICAgICAgICA9IDU7XG4gICAgJHJvb3RTY29wZS5hY3RpdmVfZGFzaGJvYXJkX2J0biA9IGZhbHNlO1xuICAgICRyb290U2NvcGUuYWN0aXZlX2V2ZW50X2J0biAgICAgPSBmYWxzZTtcbiAgICAkcm9vdFNjb3BlLmFjdGl2ZV92ZW51ZV9idG4gICAgID0gZmFsc2U7XG4gICAgJHJvb3RTY29wZS5hY3RpdmVfdGlja2V0c19idG4gICA9IGZhbHNlO1xuXG4gICAgJHJvb3RTY29wZS5wcm9tb3Rlcl9ldmVudHMgICAgICA9IHVuZGVmaW5lZDtcbiAgICAkcm9vdFNjb3BlLm51bV9ldmVudHMgICAgICAgICAgID0gMDtcblxuICAgICRyb290U2NvcGUudG9kYXkgPSAgICAgICAgICAgICAgbmV3IERhdGUoKTtcblxuICAgICRyb290U2NvcGUuY2xlYW5BY3RpdmVEZXRhaWxzQnRucyA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICRsb2cubG9nKCdjbGVhcmluZy4uLicpO1xuXG4gICAgICAgICRyb290U2NvcGUuYWN0aXZlX2Rhc2hib2FyZF9idG4gPSBmYWxzZTtcbiAgICAgICAgJHJvb3RTY29wZS5hY3RpdmVfZXZlbnRfYnRuICAgICA9IGZhbHNlO1xuICAgICAgICAkcm9vdFNjb3BlLmFjdGl2ZV92ZW51ZV9idG4gICAgID0gZmFsc2U7XG4gICAgICAgICRyb290U2NvcGUuYWN0aXZlX3RpY2tldHNfYnRuICAgPSBmYWxzZTtcbiAgICB9O1xuXG5cbiAgICAkcm9vdFNjb3BlLmdldENhdHMgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAkKCcuYmFja2Ryb3AnKS5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgICBldmVudHNTZXJ2aWNlLmdldFNlcnZlckRhdGEoJy9hcGkvdjEvbXktZXZlbnRzL2NhdHMnKS50aGVuKGZ1bmN0aW9uKGNhdHMpIHtcbiAgICAgICAgICAgICRyb290U2NvcGUuY2F0cyA9IGNhdHM7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAkcm9vdFNjb3BlLmluaXREYXRhID0gZnVuY3Rpb24oY2IpIHtcblxuICAgICAgICAkKCcuYmFja2Ryb3AnKS5jc3MoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICAgICAgZXZlbnRzU2VydmljZS5nZXRTZXJ2ZXJEYXRhKCcvYXBpL3YxL215LWV2ZW50cycpLnRoZW4oZnVuY3Rpb24oZXZzKSB7XG5cbiAgICAgICAgICAgICRyb290U2NvcGUucHJvbW90ZXJfZXZlbnRzID0gZXZzO1xuICAgICAgICAgICAgJHJvb3RTY29wZS5udW1fZXZlbnRzICAgICAgPSAkcm9vdFNjb3BlLnByb21vdGVyX2V2ZW50cy5sZW5ndGg7XG5cbiAgICAgICAgICAgICRsb2cubG9nKCdJbml0RGF0YScsICRyb290U2NvcGUucHJvbW90ZXJfZXZlbnRzLCAnY2FsbGJhY2snLCBjYik7XG4gICAgICAgICAgICBpZihjYikge1xuICAgICAgICAgICAgICAgICRsb2cubG9nKCdydW5uaW5nIGNiJyk7XG4gICAgICAgICAgICAgICAgY2IoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJCgnLmJhY2tkcm9wJykuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICR0aW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBjYiA9ICRyb290U2NvcGUuZ2V0Q2F0cygpO1xuICAgICAgICAkcm9vdFNjb3BlLmluaXREYXRhKGNiKTtcbiAgICB9KTtcblxufV0pO1xuXG4iLCIvLyBtYWluIGNvbnRyb2xsZXJcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG53aW5kb3cuYW5ndWxhci5tb2R1bGUoJ3Byb21vdGVyc0FwcCcpLmNvbnRyb2xsZXIoJ1Byb21vdGVyQ29udHJvbGxlcicsIFsnJHJvb3RTY29wZScsICckc2NvcGUnLCAnJHN0YXRlJywgJyRtb2RhbCcsICckbG9nJywgJyRodHRwJywnJHRpbWVvdXQnLCAnZXZlbnRzU2VydmljZScsIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc2NvcGUsICRzdGF0ZSwgJG1vZGFsLCAkbG9nLCAkaHR0cCwgJHRpbWVvdXQsIGV2ZW50c1NlcnZpY2UpIHtcblxuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBhbmd1bGFyID0gd2luZG93LmFuZ3VsYXI7XG4gICAgdmFyIF8gICAgICAgPSB3aW5kb3cuXztcblxuICAgIC8vIHZhcnNcbiAgICAkc2NvcGUuZXZlbnRfaWQgICAgICAgICAgICAgICAgID0gdW5kZWZpbmVkO1xuXG4gICAgJHNjb3BlLiRzdGF0ZSAgICAgICAgICAgICAgICAgICA9ICRzdGF0ZTtcbiAgICAkc2NvcGUuc2hvd19yb3dzICAgICAgICAgICAgICAgID0gdHJ1ZTtcbiAgICAkc2NvcGUuc2hvd19idXR0b25zICAgICAgICAgICAgID0gZmFsc2U7XG4gICAgJHNjb3BlLm9iaiAgICAgICAgICAgICAgICAgICAgICA9IHVuZGVmaW5lZDtcblxuICAgICRzY29wZS52ZW51ZURhdGEgICAgICAgICAgICAgICAgPSB7IGN1cmZldzogbmV3IERhdGUoMTk3MCwgMCwgMSwgMCwgMCwgMCkgfTtcbiAgICAkc2NvcGUuaG9zcGl0YWxpdHlEYXRhICAgICAgICAgID0ge307XG5cbiAgICAkc2NvcGUuZXZfZHRfc2V0dXAgICAgICAgICAgICAgID0gdW5kZWZpbmVkO1xuICAgICRzY29wZS5ldl9kdF9icmVhayAgICAgICAgICAgICAgPSB1bmRlZmluZWQ7XG4gICAgJHNjb3BlLmluZm9fY29tcGxldGUgICAgICAgICAgICA9IHRydWU7XG5cbiAgICAkc2NvcGUuc2VsZWN0ZWRfZXZlbnQgICAgICAgICAgID0gdW5kZWZpbmVkO1xuXG4gICAgLy8gc3RhdGUgY2hhbmdlIGV2ZW50IHdhdGNoZXJcbiAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbiAoZXZlbnQsIG5leHRTdGF0ZSwgY3VycmVudFN0YXRlKSB7XG4gICAgICAgICRsb2cubG9nKCckc3RhdGUgY2hhbmdlJywgZXZlbnQsICRzdGF0ZS5wYXJhbXMsIG5leHRTdGF0ZSwgY3VycmVudFN0YXRlKTtcbiAgICB9KTtcblxuXG5cbiAgICAkc2NvcGUuc2V0RXZlbnQgPSBmdW5jdGlvbihldmVudF9pZCkge1xuXG4gICAgICAgIC8vIGZpbmQgdGhlIGl0ZW0gaW4gdGhlIGFycmF5XG4gICAgICAgIHZhciBuZXdfc2VsZWN0ZWQgPSBfLmZpbHRlcigkcm9vdFNjb3BlLnByb21vdGVyX2V2ZW50cyAsIGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgICAgICRsb2cubG9nKCdzZXRFdmVudCBmaWx0ZXInLCBpdGVtLmV2ZW50LmlkLCBldmVudF9pZCwgaXRlbS5ldmVudC5pZCA9PT0gZXZlbnRfaWQpO1xuICAgICAgICAgICAgaWYgKHBhcnNlSW50KGl0ZW0uZXZlbnQuaWQsIDEwKSA9PT0gcGFyc2VJbnQoZXZlbnRfaWQsIDEwKSkge1xuXG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5pbnZhbGlkX2V2ZW50X2lkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIGdldCB0aGUgaW5kZXhcbiAgICAgICAgaWYobmV3X3NlbGVjdGVkLmxlbmd0aCkge1xuXG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRfZXZlbnQgPSBuZXdfc2VsZWN0ZWRbMF07XG4gICAgICAgICAgICAkc2NvcGUuZXZlbnRfaWQgICAgICAgPSBldmVudF9pZDtcbiAgICAgICAgICAgICRyb290U2NvcGUuZXZlbnRfbmR4ICA9IF8uaW5kZXhPZigkcm9vdFNjb3BlLnByb21vdGVyX2V2ZW50cyAsICRzY29wZS5zZWxlY3RlZF9ldmVudCk7XG5cbiAgICAgICAgICAgICRsb2cubG9nKCdzZXRFdmVudCAnK2V2ZW50X2lkKycgZm91bmQnLCAkc2NvcGUuc2VsZWN0ZWRfZXZlbnQsICduZHgnLCAkcm9vdFNjb3BlLmV2ZW50X25keCk7XG4gICAgICAgICAgICAkc2NvcGUuc2V0Rm9ybWRhdGEoKTtcblxuICAgICAgICAgICAgaWYoJHNjb3BlLnNlbGVjdGVkX2V2ZW50KSB7XG4gICAgICAgICAgICAgICAgJGxvZy5sb2coJHNjb3BlLnNlbGVjdGVkX2V2ZW50LmV2ZW50LCAkc2NvcGUuc2VsZWN0ZWRfZXZlbnQuZXZlbnQuY3VyZmV3LCAkc2NvcGUuc2VsZWN0ZWRfZXZlbnQuZXZlbnQubWluaW1hbF9hZ2VfbGltaXQpO1xuICAgICAgICAgICAgICAgICRzY29wZS5pbmZvX2NvbXBsZXRlID0gJHNjb3BlLnZlbnVlRGF0YS5jdXJmZXcgIT09IFwiXCIgJiYgJHNjb3BlLnZlbnVlRGF0YS5taW5pbWFsX2FnZV9saW1pdCAhPT0gXCJcIjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIC8vJHNjb3BlLmluZm9fY29tcGxldGUgPSBmYWxzZTtcbiAgICAgICAgICAgICRyb290U2NvcGUuaW52YWxpZF9ldmVudF9pZCA9IHRydWU7XG4gICAgICAgICAgICAkbG9nLmxvZygnRVJST1I6IGV2ZW50IG5keCBOT1QgRk9VTkQnKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvLy8vLy8vLy8vLy8vXG4gICAgLy8gU0VUVEVSUyAvL1xuICAgIC8vLy8vLy8vLy8vLy9cbiAgICAkcm9vdFNjb3BlLnNlbGVjdEV2ZW50ID0gZnVuY3Rpb24oZXZlbnRfaWQsIHRyYW5zaXRpb25fdmlldykge1xuXG4gICAgICAgICRyb290U2NvcGUuY2xlYW5BY3RpdmVEZXRhaWxzQnRucygpO1xuICAgICAgICAkc2NvcGUuc2V0RXZlbnQoZXZlbnRfaWQpO1xuXG4gICAgICAgICRsb2cubG9nKCdTZXR0aW5nIEV2ZW50JywgJHNjb3BlLmluZm9fY29tcGxldGUpO1xuICAgIH07XG5cbiAgICAkc2NvcGUuc2VsZWN0RXZlbnRWaWV3ID0gZnVuY3Rpb24odmlldywgZXZlbnRfaWQpIHtcblxuICAgICAgICAkcm9vdFNjb3BlLmNsZWFuQWN0aXZlRGV0YWlsc0J0bnMoKTtcbiAgICAgICAgaWYoZXZlbnRfaWQpIHtcbiAgICAgICAgICAgICRzY29wZS5zZXRFdmVudChldmVudF9pZCk7XG4gICAgICAgIH1cblxuXG4gICAgICAgICRsb2cubG9nKCdldmVudCBpZCcsICRzY29wZS5ldmVudF9pZCwgZXZlbnRfaWQpO1xuICAgICAgICBpZighJHNjb3BlLmluZm9fY29tcGxldGUpIHtcbiAgICAgICAgICAgICRsb2cubG9nKCdpbmZvX2luY29tcGxldGUnKTtcbiAgICAgICAgICAgICRzdGF0ZS50cmFuc2l0aW9uVG8oJ2Zvcm0uZXZlbnRfdmVudWUnLCB7ZXZlbnRJZDogZXZlbnRfaWR9KTtcbiAgICAgICAgfSBlbHNlIGlmKCRzY29wZS5ldmVudF9pZCkge1xuICAgICAgICAgICAgJHN0YXRlLnRyYW5zaXRpb25Ubyh2aWV3LCB7ZXZlbnRJZDogJHNjb3BlLmV2ZW50X2lkfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkc3RhdGUudHJhbnNpdGlvblRvKHZpZXcpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYodmlldyAhPT0gXCJmb3JtLmRhc2hib2FyZFwiICYmICEkc3RhdGUucGFyYW1zLnRhc2tJZCkge1xuICAgICAgICAgICAgJChcIi5mb3JtLWNvbnRhaW5lclwiKS5zY3JvbGxUb3AoMCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJHNjb3BlLmFsZGFTZWxlY3RFdmVudFZpZXcgPSBmdW5jdGlvbih2aWV3LCBldmVudF9pZCkge1xuXG4gICAgICAgICRyb290U2NvcGUuY2xlYW5BY3RpdmVEZXRhaWxzQnRucygpO1xuICAgICAgICBpZihldmVudF9pZCkge1xuICAgICAgICAgICAgJHNjb3BlLnNldEV2ZW50KGV2ZW50X2lkKTtcbiAgICAgICAgfVxuXG4gICAgICAgICRsb2cubG9nKCdldmVudCBpZCcsICRzY29wZS5ldmVudF9pZCwgZXZlbnRfaWQpO1xuICAgICAgICBpZigkc2NvcGUuZXZlbnRfaWQpIHtcbiAgICAgICAgICAgICRzdGF0ZS50cmFuc2l0aW9uVG8odmlldywge2V2ZW50SWQ6ICRzY29wZS5ldmVudF9pZH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJHN0YXRlLnRyYW5zaXRpb25Ubyh2aWV3KTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIC8vdGhlIGNvZGUgd2hpY2ggbmVlZHMgdG8gcnVuIGFmdGVyIGRvbSByZW5kZXJpbmdcbiAgICAgICAgJGxvZy5sb2coJ3N0YXRlIHBhcmFtcycsICRzdGF0ZS5wYXJhbXMpO1xuICAgICAgICBpZiAoJHN0YXRlLnBhcmFtcy5oYXNPd25Qcm9wZXJ0eSgnZXZlbnRJZCcpKSB7XG4gICAgICAgICAgICAkbG9nLmxvZygnaW5pdCAkc3RhdGUucGFyYW1zLmV2ZW50SWQgLT4gZXZlbnRfaWQnLCAkc2NvcGUuZXZlbnRfaWQpO1xuICAgICAgICAgICAgJHNjb3BlLmV2ZW50X2lkID0gJHN0YXRlLnBhcmFtcy5ldmVudElkO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gY2xlYXIgZm9ybSArIHRpY2tldHMgYnV0dG9uc1xuICAgICAgICAkcm9vdFNjb3BlLmNsZWFuQWN0aXZlRGV0YWlsc0J0bnMoKTtcblxuICAgICAgICBpZiAoJHNjb3BlLmV2ZW50X2lkKSB7XG4gICAgICAgICAgICAkbG9nLmxvZygnaW5pdCBzZXRFdmVudCBldmVudF9pZCcsICRzY29wZS5ldmVudF9pZCk7XG4gICAgICAgICAgICAkc2NvcGUuc2V0RXZlbnQoJHNjb3BlLmV2ZW50X2lkKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgLy8gZXhwYW5kIGZvciB0YXNrIHVybHNcbiAgICAgICAgaWYoJHN0YXRlLnBhcmFtcy50YXNrSWQgJiYgJHJvb3RTY29wZS5wcm9tb3Rlcl9ldmVudHMgJiYgJHJvb3RTY29wZS5jYXRzKSB7XG5cbiAgICAgICAgICAgIC8vIGV4cGFuZCBkYXNoYm9hcmQgdG8gZ2V0IGFsbCB0YXNrc1xuICAgICAgICAgICAgJHJvb3RTY29wZS5tYXhfaXRlbXMgPSAkcm9vdFNjb3BlLnByb21vdGVyX2V2ZW50c1skcm9vdFNjb3BlLmV2ZW50X25keF0udGFza3MubGVuZ3RoO1xuXG4gICAgICAgICAgICAvLyBmaW5kIHRoZSB0YXNrXG4gICAgICAgICAgICB2YXIgJHRhc2sgPSAkKCcjdGFza18nKyRzdGF0ZS5wYXJhbXMudGFza0lkKTtcblxuICAgICAgICAgICAgaWYoJHRhc2subGVuZ3RoKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgJGVsID0gJChcIi5mb3JtLWNvbnRhaW5lclwiKTtcblxuICAgICAgICAgICAgICAgIHZhciAkZW50cnlfZGV0YWlscyAgPSAkdGFzay5jbG9zZXN0KCcuZW50cnlfY29udGFpbmVyJykuZmluZCgnLmVudHJ5X2RldGFpbHMnKTtcbiAgICAgICAgICAgICAgICB2YXIgZGV0YWlsc19kaXNwbGF5ID0gJGVudHJ5X2RldGFpbHMuY3NzKCdkaXNwbGF5Jyk7XG5cbiAgICAgICAgICAgICAgICAvLyQoJ2JvZHknKS5maW5kKCcuZW50cnlfZGV0YWlscycpLnNsaWRlVXAoKTtcbiAgICAgICAgICAgICAgICAkKCdib2R5JykuZmluZCgnLmVudHJ5JykuY3NzKCdjb2xvcicsICcjNTU1Jyk7XG4gICAgICAgICAgICAgICAgJHRhc2suY3NzKCdjb2xvcicsICcjMDAwJyk7XG5cbiAgICAgICAgICAgICAgICAvLyBtYWtlIGNvbnRlbnQgbGFyZ2UgZW5vdWdoIHRwIHNjcm9sbCBpbiBjYXNlIHRhc2sgaXMgYXQgYm90dG9tXG4gICAgICAgICAgICAgICAgdmFyIG9yaWdpbmFsX2NvbnRlbnRfaGVpZ2h0ID0gJCgnLmNvbnRlbnRfaG9zdCcpLmhlaWdodCgpO1xuICAgICAgICAgICAgICAgICQoJy5jb250ZW50X2hvc3QnKS5oZWlnaHQob3JpZ2luYWxfY29udGVudF9oZWlnaHQgKyAkKCcjcHJvbW90ZXJzUm9vdCcpLmhlaWdodCgpKTtcblxuICAgICAgICAgICAgICAgIC8vIGZpbmQgdGhlIHRhc2sgb2Zmc2V0IGZyb20gdGhlIHRvcFxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd0YXNrX3RvcF9vZmZzZXQnLCAkdGFzay5vZmZzZXQoKS50b3AsICRlbC5vZmZzZXQoKS50b3ApO1xuXG4gICAgICAgICAgICAgICAgLy8gc2Nyb2xsIHRvIHRoZSB0YXNrXG4gICAgICAgICAgICAgICAgJGVsLnNjcm9sbFRvcCgkdGFzay5vZmZzZXQoKS50b3AgLSAkZWwub2Zmc2V0KCkudG9wKTtcblxuICAgICAgICAgICAgICAgICRlbnRyeV9kZXRhaWxzLnNsaWRlRG93bigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgICRzY29wZS5zaG93U3RhdHVzQnRucyA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHJldHVybiAkc3RhdGUuY3VycmVudC5uYW1lID09PSAnZm9ybS5kYXNoYm9hcmQnIHx8XG4gICAgICAgICAgICAgICAgJHN0YXRlLmN1cnJlbnQubmFtZSA9PT0gJ2Zvcm0uZ3JvdXAxJyB8fFxuICAgICAgICAgICAgICAgICRzdGF0ZS5jdXJyZW50Lm5hbWUgPT09ICdmb3JtLmdyb3VwMicgfHxcbiAgICAgICAgICAgICAgICAkc3RhdGUuY3VycmVudC5uYW1lID09PSAnZm9ybS5ncm91cDMnIHx8XG4gICAgICAgICAgICAgICAgJHN0YXRlLmN1cnJlbnQubmFtZSA9PT0gJ2Zvcm0uZ3JvdXA0JztcblxuICAgIH07XG5cbiAgICAkc2NvcGUuZ2V0U05hbWUgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICBpZighJHN0YXRlLmN1cnJlbnQuaGFzT3duUHJvcGVydHkoJ2RhdGEnKSB8fCAhJHN0YXRlLmN1cnJlbnQuZGF0YS5oYXNPd25Qcm9wZXJ0eSgnbmFtZScpKSB7XG5cbiAgICAgICAgICAgICRsb2cubG9nKCdzdGF0ZSBpcyBtaXNzaW5nIGRhdGEgcHJvcGVydHknKTtcbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgkc3RhdGUuY3VycmVudC5uYW1lICE9PSAnZm9ybS5ncm91cDEnICYmXG4gICAgICAgICAgICAkc3RhdGUuY3VycmVudC5uYW1lICE9PSAnZm9ybS5ncm91cDInICYmXG4gICAgICAgICAgICAkc3RhdGUuY3VycmVudC5uYW1lICE9PSAnZm9ybS5ncm91cDMnICYmXG4gICAgICAgICAgICAkc3RhdGUuY3VycmVudC5uYW1lICE9PSAnZm9ybS5ncm91cDQnKSB7XG5cbiAgICAgICAgICAgIHJldHVybiAkc3RhdGUuY3VycmVudC5kYXRhLm5hbWU7XG5cbiAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgaWYoJHJvb3RTY29wZS5jYXRzICYmICRyb290U2NvcGUuY2F0cy5sZW5ndGggPiAwKSB7XG5cbiAgICAgICAgICAgICAgICAkbG9nLmxvZygnZ2V0U05hbWUgY2F0cyBleGlzdCcpO1xuXG4gICAgICAgICAgICAgICAgLy8gaXRzIG9yIHN0cmluZ3MgaWQncyBEOlxuICAgICAgICAgICAgICAgIHZhciBjYXRfaXRlbSA9IF8uZmluZFdoZXJlKCRyb290U2NvcGUuY2F0cywge2lkOiBwYXJzZUludCgkc3RhdGUuY3VycmVudC5kYXRhLm5hbWUsIDEwKX0pO1xuICAgICAgICAgICAgICAgIGlmKGNhdF9pdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICRsb2cubG9nKCdnZXRTTmFtZSAtIGZvdW5kIGludCBjYXQnLCBjYXRfaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjYXRfaXRlbS5uYW1lO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNhdF9pdGVtID0gXy5maW5kV2hlcmUoJHJvb3RTY29wZS5jYXRzLCB7aWQ6ICRzdGF0ZS5jdXJyZW50LmRhdGEubmFtZX0pO1xuICAgICAgICAgICAgICAgICAgICBpZihjYXRfaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGxvZy5sb2coJ2dldFNOYW1lIC0gZm91bmQgc3RyaW5nIGNhdCcsIGNhdF9pdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjYXRfaXRlbS5uYW1lO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgICRzY29wZS5zZXRGb3JtZGF0YSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIHZhciBleHBsb2RlZF9jdXJmZXcgPSAkcm9vdFNjb3BlLnByb21vdGVyX2V2ZW50c1skcm9vdFNjb3BlLmV2ZW50X25keF0uZXZlbnQuY3VyZmV3LnNwbGl0KCc6Jyk7XG4gICAgICAgIGlmKGV4cGxvZGVkX2N1cmZldy5sZW5ndGggPiAxKSB7XG5cbiAgICAgICAgICAgIHZhciBjdXJmZXdfaG91ciA9IHBhcnNlSW50KGV4cGxvZGVkX2N1cmZld1swXSwgMTApO1xuICAgICAgICAgICAgdmFyIGN1cmZld19taW4gPSBwYXJzZUludChleHBsb2RlZF9jdXJmZXdbMV0uc3BsaXQoJy4nKVswXSwgMTApO1xuXG4gICAgICAgICAgICBpZihjdXJmZXdfaG91ciA+PSAwICYmIGN1cmZld19ob3VyIDwgMjQgJiYgY3VyZmV3X21pbiA+PSAwICYmIGN1cmZld19taW4gPCA2MCkge1xuICAgICAgICAgICAgICAgICRzY29wZS52ZW51ZURhdGEuY3VyZmV3ID0gbmV3IERhdGUoMTk3MCwgMCwgMSwgY3VyZmV3X2hvdXIsIGN1cmZld19taW4sIDApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUudmVudWVEYXRhLmN1cmZldyA9IG5ldyBEYXRlKDE5NzAsIDAsIDEsIDAsIDAsIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgJHNjb3BlLnZlbnVlRGF0YS5taW5pbWFsX2FnZV9saW1pdCAgICAgICAgICAgICAgICAgICAgID0gJHJvb3RTY29wZS5wcm9tb3Rlcl9ldmVudHNbJHJvb3RTY29wZS5ldmVudF9uZHhdLmV2ZW50Lm1pbmltYWxfYWdlX2xpbWl0O1xuICAgICAgICAkc2NvcGUudmVudWVEYXRhLmFsY29ob2xfbGljZW5zZSAgICAgICAgICAgICAgICAgICAgICAgPSAkcm9vdFNjb3BlLnByb21vdGVyX2V2ZW50c1skcm9vdFNjb3BlLmV2ZW50X25keF0uZXZlbnQuYWxjb2hvbF9saWNlbnNlO1xuICAgICAgICAkc2NvcGUudmVudWVEYXRhLnJlc3RyaWN0aW9uc19vbl9tZXJjaGFuZGlzZV9zYWxlcyAgICAgPSAkcm9vdFNjb3BlLnByb21vdGVyX2V2ZW50c1skcm9vdFNjb3BlLmV2ZW50X25keF0uZXZlbnQucmVzdHJpY3Rpb25zX29uX21lcmNoYW5kaXNlX3NhbGVzO1xuICAgICAgICAkc2NvcGUudmVudWVEYXRhLnNvdW5kX3Jlc3RyaWN0aW9ucyAgICAgICAgICAgICAgICAgICAgPSAkcm9vdFNjb3BlLnByb21vdGVyX2V2ZW50c1skcm9vdFNjb3BlLmV2ZW50X25keF0uZXZlbnQuc291bmRfcmVzdHJpY3Rpb25zO1xuXG4gICAgICAgIC8vIGJvb2tlZCBmb3Igc2V0dXAgZnJvbVxuICAgICAgICBpZigkcm9vdFNjb3BlLnByb21vdGVyX2V2ZW50c1skcm9vdFNjb3BlLmV2ZW50X25keF0uZXZlbnQuYm9va2VkX2Zvcl9zZXR1cF9mcm9tID09PSBcIjAwMDAtMDAtMDBcIilcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyIHl5eXkgPSAkcm9vdFNjb3BlLnRvZGF5LmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKTtcbiAgICAgICAgICAgIHZhciBtbSAgID0gKCRyb290U2NvcGUudG9kYXkuZ2V0TW9udGgoKSsxKS50b1N0cmluZygpO1xuICAgICAgICAgICAgdmFyIGRkICAgPSAkcm9vdFNjb3BlLnRvZGF5LmdldERhdGUoKS50b1N0cmluZygpO1xuXG4gICAgICAgICAgICAkc2NvcGUudmVudWVEYXRhLmJvb2tlZF9mb3Jfc2V0dXBfZnJvbSA9IHl5eXkrJy0nKyhtbVsxXT9tbTpcIjBcIittbVswXSkrJy0nKyhkZFsxXT9kZDpcIjBcIitkZFswXSk7IC8vIHBhZGRpbmdcbiAgICAgICAgfVxuICAgICAgICBlbHNlXG4gICAgICAgIHtcbiAgICAgICAgICAgICRzY29wZS52ZW51ZURhdGEuYm9va2VkX2Zvcl9zZXR1cF9mcm9tID0gJHJvb3RTY29wZS5wcm9tb3Rlcl9ldmVudHNbJHJvb3RTY29wZS5ldmVudF9uZHhdLmV2ZW50LmJvb2tlZF9mb3Jfc2V0dXBfZnJvbTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGJvb2tlZCBmb3IgYnJlYWsgdW50aWxcbiAgICAgICAgaWYoJHJvb3RTY29wZS5wcm9tb3Rlcl9ldmVudHNbJHJvb3RTY29wZS5ldmVudF9uZHhdLmV2ZW50LmJvb2tlZF9mb3JfYnJlYWtfdW50aWwgPT09IFwiMDAwMC0wMC0wMFwiKVxuICAgICAgICB7XG4gICAgICAgICAgICAkc2NvcGUudmVudWVEYXRhLmJvb2tlZF9mb3JfYnJlYWtfdW50aWwgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICB7XG4gICAgICAgICAgICAkc2NvcGUudmVudWVEYXRhLmJvb2tlZF9mb3JfYnJlYWtfdW50aWwgPSAkcm9vdFNjb3BlLnByb21vdGVyX2V2ZW50c1skcm9vdFNjb3BlLmV2ZW50X25keF0uZXZlbnQuYm9va2VkX2Zvcl9icmVha191bnRpbDtcbiAgICAgICAgfVxuXG4gICAgICAgICRzY29wZS5ob3NwaXRhbGl0eURhdGEuaG90ZWwxX25hbWUgICAgICAgICAgICAgICAgICAgICA9ICRyb290U2NvcGUucHJvbW90ZXJfZXZlbnRzWyRyb290U2NvcGUuZXZlbnRfbmR4XS5ldmVudC5ob3RlbDFfbmFtZTtcbiAgICAgICAgJHNjb3BlLmhvc3BpdGFsaXR5RGF0YS5ob3RlbDFfd2Vic2l0ZSAgICAgICAgICAgICAgICAgID0gJHJvb3RTY29wZS5wcm9tb3Rlcl9ldmVudHNbJHJvb3RTY29wZS5ldmVudF9uZHhdLmV2ZW50LmhvdGVsMV93ZWJzaXRlO1xuICAgICAgICAkc2NvcGUuaG9zcGl0YWxpdHlEYXRhLmhvdGVsMV90cmF2ZWxfdGltZV9mcm9tX2FpcnBvcnQgPSAkcm9vdFNjb3BlLnByb21vdGVyX2V2ZW50c1skcm9vdFNjb3BlLmV2ZW50X25keF0uZXZlbnQuaG90ZWwxX3RyYXZlbF90aW1lX2Zyb21fYWlycG9ydDtcbiAgICAgICAgJHNjb3BlLmhvc3BpdGFsaXR5RGF0YS5ob3RlbDFfdHJhdmVsX3RpbWVfZnJvbV92ZW51ZSAgID0gJHJvb3RTY29wZS5wcm9tb3Rlcl9ldmVudHNbJHJvb3RTY29wZS5ldmVudF9uZHhdLmV2ZW50LmhvdGVsMV90cmF2ZWxfdGltZV9mcm9tX3ZlbnVlO1xuICAgICAgICAkc2NvcGUuaG9zcGl0YWxpdHlEYXRhLmhvdGVsMl9uYW1lICAgICAgICAgICAgICAgICAgICAgPSAkcm9vdFNjb3BlLnByb21vdGVyX2V2ZW50c1skcm9vdFNjb3BlLmV2ZW50X25keF0uZXZlbnQuaG90ZWwyX25hbWU7XG4gICAgICAgICRzY29wZS5ob3NwaXRhbGl0eURhdGEuaG90ZWwyX3dlYnNpdGUgICAgICAgICAgICAgICAgICA9ICRyb290U2NvcGUucHJvbW90ZXJfZXZlbnRzWyRyb290U2NvcGUuZXZlbnRfbmR4XS5ldmVudC5ob3RlbDJfd2Vic2l0ZTtcbiAgICAgICAgJHNjb3BlLmhvc3BpdGFsaXR5RGF0YS5ob3RlbDJfdHJhdmVsX3RpbWVfZnJvbV9haXJwb3J0ID0gJHJvb3RTY29wZS5wcm9tb3Rlcl9ldmVudHNbJHJvb3RTY29wZS5ldmVudF9uZHhdLmV2ZW50LmhvdGVsMl90cmF2ZWxfdGltZV9mcm9tX2FpcnBvcnQ7XG4gICAgICAgICRzY29wZS5ob3NwaXRhbGl0eURhdGEuaG90ZWwyX3RyYXZlbF90aW1lX2Zyb21fdmVudWUgICA9ICRyb290U2NvcGUucHJvbW90ZXJfZXZlbnRzWyRyb290U2NvcGUuZXZlbnRfbmR4XS5ldmVudC5ob3RlbDJfdHJhdmVsX3RpbWVfZnJvbV92ZW51ZTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnJlZ2lzdHJhdGlvblN1Ym1pc3Npb24gPSBmdW5jdGlvbih0eXBlLCBzdGF0ZSkge1xuXG4gICAgICAgIC8vIHR5cGUgaXMgd2hhdCB3ZSBhcmUgc3VibWl0dGluZywgc3RhdGUgaXMgd2hlcmUgd2UgYXJlIGdvaW5nXG4gICAgICAgIHZhciBwb3N0X3VybCwgcG9zdF9kYXRhO1xuICAgICAgICB2YXIgZWwgICAgICAgID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwcm9tb3RlcnNSb290XCIpO1xuICAgICAgICB2YXIgdG9rZW5fc3RyID0gYW5ndWxhci5lbGVtZW50KGVsKS5kYXRhKCd0b2tlbicpO1xuXG4gICAgICAgIHZhciBuZHg7XG4gICAgICAgIHN3aXRjaCh0eXBlKSB7XG4gICAgICAgICAgICBjYXNlICd2ZW51ZSc6XG4gICAgICAgICAgICAgICAgcG9zdF91cmwgID0gXCIvbXktZXZlbnRzL1wiKyRzY29wZS5ldmVudF9pZCtcIi9kZXRhaWxzL3ZlbnVlXCI7XG4gICAgICAgICAgICAgICAgcG9zdF9kYXRhID0gYW5ndWxhci5leHRlbmQoe30sIHtfdG9rZW46IHRva2VuX3N0cn0sICRzY29wZS52ZW51ZURhdGEpO1xuICAgICAgICAgICAgICAgIHZhciBhZGp1c3RlZF9kYXRlID0gbmV3IERhdGUoJHNjb3BlLnZlbnVlRGF0YS5jdXJmZXcuZ2V0VGltZSgpIC0gJHNjb3BlLnZlbnVlRGF0YS5jdXJmZXcuZ2V0VGltZXpvbmVPZmZzZXQoKSAqIDYwMDAwKTtcbiAgICAgICAgICAgICAgICBwb3N0X2RhdGEuY3VyZmV3ID0gYWRqdXN0ZWRfZGF0ZTtcbiAgICAgICAgICAgICAgICBuZHggPSAxO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnaG9zcGl0YWxpdHknOlxuICAgICAgICAgICAgICAgIHBvc3RfdXJsICA9IFwiL215LWV2ZW50cy9cIiskc2NvcGUuZXZlbnRfaWQrXCIvZGV0YWlscy9ob3NwaXRhbGl0eVwiO1xuICAgICAgICAgICAgICAgIHBvc3RfZGF0YSA9IGFuZ3VsYXIuZXh0ZW5kKHt9LCB7X3Rva2VuOiB0b2tlbl9zdHJ9LCAkc2NvcGUuaG9zcGl0YWxpdHlEYXRhKTtcbiAgICAgICAgICAgICAgICBuZHggPSAyO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIGV2ZW50c1NlcnZpY2UucG9zdFNlcnZlckRhdGEocG9zdF91cmwsIHBvc3RfZGF0YSkudGhlbihmdW5jdGlvbihkYXRhKSB7XG5cbiAgICAgICAgICAgICRsb2cubG9nKCdwb3N0ZWQgJyt0eXBlKycgdG8gJytwb3N0X3VybCwgcG9zdF9kYXRhLCBkYXRhID09PSAnT0snKTtcbiAgICAgICAgICAgIGlmKGRhdGEgPT09ICdPSycpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmluZm9fY29tcGxldGUgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgJGxvZy5sb2coXCJzdGF0ZVwiLCBzdGF0ZSk7XG4gICAgICAgICAgICAgICAgLy8kc2NvcGUuc2VsZWN0RXZlbnRWaWV3KHN0YXRlLCAkc2NvcGUuZXZlbnRfaWQpO1xuICAgICAgICAgICAgICAgICRzdGF0ZS50cmFuc2l0aW9uVG8oc3RhdGUsIHtldmVudElkOiAkc2NvcGUuZXZlbnRfaWR9KTtcbiAgICAgICAgICAgICAgICAvLyRyb290U2NvcGUuaW5pdERhdGEoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5nb0JhY2sgPSBmdW5jdGlvbih0eXBlLCBzdGF0ZSkge1xuXG4gICAgICAgIHZhciBuZHg7XG4gICAgICAgIHN3aXRjaCh0eXBlKSB7XG4gICAgICAgICAgICBjYXNlICdvdmVydmlldyc6XG4gICAgICAgICAgICAgICAgbmR4ID0gMjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2hvc3BpdGFsaXR5JzpcbiAgICAgICAgICAgICAgICBuZHggPSAxO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAndmVudWUnOlxuICAgICAgICAgICAgICAgIG5keCA9IDA7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgJGxvZy5sb2codHlwZSwgbmR4KTtcblxuICAgICAgICAvLyBvdmVydmlldyBpcyBtYXggYXRtID0gNFxuICAgICAgICBpZihuZHggPCA0ICYmIG5keCA+IDApIHtcblxuICAgICAgICAgICAgJChcIi5wcm9ncmVzc19iYXIgbGlcIikuZXEobmR4KS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcblxuICAgICAgICAgICAgLy8gaWYgdmFsaWRhdGlvbiBvayBnbyB0byBuZXh0XG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0RXZlbnRWaWV3KHN0YXRlKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvLy8vLy8vLy8vXG4gICAgLy8gSlVOSyAvL1xuICAgIC8vLy8vLy8vLy9cbiAgICAkc2NvcGUuc2V0TWF4VGFza3MgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICBpZigkcm9vdFNjb3BlLm1heF9pdGVtcyA8ICRyb290U2NvcGUucHJvbW90ZXJfZXZlbnRzWyRyb290U2NvcGUuZXZlbnRfbmR4XS50YXNrcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICRyb290U2NvcGUubWF4X2l0ZW1zID0gJHJvb3RTY29wZS5wcm9tb3Rlcl9ldmVudHNbJHJvb3RTY29wZS5ldmVudF9uZHhdLnRhc2tzLmxlbmd0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICRyb290U2NvcGUubWF4X2l0ZW1zID0gNTtcbiAgICAgICAgICAgICQoXCIuZm9ybS1jb250YWluZXJcIikuc2Nyb2xsVG9wKDApO1xuICAgICAgICAgICAgJGxvZy5sb2coJz4+Pj4gbmV3IGpzJyk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gc3dpdGNoIGJldHdlZW4gZXZlbnQgcm93cyBhbmQgZXZlbnQgYnRucyB2aWV3c1xuICAgICRzY29wZS50b2dnbGVWaWV3ID0gZnVuY3Rpb24odHlwZSlcbiAgICB7XG4gICAgICAgIGlmKHR5cGUgPT09ICdyb3dzJykge1xuXG4gICAgICAgICAgICAkc2NvcGUuc2hvd19yb3dzID0gdHJ1ZTtcbiAgICAgICAgICAgICRzY29wZS5zaG93X2J1dHRvbnMgPSBmYWxzZTtcblxuICAgICAgICAgICAgJCgnLnZpZXctc2VsJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgJCgnLmxpc3Qtc2VsJykuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuXG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICRzY29wZS5zaG93X3Jvd3MgPSBmYWxzZTtcbiAgICAgICAgICAgICRzY29wZS5zaG93X2J1dHRvbnMgPSB0cnVlO1xuXG4gICAgICAgICAgICAkKCcudmlldy1zZWwnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgICAkKCcuYnRuLXNlbCcpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkc2NvcGUuZ2V0RXZlbnRDb21wbGV0aW9uU3RyaW5nID0gZnVuY3Rpb24oZXYpXG4gICAge1xuICAgICAgICBpZighZXYpIHtcbiAgICAgICAgICAgIHJldHVybiAnMC8wJztcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBkb25lICA9IGV2LmRldGFpbHMuY29tcGxldGlvbi5ncm91cDEuY29tcGxldGVkICsgZXYuZGV0YWlscy5jb21wbGV0aW9uLmdyb3VwMi5jb21wbGV0ZWQgKyBldi5kZXRhaWxzLmNvbXBsZXRpb24uZ3JvdXAzLmNvbXBsZXRlZCArIGV2LmRldGFpbHMuY29tcGxldGlvbi5ncm91cDQuY29tcGxldGVkO1xuICAgICAgICB2YXIgdG90YWwgPSBldi5kZXRhaWxzLmNvbXBsZXRpb24uZ3JvdXAxLnRvdGFsICsgZXYuZGV0YWlscy5jb21wbGV0aW9uLmdyb3VwMi50b3RhbCArIGV2LmRldGFpbHMuY29tcGxldGlvbi5ncm91cDMudG90YWwgKyBldi5kZXRhaWxzLmNvbXBsZXRpb24uZ3JvdXA0LnRvdGFsO1xuXG4gICAgICAgIHJldHVybiBkb25lK1wiIC8gXCIrdG90YWw7XG4gICAgfTtcblxuICAgICRzY29wZS5ldmVudHNFeGlzdCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICRsb2cubG9nKCdudW1fZXZlbnRzJywgJHJvb3RTY29wZS5wcm9tb3Rlcl9ldmVudHMgLmxlbmd0aCk7XG4gICAgfTtcblxuICAgICRzY29wZS50YXNrc1JlbWFpbmluZyA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIGlmKCRyb290U2NvcGUucHJvbW90ZXJfZXZlbnRzID09PSB1bmRlZmluZWQgfHwgISRyb290U2NvcGUucHJvbW90ZXJfZXZlbnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZ3JvdXAxX3JlbWFpbmluZyA9ICRyb290U2NvcGUucHJvbW90ZXJfZXZlbnRzWyRyb290U2NvcGUuZXZlbnRfbmR4XS5kZXRhaWxzLmNvbXBsZXRpb24uZ3JvdXAxLnRvdGFsIC0gJHJvb3RTY29wZS5wcm9tb3Rlcl9ldmVudHNbJHJvb3RTY29wZS5ldmVudF9uZHhdLmRldGFpbHMuY29tcGxldGlvbi5ncm91cDEuY29tcGxldGVkO1xuICAgICAgICB2YXIgZ3JvdXAyX3JlbWFpbmluZyA9ICRyb290U2NvcGUucHJvbW90ZXJfZXZlbnRzWyRyb290U2NvcGUuZXZlbnRfbmR4XS5kZXRhaWxzLmNvbXBsZXRpb24uZ3JvdXAyLnRvdGFsIC0gJHJvb3RTY29wZS5wcm9tb3Rlcl9ldmVudHNbJHJvb3RTY29wZS5ldmVudF9uZHhdLmRldGFpbHMuY29tcGxldGlvbi5ncm91cDIuY29tcGxldGVkO1xuICAgICAgICB2YXIgZ3JvdXAzX3JlbWFpbmluZyA9ICRyb290U2NvcGUucHJvbW90ZXJfZXZlbnRzWyRyb290U2NvcGUuZXZlbnRfbmR4XS5kZXRhaWxzLmNvbXBsZXRpb24uZ3JvdXAzLnRvdGFsIC0gJHJvb3RTY29wZS5wcm9tb3Rlcl9ldmVudHNbJHJvb3RTY29wZS5ldmVudF9uZHhdLmRldGFpbHMuY29tcGxldGlvbi5ncm91cDMuY29tcGxldGVkO1xuICAgICAgICB2YXIgZ3JvdXA0X3JlbWFpbmluZyA9ICRyb290U2NvcGUucHJvbW90ZXJfZXZlbnRzWyRyb290U2NvcGUuZXZlbnRfbmR4XS5kZXRhaWxzLmNvbXBsZXRpb24uZ3JvdXA0LnRvdGFsIC0gJHJvb3RTY29wZS5wcm9tb3Rlcl9ldmVudHNbJHJvb3RTY29wZS5ldmVudF9uZHhdLmRldGFpbHMuY29tcGxldGlvbi5ncm91cDQuY29tcGxldGVkO1xuXG4gICAgICAgIHJldHVybiBncm91cDFfcmVtYWluaW5nICsgZ3JvdXAyX3JlbWFpbmluZyArIGdyb3VwM19yZW1haW5pbmcgKyBncm91cDRfcmVtYWluaW5nO1xuICAgIH07XG5cbiAgICAvLyBub3RpZmljYXRpb25zIG1vZGFsXG4gICAgJHNjb3BlLm9wZW5Ob3RpZmljYXRpb25zTW9kYWwgPSBmdW5jdGlvbiAodGFzaywgZW1haWxfb2JqLCBzaXplKSB7XG5cbiAgICAgICAgJHNjb3BlLmVtYWlsX29iaiA9IGVtYWlsX29iajtcblxuICAgICAgICAkbW9kYWwub3Blbih7XG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ215TW9kYWxDb250ZW50Lmh0bWwnLFxuICAgICAgICAgICAgYmFja2Ryb3A6IHRydWUsXG4gICAgICAgICAgICB3aW5kb3dDbGFzczogJ25nbW9kYWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogZnVuY3Rpb24gKCRzY29wZSwgJG1vZGFsSW5zdGFuY2UsICRsb2csIGVtYWlsX29iaikge1xuXG4gICAgICAgICAgICAgICAgJHNjb3BlLmVtYWlsX29iaiA9IGVtYWlsX29iajtcblxuICAgICAgICAgICAgICAgICRtb2RhbEluc3RhbmNlLm9wZW5lZC50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAvLyB2YXIgZSA9ICQuRXZlbnQoIFwibmdNb2RhbE9wZW5cIiwgeyBkYXRhOiAnJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgLy8gJGxvZy5sb2coJz4+PiBldmVudCB0cmlnZ2VyZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gJCh3aW5kb3cpLnRyaWdnZXIoZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgd2luZG93SGVpZ2h0ID0gJCh3aW5kb3cpLmhlaWdodCgpID8gJCh3aW5kb3cpLmhlaWdodCgpIDogd2luZG93LmlubmVySGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcF9vZmZzZXQgPSAod2luZG93SGVpZ2h0LzIpIC0gMjEwO1xuICAgICAgICAgICAgICAgICAgICAgICAgJGxvZy5sb2coJz4+IE9GRlNFVCcsIHRvcF9vZmZzZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLm1vZGFsLWNvbnRlbnQnKS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogdG9wX29mZnNldFxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2cubG9nKCdWYWxpZCByZXNpemUgPz8/JywgKCQod2luZG93KS5oZWlnaHQoKS8yKSAtIDIxMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcubW9kYWwtY29udGVudCcpLmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgkKHdpbmRvdykuaGVpZ2h0KCkvMikgLSAyMTA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgJHNjb3BlLm9rID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlc29sdmUgcHJvbWlzZSBhbmQgZ2V0IGFsbCB0aGUgdGhpbmdzXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50c1NlcnZpY2UucG9zdFNlcnZlckRhdGEoJy9hcGkvdjEvbXktZXZlbnRzLycrdGFzay5pbmZvLmV2ZW50c19pZCsnL3Rhc2tzLycrdGFzay5pbmZvLmlkKycvZW1haWwnLCB7ZW1haWxfc3ViamVjdDogZW1haWxfb2JqLnN1YmplY3QsIGVtYWlsX2NvbnRlbnQ6IGVtYWlsX29iai5tZXNzYWdlfSkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2cubG9nKFwiTm90aWZpY2F0aW9uIHNlbnQuLi5cIik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICRtb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAkc2NvcGUuY2FuY2VsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAkbW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdjYW5jZWwnKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICBlbWFpbF9vYmo6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmVtYWlsX29iajtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgfTtcblxuICAgICRzY29wZS5zdHIyRGF0ZSA9IGZ1bmN0aW9uKGRhdGUpe1xuXG4gICAgICAgIGlmKCFkYXRlKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IERhdGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBlZCAgICAgICAgID0gZGF0ZS5yZXBsYWNlKC8tL2csIFwiL1wiKTtcbiAgICAgICAgdmFyIGV2ZW50X2RhdGUgPSBuZXcgRGF0ZShlZCk7XG5cbiAgICAgICAgcmV0dXJuIGV2ZW50X2RhdGU7XG4gICAgfTtcblxuICAgICRzY29wZS5kYXlzTGVmdCA9IGZ1bmN0aW9uKGRlYWRsaW5lKSB7XG5cbiAgICAgICAgLy8gbnVtIGRheXMgbGVmdCB0aWxsIHRhc2sgZGVhZGxpbmVcbiAgICAgICAgaWYoIWRlYWRsaW5lKSB7XG4gICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgdG9kYXkgICAgICA9IG5ldyBEYXRlKCk7XG4gICAgICAgIHZhciBlZCAgICAgICAgID0gZGVhZGxpbmUucmVwbGFjZSgvLS9nLCBcIi9cIik7XG4gICAgICAgIHZhciBldmVudF9kYXRlID0gbmV3IERhdGUoZWQpO1xuICAgICAgICB2YXIgZGF5c19kaWZmICA9IE1hdGgucm91bmQoIChldmVudF9kYXRlLmdldFRpbWUoKS10b2RheS5nZXRUaW1lKCkpIC8gKDI0KjYwKjYwKjEwMDApICk7XG5cbiAgICAgICAgcmV0dXJuIGRheXNfZGlmZjtcbiAgICB9O1xuXG5cbiAgICAvLy8vLy8vLy9cbiAgICAvLyBDU1MgLy9cbiAgICAvLy8vLy8vLy9cbiAgICAkc2NvcGUuZ2V0RXZlbnREZWFkbGluZUNsYXNzID0gZnVuY3Rpb24oZHVlX2RhdGUpXG4gICAge1xuICAgICAgICBpZighZHVlX2RhdGUpIHtcbiAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBkYXlzX2xlZnQgID0gJHNjb3BlLmRheXNMZWZ0KGR1ZV9kYXRlKTtcblxuICAgICAgICB2YXIgdXJnZW5jeV9jbGFzcyA9IFwidXJnZW5jeV9ncmVlblwiO1xuICAgICAgICBpZihkYXlzX2xlZnQgPCAxNSkge1xuICAgICAgICAgICAgdXJnZW5jeV9jbGFzcyA9IFwidXJnZW5jeV9yZWRcIjtcbiAgICAgICAgfSBlbHNlIGlmKGRheXNfbGVmdCA8IDIwKSB7XG4gICAgICAgICAgICB1cmdlbmN5X2NsYXNzID0gXCJ1cmdlbmN5X3llbGxvd1wiO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHVyZ2VuY3lfY2xhc3M7XG4gICAgfTtcblxuICAgICRzY29wZS5nZXRBY3RpdmUgPSBmdW5jdGlvbih0eXBlKVxuICAgIHtcbiAgICAgICAgaWYodHlwZSA9PT0gJ3Jvd3MnKSB7XG4gICAgICAgICAgICByZXR1cm4gJHNjb3BlLnNob3dfcm93cyA/ICdhY3RpdmUnIDogJyc7XG4gICAgICAgIH0gZWxzZSBpZih0eXBlID09PSAnYnRucycpIHtcbiAgICAgICAgICAgIHJldHVybiAkc2NvcGUuc2hvd19idXR0b25zID8gJ2FjdGl2ZScgOiAnJztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAnJztcbiAgICB9O1xuXG4gICAgJHNjb3BlLmdldENvbXBsZXRpb25CYXJDU1MgPSBmdW5jdGlvbih0Zykge1xuXG4gICAgICAgIGlmKCF0Zykge1xuICAgICAgICAgICAgcmV0dXJuIHt3aWR0aDogJzAlJ307XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgdG90YWwgPSB0Zy50b3RhbDtcbiAgICAgICAgdmFyIGRvbmUgID0gdGcuY29tcGxldGVkO1xuICAgICAgICB2YXIgcGVyYyAgPSAodG90YWwgPD0gMCA/IDEwMCA6IDEwMCooZG9uZS90b3RhbCkpO1xuXG4gICAgICAgIHJldHVybiB7d2lkdGg6IHBlcmMrJyUnfTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmdldEV2ZW50Q29tcGxldGlvbkNTUyA9IGZ1bmN0aW9uKGV2KVxuICAgIHtcbiAgICAgICAgaWYoIWV2KSB7XG4gICAgICAgICAgICByZXR1cm4ge3dpZHRoOiAnMCUnfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBkb25lICA9IGV2LmRldGFpbHMuY29tcGxldGlvbi5ncm91cDEuY29tcGxldGVkICsgZXYuZGV0YWlscy5jb21wbGV0aW9uLmdyb3VwMi5jb21wbGV0ZWQgKyBldi5kZXRhaWxzLmNvbXBsZXRpb24uZ3JvdXAzLmNvbXBsZXRlZCArIGV2LmRldGFpbHMuY29tcGxldGlvbi5ncm91cDQuY29tcGxldGVkO1xuICAgICAgICB2YXIgdG90YWwgPSBldi5kZXRhaWxzLmNvbXBsZXRpb24uZ3JvdXAxLnRvdGFsICsgZXYuZGV0YWlscy5jb21wbGV0aW9uLmdyb3VwMi50b3RhbCArIGV2LmRldGFpbHMuY29tcGxldGlvbi5ncm91cDMudG90YWwgKyBldi5kZXRhaWxzLmNvbXBsZXRpb24uZ3JvdXA0LnRvdGFsO1xuICAgICAgICB2YXIgcGVyYyAgPSAodG90YWwgPD0gMCA/IDEwMCA6IDEwMCooZG9uZS90b3RhbCkpO1xuXG4gICAgICAgIHJldHVybiB7d2lkdGg6IHBlcmMrJyUnfTtcbiAgICB9O1xuXG4gICAgdmFyIHdhaXRGb3JSZW5kZXJBbmREb1NvbWV0aGluZyA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICBpZigkaHR0cC5wZW5kaW5nUmVxdWVzdHMubGVuZ3RoID4gMCkge1xuXG4gICAgICAgICAgJHRpbWVvdXQod2FpdEZvclJlbmRlckFuZERvU29tZXRoaW5nKTsgLy8gV2FpdCBmb3IgYWxsIHRlbXBsYXRlcyB0byBiZSBsb2FkZWRcblxuICAgICAgfSBlbHNlIHtcblxuICAgICAgICAvL3RoZSBjb2RlIHdoaWNoIG5lZWRzIHRvIHJ1biBhZnRlciBkb20gcmVuZGVyaW5nXG4gICAgICAgICRzY29wZS5pbml0KCk7XG4gICAgICAgIGlmKCQoJyNwcm9tb3RlcnNSb290JykubGVuZ3RoKSB7XG5cbiAgICAgICAgICAgIGlmKCRzdGF0ZS5jdXJyZW50Lm5hbWUgPT09ICdmb3JtJykge1xuICAgICAgICAgICAgICAgIGlmKCQoXCIuZGVmYXVsdC1idG5zXCIpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAkc3RhdGUudHJhbnNpdGlvblRvKCdmb3JtLmV2ZW50cy5idXR0b25zJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkc3RhdGUudHJhbnNpdGlvblRvKCdmb3JtLmV2ZW50cy5yb3dzJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgICAkdGltZW91dCh3YWl0Rm9yUmVuZGVyQW5kRG9Tb21ldGhpbmcpOyAvLyBXYWl0cyBmb3IgZmlyc3QgZGlnZXN0IGN5Y2xlXG59XSk7XG5cbiIsIi8vIFRhc2sgQ29udHJvbGxlciBmb3IgcGVyIHRhc2sgaXNvbGF0ZWQgc2NvcGluZ1xud2luZG93LmFuZ3VsYXIubW9kdWxlKCdwcm9tb3RlcnNBcHAnKS5jb250cm9sbGVyKCdUYXNrQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRyb290U2NvcGUnLCAnJHN0YXRlJywgJyRtb2RhbCcsICckbG9nJywgJyR1cGxvYWQnLCAnZXZlbnRzU2VydmljZScsIGZ1bmN0aW9uICgkc2NvcGUsICRyb290U2NvcGUsICRzdGF0ZSwgJG1vZGFsLCAkbG9nLCAkdXBsb2FkLCBldmVudHNTZXJ2aWNlKSB7XG5cbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgXyA9IHdpbmRvdy5fO1xuXG4gICAgJHNjb3BlLml0YXNrICAgICAgICAgICAgICA9IHVuZGVmaW5lZDtcbiAgICAkc2NvcGUuaWZpbGVzICAgICAgICAgICAgID0gdW5kZWZpbmVkO1xuICAgICRzY29wZS5jb21tZW50ICAgICAgICAgICAgPSBcIlwiO1xuICAgICRzY29wZS5jb21wbGV0aW9uX3N0YXR1cyAgPSB0cnVlO1xuICAgICRzY29wZS5hY3RpdmVfc3RhdHVzICAgICAgPSB0cnVlO1xuXG4gICAgJHNjb3BlLnByb2dyZXNzUGVyY2VudGFnZSA9IDA7XG4gICAgJHNjb3BlLnVwbG9hZHNDb21wbGV0ZSAgICA9IHRydWU7XG4gICAgJHNjb3BlLnMzICAgICAgICAgICAgICAgICA9IHsgcG9saWN5OiBcIlwiLCBzaWduYXR1cmU6IFwiXCIgfTtcblxuICAgICRzY29wZS5kYXRlcGlja2VyX29wZW4gICAgPSBmYWxzZTtcblxuICAgICRzY29wZS4kd2F0Y2goJ3VmaWxlcycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJHNjb3BlLnVwbG9hZCgkc2NvcGUudWZpbGVzKTtcbiAgICB9KTtcblxuICAgIC8vIGZpbGVzXG4gICAgJHNjb3BlLmRvd25sb2FkRmlsZSA9IGZ1bmN0aW9uKGZpbGVJRCkge1xuXG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6ICcvdGFza2ZpbGVzLycgKyBmaWxlSUQgKyAnL3VybCcsXG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuXG4gICAgICAgICAgICBzdWNjZXNzIDogZnVuY3Rpb24ocmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgZG93bmxvYWRVUkwgPSBmdW5jdGlvbiBkb3dubG9hZFVSTChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhpZGRlbklGcmFtZUlEID0gJ2hpZGRlbkRvd25sb2FkZXInLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmcmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGhpZGRlbklGcmFtZUlEKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZnJhbWUgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZnJhbWUuaWQgPSBoaWRkZW5JRnJhbWVJRDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZnJhbWUuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGlmcmFtZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmcmFtZS5zcmMgPSByZXNwb25zZTtcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgZG93bmxvYWQgPSBuZXcgZG93bmxvYWRVUkwocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnJlbmFtZUZpbGUgPSBmdW5jdGlvbihmaWxlKSB7XG5cbiAgICAgICAgdmFyIGN1cnJfdGltZXN0YW1wID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgIHZhciBjdXJyX2RheSAgICAgICA9IG5ldyBEYXRlKCkuZ2V0RGF0ZSgpO1xuICAgICAgICB2YXIgcmFuZG9tX3N0ciAgICAgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoOCk7XG5cbiAgICAgICAgcmV0dXJuIGN1cnJfZGF5KyctJytyYW5kb21fc3RyKyctJytmaWxlLm5hbWU7XG4gICAgfTtcblxuICAgICRzY29wZS51cGxvYWQgPSBmdW5jdGlvbihmaWxlcylcbiAgICB7XG4gICAgICAgIC8vJGxvZy5sb2coJ2xsbCcsICRzY29wZS5zM3BvbGljeSwgJHNjb3BlLnMzc2lnbmF0dXJlKTtcbiAgICAgICAgaWYgKGZpbGVzICYmIGZpbGVzLmxlbmd0aClcbiAgICAgICAge1xuICAgICAgICAgICAgJCgnI3Rhc2tfJyskc2NvcGUuaXRhc2suaW5mby5pZCsnIC50YXNrZmlsZV9wcm9ncmVzcycpLnNob3coKTtcblxuICAgICAgICAgICAgJHNjb3BlLnVwbG9hZHNDb21wbGV0ZSA9IGZhbHNlO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaWxlcy5sZW5ndGg7IGkrKylcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUucHJvZ3Jlc3NQZXJjZW50YWdlID0gMDtcblxuICAgICAgICAgICAgICAgIHZhciBmaWxlICAgICAgICAgID0gZmlsZXNbaV07XG4gICAgICAgICAgICAgICAgdmFyIG5ld19maWxlX25hbWUgPSAkc2NvcGUucmVuYW1lRmlsZShmaWxlKTtcblxuICAgICAgICAgICAgICAgIC8vIHVzZSBtZVxuICAgICAgICAgICAgICAgIHZhciBkaXJfcHJlZml4ID0gJ2V2ZW50cy8nKyRzY29wZS5pdGFzay5pbmZvLmV2ZW50c19pZDtcbiAgICAgICAgICAgICAgICAkbG9nLmxvZygnZmlsZScsIGZpbGUpO1xuXG4gICAgICAgICAgICAgICAgJHVwbG9hZC51cGxvYWQoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiaHR0cHM6Ly9hbGRhLXByb21vdGVycy5zMy1ldS13ZXN0LTEuYW1hem9uYXdzLmNvbS9cIiwgIC8vUzMgdXBsb2FkIHVybCBpbmNsdWRpbmcgYnVja2V0IG5hbWVcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgICAgIGZpZWxkcyA6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleTogJ2ZpbGVzLycrZGlyX3ByZWZpeCsnLycrbmV3X2ZpbGVfbmFtZSwgICAgICAgICAgICAgLy8gdGhlIGtleSB0byBzdG9yZSB0aGUgZmlsZSBvbiBTMywgY291bGQgYmUgZmlsZSBuYW1lIG9yIGN1c3RvbWl6ZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIEFXU0FjY2Vzc0tleUlkOiBcIkFLSUFKNVlHS0RTM0NIM0JUMk1BXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBhY2w6ICdwdWJsaWMtcmVhZCcsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNldHMgdGhlIGFjY2VzcyB0byB0aGUgdXBsb2FkZWQgZmlsZSBpbiB0aGUgYnVja2V0OiBwcml2YXRlIG9yIHB1YmxpY1xuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc19hY3Rpb25fc3RhdHVzOiBcIjIwMVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9saWN5OiAkc2NvcGUuczMucG9saWN5LCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBiYXNlNjQtZW5jb2RlZCBqc29uIHBvbGljeSAoc2VlIGFydGljbGUgYmVsb3cpXG4gICAgICAgICAgICAgICAgICAgICAgICBzaWduYXR1cmU6ICRzY29wZS5zMy5zaWduYXR1cmUsICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJhc2U2NC1lbmNvZGVkIHNpZ25hdHVyZSBiYXNlZCBvbiBwb2xpY3kgc3RyaW5nIChzZWUgYXJ0aWNsZSBiZWxvdylcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IGZpbGUudHlwZSAhPT0gJycgPyBmaWxlLnR5cGUgOiBcImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbVwiLCAvLyBjb250ZW50IHR5cGUgb2YgdGhlIGZpbGUgKE5vdEVtcHR5KVxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogbmV3X2ZpbGVfbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIEZpbGVuYW1lOiAnZmlsZXMvJytkaXJfcHJlZml4KycvJytuZXdfZmlsZV9uYW1lLCAgICAgICAgLy8gdGhpcyBpcyBuZWVkZWQgZm9yIEZsYXNoIHBvbHlmaWxsIElFOC05XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGZpbGU6IGZpbGVcblxuICAgICAgICAgICAgICAgIH0pLnByb2dyZXNzKGZ1bmN0aW9uIChldnQpIHtcblxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucHJvZ3Jlc3NQZXJjZW50YWdlID0gcGFyc2VJbnQoMTAwLjAgKiBldnQubG9hZGVkIC8gZXZ0LnRvdGFsKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnI3Rhc2tfJyskc2NvcGUuaXRhc2suaW5mby5pZCsnIC5wcm9ncmVzcy1iYXInKS53aWR0aCgkc2NvcGUucHJvZ3Jlc3NQZXJjZW50YWdlKyclJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGVjdG9yID0gJyN0YXNrXycrJHNjb3BlLml0YXNrLmluZm8uaWQ7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwcm9nX3NlbGVjdG9yID0gJyN0YXNrXycrJHNjb3BlLml0YXNrLmluZm8uaWQrJyAucHJvZ3Jlc3MtYmFyJztcblxuICAgICAgICAgICAgICAgICAgICAkbG9nLmxvZygncHJvZ3Jlc3M6ICcgKyAkc2NvcGUucHJvZ3Jlc3NQZXJjZW50YWdlICsgJyUgJyArIGV2dC5jb25maWcuZmlsZS5uYW1lLCBzZWxlY3RvciwgcHJvZ19zZWxlY3RvciwgJChzZWxlY3RvcikubGVuZ3RoLCAkKHByb2dfc2VsZWN0b3IpLmxlbmd0aCk7XG5cbiAgICAgICAgICAgICAgICB9KS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlc29sdmUgcHJvbWlzZSBhbmQgZ2V0IGFsbCB0aGUgdGhpbmdzXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50c1NlcnZpY2UucG9zdFNlcnZlckRhdGEoJy9hcGkvdjEvbXktZXZlbnRzLycrJHNjb3BlLml0YXNrLmluZm8uZXZlbnRzX2lkKycvdGFza3MvJyskc2NvcGUuaXRhc2suaW5mby5pZCsnL3MzdXBsb2FkJywge3BhdGg6IG5ld19maWxlX25hbWUsIG9yaWdpbmFsX25hbWU6IGZpbGUubmFtZX0pLnRoZW4oZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2cubG9nKFwiRmlsZSB1cGxvYWRlZC4uLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5nZXRUYXNrKCRzY29wZS5pdGFzay5pbmZvLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5wcm9ncmVzc1BlcmNlbnRhZ2UgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnVwbG9hZHNDb21wbGV0ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjdGFza18nKyRzY29wZS5pdGFzay5pbmZvLmlkKycgLnByb2dyZXNzLWJhcicpLndpZHRoKDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3Rhc2tfJyskc2NvcGUuaXRhc2suaW5mby5pZCsnIC50YXNrZmlsZV9wcm9ncmVzcycpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgJGxvZy5sb2coJ2ZpbGUgJyArIGNvbmZpZy5maWxlLm5hbWUgKyAndXBsb2FkZWQuIFJlc3BvbnNlOiAnICsgZGF0YSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJHNjb3BlLmdldFByb2dyZXNzV2lkdGggPSBmdW5jdGlvbigpIHtcblxuICAgICAgICByZXR1cm4gXCJ7d2lkdGg6IChwcm9ncmVzc1BlcmNlbnRhZ2UgKiAxMDApJX1cIjtcbiAgICB9O1xuXG4gICAgJHNjb3BlLmRlbGV0ZUZpbGUgPSBmdW5jdGlvbihmaWxlLCB0YXNrX2lkKSB7XG5cbiAgICAgICAgZXZlbnRzU2VydmljZS5wb3N0U2VydmVyRGF0YSgnL3Rhc2tmaWxlcy8nK2ZpbGUuaWQrJy9kZWxldGUnKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICRzY29wZS5nZXRUYXNrKHRhc2tfaWQpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgLy8gdGFza3NcbiAgICAkc2NvcGUuc2V0SXRhc2sgPSBmdW5jdGlvbih0YXNrKSB7XG5cbiAgICAgICAgLy8kbG9nLmxvZyh0YXNrKTtcbiAgICAgICAgJHNjb3BlLml0YXNrICAgPSB0YXNrO1xuICAgICAgICAkc2NvcGUuY29tbWVudCA9ICRzY29wZS5pdGFzay5pbmZvLmNvbW1lbnQ7XG4gICAgICAgICRzY29wZS5pZmlsZXMgID0gJHNjb3BlLml0YXNrLmZpbGVzO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZ2V0VGFzayA9IGZ1bmN0aW9uKHRhc2tfaWQpIHtcblxuICAgICAgICAkKCcuYmFja2Ryb3AnKS5jc3MoJ2Rpc3BsYXknLCAnYmxvY2snKTtcbiAgICAgICAgZXZlbnRzU2VydmljZS5nZXRTZXJ2ZXJEYXRhKCcvYXBpL3YxL215LWV2ZW50cy90YXNrcy8nK3Rhc2tfaWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgJGxvZy5sb2coJ2dldFRhc2snLCByZXNwb25zZSwgdGFza19pZCk7XG5cbiAgICAgICAgICAgIC8vIGdldCB0aGUgaXRlbSBpbiB0aGUgYXJyYXlcbiAgICAgICAgICAgIHZhciBuZXdfc2VsZWN0ZWQgPSBfLmZpbHRlcigkcm9vdFNjb3BlLnByb21vdGVyX2V2ZW50c1skcm9vdFNjb3BlLmV2ZW50X25keF0udGFza3MsIGZ1bmN0aW9uKGl0ZW0pe1xuICAgICAgICAgICAgICAgIGlmIChpdGVtLmluZm8uaWQgPT09IHRhc2tfaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmKG5ld19zZWxlY3RlZC5sZW5ndGgpIHtcblxuICAgICAgICAgICAgICAgIC8vIGdldCB0aGUgaW5kZXhcbiAgICAgICAgICAgICAgICB2YXIgdGFza19uZHggPSBfLmluZGV4T2YoJHJvb3RTY29wZS5wcm9tb3Rlcl9ldmVudHNbJHJvb3RTY29wZS5ldmVudF9uZHhdLnRhc2tzLCBuZXdfc2VsZWN0ZWRbMF0pO1xuICAgICAgICAgICAgICAgIC8vIGluamVjdCB0aGUgdGFzayBmaWxlcyBpbiB0aGUgZ2xvYmFsIG9iamVjdFxuICAgICAgICAgICAgICAgICRyb290U2NvcGUucHJvbW90ZXJfZXZlbnRzWyRyb290U2NvcGUuZXZlbnRfbmR4XS50YXNrc1t0YXNrX25keF0uZmlsZXMgPSByZXNwb25zZVswXS5maWxlcztcbiAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnByb21vdGVyX2V2ZW50c1skcm9vdFNjb3BlLmV2ZW50X25keF0udGFza3NbdGFza19uZHhdLmluZm8gID0gcmVzcG9uc2VbMF0uaW5mbztcblxuICAgICAgICAgICAgICAgICRsb2cubG9nKCd0YXNrIG5keCBmb3VuZCBhdDogJyt0YXNrX25keCk7XG5cbiAgICAgICAgICAgICAgICAvLyBzYW1lIGZvciBjYXRzXG4gICAgICAgICAgICAgICAgdmFyIHRhc2tfY2F0ID0gbmV3X3NlbGVjdGVkWzBdLmluZm8uZ3JvdXBfaWQ7XG4gICAgICAgICAgICAgICAgdmFyIGNhdF90YXNrcztcblxuICAgICAgICAgICAgICAgIC8vIHNhbWUgZm9yIGNhdHNcbiAgICAgICAgICAgICAgICB2YXIgbmV3X2NhdF9zZWxlY3RlZCA9IF8uZmlsdGVyKCRyb290U2NvcGUucHJvbW90ZXJfZXZlbnRzWyRyb290U2NvcGUuZXZlbnRfbmR4XS5jYXRfdGFza3NbJ2dyb3VwXycrdGFza19jYXRdLCBmdW5jdGlvbihpdGVtKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uaW5mby5pZCA9PT0gdGFza19pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHZhciB0YXNrX2NhdF9uZHggPSBfLmluZGV4T2YoJHJvb3RTY29wZS5wcm9tb3Rlcl9ldmVudHNbJHJvb3RTY29wZS5ldmVudF9uZHhdLmNhdF90YXNrc1snZ3JvdXBfJyt0YXNrX2NhdF0sIG5ld19jYXRfc2VsZWN0ZWRbMF0pO1xuICAgICAgICAgICAgICAgICRsb2cubG9nKCd0YXNrIGNhdF9uZHggZm91bmQgYXQ6ICcrdGFza19jYXRfbmR4LCBuZXdfY2F0X3NlbGVjdGVkWzBdKTtcblxuICAgICAgICAgICAgICAgIGlmICh0YXNrX2NhdF9uZHggIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUucHJvbW90ZXJfZXZlbnRzWyRyb290U2NvcGUuZXZlbnRfbmR4XS5jYXRfdGFza3NbJ2dyb3VwXycrdGFza19jYXRdW3Rhc2tfY2F0X25keF0uZmlsZXMgPSByZXNwb25zZVswXS5maWxlcztcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5wcm9tb3Rlcl9ldmVudHNbJHJvb3RTY29wZS5ldmVudF9uZHhdLmNhdF90YXNrc1snZ3JvdXBfJyt0YXNrX2NhdF1bdGFza19jYXRfbmR4XS5pbmZvICA9IHJlc3BvbnNlWzBdLmluZm87XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgJGxvZy5sb2coJ0VSUk9SOiB0YXNrIG5keCBOT1QgRk9VTkQnKTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBmaW5kIHRhc2sgaW4gZ2xvYmFsIHN0b3JhZ2VcbiAgICAgICAgICAgICRzY29wZS5pdGFzayAgID0gcmVzcG9uc2VbMF07XG4gICAgICAgICAgICAkc2NvcGUuY29tbWVudCA9ICRzY29wZS5pdGFzay5pbmZvLmNvbW1lbnQ7XG4gICAgICAgICAgICAkc2NvcGUuaWZpbGVzICA9ICRzY29wZS5pdGFzay5maWxlcztcblxuICAgICAgICAgICAgJCgnLmJhY2tkcm9wJykuY3NzKCdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8vIGNvbW1lbnRzXG4gICAgJHNjb3BlLnNhdmVDb21tZW50ID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgZXZlbnRzU2VydmljZS5wb3N0U2VydmVyRGF0YSgnL2FwaS92MS9teS1ldmVudHMvJyskc2NvcGUuaXRhc2suaW5mby5ldmVudHNfaWQrJy90YXNrcy8nKyRzY29wZS5pdGFzay5pbmZvLmlkKycvY29tbWVudCcsIHtjb21tZW50X2NvbnRlbnQ6ICRzY29wZS5jb21tZW50fSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuXG4gICAgICAgICAgICAkbG9nLmxvZygnc2F2ZUNvbW1lbnRyZXNwb25zZScsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICRzY29wZS5nZXRUYXNrKCRzY29wZS5pdGFzay5pbmZvLmlkKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5zZXRBY3RpdmUgPSBmdW5jdGlvbigkZXZlbnQpIHtcblxuICAgICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGV2ZW50c1NlcnZpY2UucG9zdFNlcnZlckRhdGEoJy9hcGkvdjEvbXktZXZlbnRzLycrJHNjb3BlLml0YXNrLmluZm8uZXZlbnRzX2lkKycvdGFza3MvJyskc2NvcGUuaXRhc2suaW5mby5pZCsnL2FjdGl2ZScsIHthY3RpdmVfc3RhdHVzOiAkc2NvcGUuYWN0aXZlX3N0YXR1c30pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgJGxvZy5sb2coJ3NldEFjdGl2ZSByZXNwb25zZScsIHJlc3BvbnNlKTtcblxuICAgICAgICAgICAgJHNjb3BlLmdldFRhc2soJHNjb3BlLml0YXNrLmluZm8uaWQpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgJHNjb3BlLnNldFN0YXR1cyA9IGZ1bmN0aW9uKCRldmVudCkge1xuXG4gICAgICAgICRldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgZXZlbnRzU2VydmljZS5wb3N0U2VydmVyRGF0YSgnL2FwaS92MS9teS1ldmVudHMvJyskc2NvcGUuaXRhc2suaW5mby5ldmVudHNfaWQrJy90YXNrcy8nKyRzY29wZS5pdGFzay5pbmZvLmlkKycvc3RhdHVzJywge3Rhc2tfc3RhdHVzOiAkc2NvcGUuY29tcGxldGlvbl9zdGF0dXN9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cbiAgICAgICAgICAgICRsb2cubG9nKCdzZXRTdGF0dXMgcmVzcG9uc2UnLCByZXNwb25zZSk7XG5cbiAgICAgICAgICAgIC8vJHNjb3BlLmdldFRhc2soJHNjb3BlLml0YXNrLmluZm8uaWQpO1xuICAgICAgICAgICAgJHJvb3RTY29wZS5pbml0RGF0YSgpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgLy8gaGlkZSBzaG93IHRhc2sgZGV0YWlsc1xuICAgICRzY29wZS50b2dnbGVEZXRhaWxzID0gZnVuY3Rpb24odGFzaykge1xuXG4gICAgICAgIGlmICgkc2NvcGUuZGF0ZXBpY2tlcl9vcGVuKXtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciAkc2VsZWN0ZWRfcm93ICAgPSAkKCcjdGFza18nK3Rhc2suaW5mby5pZCk7XG4gICAgICAgIHZhciAkZW50cnlfZGV0YWlscyAgPSAkc2VsZWN0ZWRfcm93LmNsb3Nlc3QoJy5lbnRyeV9jb250YWluZXInKS5maW5kKCcuZW50cnlfZGV0YWlscycpO1xuICAgICAgICB2YXIgZGV0YWlsc19kaXNwbGF5ID0gJGVudHJ5X2RldGFpbHMuY3NzKCdkaXNwbGF5Jyk7XG4gICAgICAgIGlmKGRldGFpbHNfZGlzcGxheSA9PT0gJ25vbmUnKVxuICAgICAgICB7XG4gICAgICAgICAgICAkKCdib2R5JykuZmluZCgnLmVudHJ5X2RldGFpbHMnKS5zbGlkZVVwKCk7XG4gICAgICAgICAgICAkKCdib2R5JykuZmluZCgnLmVudHJ5JykuY3NzKCdjb2xvcicsICcjNTU1Jyk7XG4gICAgICAgICAgICAkc2VsZWN0ZWRfcm93LmNzcygnY29sb3InLCAnIzAwMCcpO1xuICAgICAgICAgICAgJGVudHJ5X2RldGFpbHMuc2xpZGVEb3duKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZVxuICAgICAgICB7XG4gICAgICAgICAgICAkZW50cnlfZGV0YWlscy5zbGlkZVVwKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJHNjb3BlLmdldFRhc2tPcGFjaXR5ID0gZnVuY3Rpb24oc3RhdHVzKSB7XG5cbiAgICAgICAgcmV0dXJuIChzdGF0dXMgPT09ICdjb21wbGV0ZScgPyB7b3BhY2l0eTogMC40fSA6IHtvcGFjaXR5OiAxfSk7XG4gICAgfTtcblxuICAgICRzY29wZS5jYXROYW1lID0gZnVuY3Rpb24oY2F0X2lkKSB7XG5cbiAgICAgICAgdmFyIHJldCA9IF8uZmluZFdoZXJlKCRyb290U2NvcGUuY2F0cywge2lkOiBjYXRfaWR9KTtcbiAgICAgICAgcmV0dXJuIHJldCA/IHJldC5uYW1lIDogJyc7XG4gICAgfTtcblxuICAgICRzY29wZS5nZXRCYWRnZUNTUyA9IGZ1bmN0aW9uKGxvZ2dlZCwgdXBkYXRlZCkge1xuXG4gICAgICAgIC8vIHJldHVybiBjc3MgY2xhc3MgZm9yIGNvbG9yaW5nXG4gICAgICAgIC8vJGxvZy5sb2coJ2dldEJhZGdlQ1NTJywgbG9nZ2VkLCB1cGRhdGVkKTtcbiAgICAgICAgaWYobG9nZ2VkID09PSB1cGRhdGVkKSB7XG4gICAgICAgICAgICByZXR1cm4gXCJzYW1lX3VzZXJcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBcImRpZmZfdXNlclwiO1xuICAgIH07XG5cbiAgICAkc2NvcGUuZ2V0RGVhZGxpbmVDbGFzcyA9IGZ1bmN0aW9uKGR1ZV9kYXRlKSB7XG5cbiAgICAgICAgdmFyIGRheXNfbGVmdCA9ICRzY29wZS5kYXlzTGVmdChkdWVfZGF0ZSk7XG5cbiAgICAgICAgdmFyIHVyZ2VuY3lfY2xhc3MgPSBcInVyZ2VuY3lfZ3JlZW5cIjtcbiAgICAgICAgaWYoZGF5c19sZWZ0IDwgMTUpXG4gICAgICAgIHtcbiAgICAgICAgICAgIHVyZ2VuY3lfY2xhc3MgPSBcInVyZ2VuY3lfcmVkXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZihkYXlzX2xlZnQgPCAyMClcbiAgICAgICAge1xuICAgICAgICAgICAgdXJnZW5jeV9jbGFzcyA9IFwidXJnZW5jeV95ZWxsb3dcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB1cmdlbmN5X2NsYXNzO1xuICAgIH07XG5cbiAgICAvLyBGSVhNRVxuICAgICRzY29wZS5zZWxlY3REYXRlID0gZnVuY3Rpb24oZGF0ZV90eHQpIHtcblxuICAgICAgICAkbG9nLmxvZygnc2VsZWN0ZWQgZGF0ZScsICRzY29wZS5kdCk7XG4gICAgICAgIHZhciBwYXJzZWRfZGF0ZSwgcGFyc2VkX2RhdGVfc3RyO1xuXG4gICAgICAgIGlmKGRhdGVfdHh0KSB7XG4gICAgICAgICAgICBwYXJzZWRfZGF0ZV9zdHIgPSBkYXRlX3R4dDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHBhcnNlZF9kYXRlID0gbmV3IERhdGUoJHNjb3BlLmR0KTtcbiAgICAgICAgICAgIHBhcnNlZF9kYXRlX3N0ciA9IHBhcnNlZF9kYXRlLmdldEZ1bGxZZWFyKCkrJy0nKyhwYXJzZWRfZGF0ZS5nZXRNb250aCgpKzEpKyctJytwYXJzZWRfZGF0ZS5nZXREYXRlKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyByZXNvbHZlIHByb21pc2UgYW5kIGdldCBhbGwgdGhlIHRoaW5nc1xuICAgICAgICBldmVudHNTZXJ2aWNlLnBvc3RTZXJ2ZXJEYXRhKCcvYXBpL3YxL215LWV2ZW50cy8nKyRzY29wZS5pdGFzay5pbmZvLmV2ZW50c19pZCsnL3Rhc2tzLycrJHNjb3BlLml0YXNrLmluZm8uaWQrJy9kdWVfZGF0ZScsIHtzZWxlY3RlZF9kYXRlOiBwYXJzZWRfZGF0ZV9zdHJ9KS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGxvZy5sb2coXCJUYXNrIGRlYWRsaW5lIHNldC4uLlwiLCAkc2NvcGUuZHQpO1xuICAgICAgICAgICAgJHJvb3RTY29wZS5pbml0RGF0YSgpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgLy8gRklYTUVcbiAgICAkc2NvcGUuY29udmVydERhdGUgPSBmdW5jdGlvbihkYXRlX3ZhbCkge1xuXG4gICAgICAgIHZhciBleHBsb2RlZF9kYXRlID0gZGF0ZV92YWwuc3BsaXQoJy0nKTtcbiAgICAgICAgdmFyIHJldCA9IGV4cGxvZGVkX2RhdGVbMl0rJy0nK2V4cGxvZGVkX2RhdGVbMV0rJy0nK2V4cGxvZGVkX2RhdGVbMF07XG5cbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICB9O1xuXG5cbn1dKTtcblxuIiwid2luZG93LmFuZ3VsYXIubW9kdWxlKCdwcm9tb3RlcnNBcHAnKS5jb250cm9sbGVyKCdUaWNrZXRDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJHJvb3RTY29wZScsICckc3RhdGUnLCAnJG1vZGFsJywgJyRsb2cnLCAnJHVwbG9hZCcsICdldmVudHNTZXJ2aWNlJywgZnVuY3Rpb24gKCRzY29wZSwgJHJvb3RTY29wZSwgJHN0YXRlLCAkbW9kYWwsICRsb2csICR1cGxvYWQsIGV2ZW50c1NlcnZpY2UpIHtcblxuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBfICAgICAgID0gd2luZG93Ll87XG4gICAgdmFyIGFuZ3VsYXIgPSB3aW5kb3cuYW5ndWxhcjtcblxuICAgICRzY29wZS5zZWxlY3RlZFdlZWsgICAgPSAwO1xuICAgICRzY29wZS5zZWxlY3RlZFllYXIgICAgPSBuZXcgRGF0ZSgpLmdldEZ1bGxZZWFyKCk7XG4gICAgJHNjb3BlLmVkaXRvcl9leHBhbmRlZCA9IFtdO1xuICAgICRzY29wZS50aWNrZXRfc2FsZXMgICAgPSBbXTtcblxuICAgICRzY29wZS5ncm91cGVkX3RpY2tldHMgPSBbXTtcbiAgICAkc2NvcGUubGFzdF9uX3dlZWtzICAgID0gbnVsbDtcbiAgICAkc2NvcGUubnVtX2l0ZW1zICAgICAgID0gMDtcbiAgICAkc2NvcGUuc2xpY2Vfc3RhcnQgICAgID0gdW5kZWZpbmVkO1xuICAgICRzY29wZS5zbGljZV9lbmQgICAgICAgPSB1bmRlZmluZWQ7XG5cbiAgICAkc2NvcGUuZ3JhbmRfdG90YWxfY250ID0gMDtcbiAgICAkc2NvcGUuZ3JhbmRfdG90YWxfYW10ID0gMDtcblxuICAgICRzY29wZS5vbmx5TnVtYmVycyA9IC9eXFxkKyQvO1xuXG4gICAgJHNjb3BlLmNoYXJ0ID0gbnVsbDtcbiAgICAkc2NvcGUuaGlnaGNoYXJ0c19jb25maWcgPSB7XG4gICAgICAgIGNoYXJ0OiB7XG4gICAgICAgICAgICByZW5kZXJUbzogJ2hjY29udGFpbmVyJyxcbiAgICAgICAgfSxcbiAgICAgICAgdG9vbHRpcDoge1xuICAgICAgICAgICAgY3Jvc3NoYWlyczogdHJ1ZSxcbiAgICAgICAgICAgIHNoYXJlZDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBwbG90T3B0aW9uczoge1xuICAgICAgICAgICAgbGluZToge1xuICAgICAgICAgICAgICAgIG1hcmtlcjoge1xuICAgICAgICAgICAgICAgICAgICBlbmFibGVkOiBmYWxzZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzcGxpbmU6IHtcbiAgICAgICAgICAgICAgICBtYXJrZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlZDogZmFsc2VcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHhBeGlzOiB7XG4gICAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgICAgIHRleHQ6ICd3ZWVrJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRpY2tJbnRlcnZhbDogMVxuICAgICAgICB9LFxuICAgICAgICB5QXhpczogW3sgLy8gUHJpbWFyeSB5QXhpc1xuICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgICB0ZXh0OiAnTnVtYmVyIFRpY2tldHMgU29sZCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0eXBlOiAnbGluZWFyJyxcbiAgICAgICAgICAgIG1pbjogMFxuICAgICAgICB9LCB7IC8vIFNlY29uZGFyeSB5QXhpc1xuICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgICB0ZXh0OiAnVGlja2V0cyBTb2xkIFJldmVudWUnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdHlwZTogJ2xpbmVhcicsXG4gICAgICAgICAgICBvcHBvc2l0ZTogdHJ1ZVxuICAgICAgICB9XSxcbiAgICAgICAgc2VyaWVzOiBbXSxcbiAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgIHRleHQ6ICdUaWNrZXQgU2FsZXMnXG4gICAgICAgIH0sXG4gICAgICAgIGxvYWRpbmc6IGZhbHNlXG4gICAgfTtcblxuICAgIC8vIGdlbmVyaWNcbiAgICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIGlmKCRzY29wZS5wcm9tb3Rlcl9ldmVudHMgJiYgJHNjb3BlLnByb21vdGVyX2V2ZW50cy5sZW5ndGgpIHtcblxuICAgICAgICAgICAgLy8gJHJvb3RTY29wZS5zZXRFdmVudCgkc3RhdGUucGFyYW1zLmV2ZW50SWQpO1xuICAgICAgICAgICAgJGxvZy5sb2coJ1J1bm5pbmcgdGlja2V0cyBjb250cm9sbGVyIGluaXQnKTtcblxuICAgICAgICAgICAgLy8gZWRpdG9yIGV4cGFuZGVkXG4gICAgICAgICAgICB2YXIgdGlja2V0c193ZWVrbHlfZW50cmllcyA9ICRzY29wZS5wcm9tb3Rlcl9ldmVudHNbJHJvb3RTY29wZS5ldmVudF9uZHhdLnRpY2tldHM7XG4gICAgICAgICAgICBmb3IodmFyIHdlZWtseV9uZHggPSAwOyB3ZWVrbHlfbmR4IDwgdGlja2V0c193ZWVrbHlfZW50cmllcy5sZW5ndGg7IHdlZWtseV9uZHgrKykge1xuICAgICAgICAgICAgICAgICRzY29wZS5lZGl0b3JfZXhwYW5kZWRbd2Vla2x5X25keF0gPSBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gc2xpY2UgdGlja2V0cyBpbnRvIGdyb3VwcyBvZiA2IHdlZWtzIHBhZ2VzXG4gICAgICAgICAgICBpZigkKCcjcHJvbW90ZXJUaWNrZXRzJykubGVuZ3RoID4gMCkge1xuXG4gICAgICAgICAgICAgICAgJHNjb3BlLm51bV9pdGVtcyA9ICRzY29wZS5wcm9tb3Rlcl9ldmVudHNbJHJvb3RTY29wZS5ldmVudF9uZHhdLnRpY2tldHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmKCRzY29wZS5zbGljZV9zdGFydCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zbGljZV9zdGFydCA9IE1hdGgubWF4KCRzY29wZS5udW1faXRlbXMgLSA2LCAxKTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICRsb2cubG9nKCdTUycsICRzY29wZS5zbGljZV9zdGFydCk7XG4gICAgICAgICAgICAgICAgaWYoJHNjb3BlLnNsaWNlX2VuZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zbGljZV9lbmQgPSAkc2NvcGUucHJvbW90ZXJfZXZlbnRzWyRyb290U2NvcGUuZXZlbnRfbmR4XS50aWNrZXRzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgJGxvZy5sb2coJ1NFVScsICRzY29wZS5zbGljZV9lbmQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5zbGljZV9lbmQgPSAkc2NvcGUuc2xpY2Vfc3RhcnQgKyBNYXRoLm1pbig2LCAkc2NvcGUubnVtX2l0ZW1zKTtcbiAgICAgICAgICAgICAgICAgICAgJGxvZy5sb2coJ1NFJywgJHNjb3BlLnNsaWNlX2VuZCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgJHNjb3BlLm5vbmF2ID0gKCRzY29wZS5udW1faXRlbXMgPCA2KTtcbiAgICAgICAgICAgICAgICAkbG9nLmxvZygnbnVtX2l0ZW1zJywgJHNjb3BlLm51bV9pdGVtcyk7XG5cbiAgICAgICAgICAgICAgICAkc2NvcGUubGFzdF9uX3dlZWtzID0gJHNjb3BlLnByb21vdGVyX2V2ZW50c1skcm9vdFNjb3BlLmV2ZW50X25keF0udGlja2V0cy5zbGljZSgkc2NvcGUuc2xpY2Vfc3RhcnQsICRzY29wZS5zbGljZV9lbmQpO1xuICAgICAgICAgICAgICAgICRzY29wZS5jdXJyX3BhZ2UgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gYWxkYSB2aWV3XG4gICAgICAgIGlmKCQoJyNhbGRhVGlja2V0cycpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICRzY29wZS5pbml0SGlnaENoYXJ0cygpO1xuICAgICAgICAgICAgJHNjb3BlLmNhbGNHcmFuZFRvdGFsKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgJHNjb3BlLmluaXRIaWdoQ2hhcnRzID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgLy8gaGlnaGNoYXJ0cyBwb2ludHNcbiAgICAgICAgJHNjb3BlLmhpZ2hjaGFydHNfY29uZmlnLnNlcmllcyA9IFtdO1xuXG4gICAgICAgIHZhciB0aWNrZXRzX3llYXJseV9zdW1tYXJ5ID0gJHNjb3BlLnByb21vdGVyX2V2ZW50c1skcm9vdFNjb3BlLmV2ZW50X25keF0udGlja2V0c195ZWFybHk7XG5cbiAgICAgICAgdmFyIHllYXJseV9uZHggPSAwO1xuICAgICAgICBmb3IoeWVhcmx5X25keCA9IDA7IHllYXJseV9uZHggPCB0aWNrZXRzX3llYXJseV9zdW1tYXJ5Lmxlbmd0aDsgeWVhcmx5X25keCsrKSB7XG5cbiAgICAgICAgICAgIC8vJGxvZy5sb2coJ2hpZ2hjaGFydHMgeWVhcmx5IGVudHJ5JyB0aWNrZXRzX3llYXJseV9zdW1tYXJ5W3llYXJseV9uZHhdKTtcbiAgICAgICAgICAgICRzY29wZS5oaWdoY2hhcnRzX2NvbmZpZy5zZXJpZXMucHVzaCh7IG5hbWU6ICcjICcrdGlja2V0c195ZWFybHlfc3VtbWFyeVt5ZWFybHlfbmR4XS5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlBeGlzOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdsaW5lJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB6SW5kZXg6IDIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogdGlja2V0c195ZWFybHlfc3VtbWFyeVt5ZWFybHlfbmR4XS5wb2ludHN9KTtcbiAgICAgICAgfVxuXG4gICAgICAgICRzY29wZS5oaWdoY2hhcnRzX2NvbmZpZy5zZXJpZXMucHVzaCh7IG5hbWU6ICdSZXZlbnVlICcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlBeGlzOiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnY29sdW1uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgekluZGV4OiAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiAkc2NvcGUucHJvbW90ZXJfZXZlbnRzWyRyb290U2NvcGUuZXZlbnRfbmR4XS5nbG9iYWxfc2FsZXMucG9pbnRzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXNoU3R5bGU6ICdkYXNoJ30pO1xuXG4gICAgICAgIC8vICRzY29wZS5oaWdoY2hhcnRzX2NvbmZpZy5zZXJpZXMucHVzaCh7IG5hbWU6ICdDdW11bGF0aXZlICQgJyxcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgeUF4aXM6IDEsXG4gICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdsaW5lJyxcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogJHNjb3BlLnByb21vdGVyX2V2ZW50c1skcm9vdFNjb3BlLmV2ZW50X25keF0uZ2xvYmFsX3NhbGVzLmN1bV9wb2ludHMsXG4gICAgICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgIGRhc2hTdHlsZTogJ2Rhc2gnfSk7XG5cbiAgICAgICAgaWYoJHNjb3BlLmNoYXJ0KSB7XG4gICAgICAgICAgICAkc2NvcGUuY2hhcnQuZGVzdHJveSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgJHNjb3BlLmNoYXJ0ID0gbmV3IHdpbmRvdy5IaWdoY2hhcnRzLkNoYXJ0KCRzY29wZS5oaWdoY2hhcnRzX2NvbmZpZyk7XG5cbiAgICAgICAgJGxvZy5sb2coJ2hpZ2hjaGFydHMgc2VyaWVzJywgJHNjb3BlLmhpZ2hjaGFydHNfY29uZmlnLnNlcmllcyk7XG4gICAgfTtcblxuICAgICRzY29wZS5jYWxjR3JhbmRUb3RhbCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICRzY29wZS5ncmFuZF90b3RhbF9jbnQgPSAwO1xuICAgICAgICAkc2NvcGUuZ3JhbmRfdG90YWxfYW10ID0gMDtcbiAgICAgICAgdmFyIHRpY2tldHNfeWVhcmx5X3N1bW1hcnkgPSAkc2NvcGUucHJvbW90ZXJfZXZlbnRzWyRyb290U2NvcGUuZXZlbnRfbmR4XS50aWNrZXRzX3llYXJseTtcbiAgICAgICAgZm9yKHZhciB5ZWFybHlfbmR4ID0gMDsgeWVhcmx5X25keCA8IHRpY2tldHNfeWVhcmx5X3N1bW1hcnkubGVuZ3RoOyB5ZWFybHlfbmR4KyspIHtcblxuICAgICAgICAgICAgJHNjb3BlLmdyYW5kX3RvdGFsX2NudCArPSB0aWNrZXRzX3llYXJseV9zdW1tYXJ5W3llYXJseV9uZHhdLm51bV9zb2xkO1xuICAgICAgICAgICAgJHNjb3BlLmdyYW5kX3RvdGFsX2FtdCArPSB0aWNrZXRzX3llYXJseV9zdW1tYXJ5W3llYXJseV9uZHhdLmFtdDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkc2NvcGUuZ2V0Q3VycmVuY3kgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAvLyRsb2cubG9nKCdwcm9tb3Rlcl9ldmVudHMnLCAkc2NvcGUucHJvbW90ZXJfZXZlbnRzLCAnZXZlbnQgbmR4JywgJHJvb3RTY29wZS5ldmVudF9uZHgpO1xuICAgICAgICBpZigkc2NvcGUucHJvbW90ZXJfZXZlbnRzICYmICRyb290U2NvcGUuZXZlbnRfbmR4ICE9PSB1bmRlZmluZWQpIHtcblxuICAgICAgICAgICAgdmFyIGN1cnJlbmN5X2lkICAgID0gJHNjb3BlLnByb21vdGVyX2V2ZW50c1skcm9vdFNjb3BlLmV2ZW50X25keF0uZXZlbnQuY3VycmVuY3lfaWQ7XG4gICAgICAgICAgICB2YXIgY3VycmVuY2llcyAgICAgPSAkc2NvcGUucHJvbW90ZXJfZXZlbnRzWyRyb290U2NvcGUuZXZlbnRfbmR4XS5jdXJyZW5jaWVzO1xuICAgICAgICAgICAgdmFyIGN1cnJlbmN5X2VudHJ5ID0gXy5maW5kV2hlcmUoY3VycmVuY2llcywge2lkOiBjdXJyZW5jeV9pZH0pO1xuXG4gICAgICAgICAgICBpZihjdXJyZW5jeV9lbnRyeSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW5jeV9lbnRyeS5zeW1ib2w7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gXCI/XCI7XG4gICAgfTtcblxuICAgIC8vIHByb21vdGVycyBuYXZcbiAgICAkc2NvcGUucHJvbW90ZXJzTmV4dFdlZWsgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICBpZigkc2NvcGUubm9uYXYpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmKCRzY29wZS5zbGljZV9lbmQgPCAkc2NvcGUubnVtX2l0ZW1zKSB7XG5cbiAgICAgICAgICAgICRzY29wZS5zbGljZV9zdGFydCAgKz0gMTtcbiAgICAgICAgICAgICRzY29wZS5zbGljZV9lbmQgICAgKz0gMTtcbiAgICAgICAgICAgICRzY29wZS5sYXN0X25fd2Vla3MgPSAkc2NvcGUucHJvbW90ZXJfZXZlbnRzWyRyb290U2NvcGUuZXZlbnRfbmR4XS50aWNrZXRzLnNsaWNlKCRzY29wZS5zbGljZV9zdGFydCwgJHNjb3BlLnNsaWNlX2VuZCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gcHJvbW90ZXJzIG5hdlxuICAgICRzY29wZS5wcm9tb3RlcnNQcmV2V2VlayA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIGlmKCRzY29wZS5ub25hdikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoJHNjb3BlLnNsaWNlX3N0YXJ0ID4gMCkge1xuXG4gICAgICAgICAgICAkc2NvcGUuc2xpY2Vfc3RhcnQgIC09IDE7XG4gICAgICAgICAgICAkc2NvcGUuc2xpY2VfZW5kICAgIC09IDE7XG4gICAgICAgICAgICAkc2NvcGUubGFzdF9uX3dlZWtzID0gJHNjb3BlLnByb21vdGVyX2V2ZW50c1skcm9vdFNjb3BlLmV2ZW50X25keF0udGlja2V0cy5zbGljZSgkc2NvcGUuc2xpY2Vfc3RhcnQsICRzY29wZS5zbGljZV9lbmQpO1xuICAgICAgICB9XG4gICAgfTtcblxuICAgIC8vIHByb21vdGVyc1xuICAgICRzY29wZS5lY2hvTnVtU29sZCA9IGZ1bmN0aW9uKHR0LCB3ZWVrKSB7XG5cbiAgICAgICAgJGxvZy5sb2coJ2VjaG9OdW1Tb2xkJywgdHQsIHdlZWspO1xuXG4gICAgICAgIC8vIGdldCB0aGUgd2Vla2x5IHNhbGVzIGVudHJ5IGZvciB0aGUgZ2l2ZW4gdGlja2V0IHR5cGVcbiAgICAgICAgZm9yKHZhciBuZHggPSAwOyBuZHggPCB3ZWVrLnRpY2tldF9kZXRhaWxzLmxlbmd0aDsgbmR4KyspIHtcbiAgICAgICAgICAgIGlmKHdlZWsudGlja2V0X2RldGFpbHNbbmR4XS50aWNrZXRfdHlwZS5pZCA9PT0gcGFyc2VJbnQodHQuaWQsIDEwKSB8fCB3ZWVrLnRpY2tldF9kZXRhaWxzW25keF0udGlja2V0X3R5cGUuaWQgPT09IHR0LmlkKSB7XG5cbiAgICAgICAgICAgICAgICAkbG9nLmxvZygnZWNob051bVNvbGQgZm91bmQgZGV0YWlscyBmb3IgdGlja2V0dHlwZSAnK3R0LmlkLCB3ZWVrLnRpY2tldF9kZXRhaWxzW25keF0udGlja2V0c19zb2xkKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gd2Vlay50aWNrZXRfZGV0YWlsc1tuZHhdLnRpY2tldHNfc29sZCA/IHdlZWsudGlja2V0X2RldGFpbHNbbmR4XS50aWNrZXRzX3NvbGQubnVtX3NvbGQgOiAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gZXJyb3IgY291bGQgbm90IG1hdGNoIHRpY2tldCB0eXBlXG4gICAgICAgICRsb2cubG9nKCdlY2hvTnVtU29sZCBjb3VsZCBub3QgZmluZCBkZXRhaWxzIGZvciB0aWNrZXR0eXBlICcsIHR0LCB3ZWVrKTtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfTtcblxuICAgIC8vIHByb21vdGVyc1xuICAgICRzY29wZS5jb25kaXRpb25hbElucHV0ID0gZnVuY3Rpb24odHQsIHdlZWspIHtcblxuICAgICAgICAvLyBnZXQgdGhlIHdlZWtseSBzYWxlcyBlbnRyeSBmb3IgdGhlIGdpdmVuIHRpY2tldCB0eXBlXG4gICAgICAgIGZvcih2YXIgbmR4ID0gMDsgbmR4IDwgd2Vlay50aWNrZXRfZGV0YWlscy5sZW5ndGg7IG5keCsrKSB7XG5cbiAgICAgICAgICAgIGlmKHdlZWsudGlja2V0X2RldGFpbHNbbmR4XS50aWNrZXRfdHlwZS5pZCA9PT0gdHQuaWQpIHtcblxuICAgICAgICAgICAgICAgIHZhciB2aXNpYmxlID0gd2Vlay50aWNrZXRfZGV0YWlsc1tuZHhdLmlucHV0X3Zpc2libGU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZpc2libGU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBlcnJvciBjb3VsZCBub3QgbWF0Y2ggdGlja2V0IHR5cGVcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbiAgICAvLyBhbGRhXG4gICAgJHNjb3BlLnN1Ym1pdFdlZWtseVRpY2tldHMgPSBmdW5jdGlvbihtb2RlKSB7XG5cbiAgICAgICAgdmFyIGVsICAgICAgICA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidGlja2V0c1Jvb3RcIik7XG4gICAgICAgIHZhciB0b2tlbl9zdHIgPSBhbmd1bGFyLmVsZW1lbnQoZWwpLmRhdGEoJ3Rva2VuJyk7XG4gICAgICAgIHZhciBwb3N0X3VybCAgPSAnL2FwaS92MS9teS1ldmVudHMvJyskc2NvcGUuZXZlbnRfaWQrXCIvZXZlbnQtdGlja2V0cy1zb2xkXCI7XG5cbiAgICAgICAgdmFyIGZvcm1faW5wdXRzID0gbW9kZSA9PT0gJ3Byb21vdGVyJyA/ICQoXCIjcHJvbW90ZXJfc2FsZXNfZm9ybSBpbnB1dFwiKSA6ICQoXCIjd2Vla2x5X3NhbGVzX1wiKyRzY29wZS5zZWxlY3RlZFdlZWsrXCJfXCIrJHNjb3BlLnNlbGVjdGVkWWVhcitcIiBpbnB1dFtuYW1lPW51bV9zb2xkXVwiKTtcblxuICAgICAgICB2YXIgdGlja2V0X3NhbGVzX2lucHV0ID0gW107XG4gICAgICAgIGZvcm1faW5wdXRzLmVhY2goZnVuY3Rpb24obmR4LCB0dHlwZV9lbCkge1xuICAgICAgICAgICAgdmFyIGN1cnJfZWwgPSBhbmd1bGFyLmVsZW1lbnQodHR5cGVfZWwpO1xuICAgICAgICAgICAgdGlja2V0X3NhbGVzX2lucHV0LnB1c2goe3R0eXBlX2lkOiBjdXJyX2VsLmRhdGEoJ3R0eXBlJyksIHdlZWs6IGN1cnJfZWwuZGF0YSgnd2VlaycpLCB5ZWFyOiBjdXJyX2VsLmRhdGEoJ3llYXInKSwgc29sZDogY3Vycl9lbC52YWwoKX0pO1xuICAgICAgICB9KTtcblxuICAgICAgICB2YXIgcG9zdF9kYXRhID0gYW5ndWxhci5leHRlbmQoe30sIHtfdG9rZW46IHRva2VuX3N0ciwgd2VlazogJHNjb3BlLnNlbGVjdGVkV2VlaywgeWVhcjogJHNjb3BlLnNlbGVjdGVkWWVhciwgc2FsZXNfZGF0YTogdGlja2V0X3NhbGVzX2lucHV0fSk7XG4gICAgICAgICRsb2cubG9nKCdzdWJtaXRXZWVrbHlUaWNrZXRzJywgcG9zdF9kYXRhLCBwb3N0X3VybCk7XG4gICAgICAgIGV2ZW50c1NlcnZpY2UucG9zdFNlcnZlckRhdGEocG9zdF91cmwsIHBvc3RfZGF0YSkudGhlbihmdW5jdGlvbihkYXRhKSB7XG5cbiAgICAgICAgICAgICRsb2cubG9nKCdzdWJtaXRXZWVrbHlUaWNrZXRzIGdvdCAnLCBkYXRhKTtcbiAgICAgICAgICAgIHZhciBjYiA9ICRzY29wZS5pbml0O1xuICAgICAgICAgICAgJHJvb3RTY29wZS5pbml0RGF0YShjYik7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAvLyBhbGRhXG4gICAgJHNjb3BlLndlZWtseUFjdGlvbiA9IGZ1bmN0aW9uKHNhbGVzX3dlZWssIHNhbGVzX3llYXIpIHtcblxuICAgICAgICAkbG9nLmxvZygnd2Vla2x5QWN0aW9uJywgc2FsZXNfd2Vlaywgc2FsZXNfeWVhcik7XG4gICAgICAgIGlmKCRzY29wZS5lZGl0b3JfZXhwYW5kZWRbc2FsZXNfd2Vla10pIHtcblxuICAgICAgICAgICAgJGxvZy5sb2coJ3N1Ym1pdHRpbmcgc2FsZXMnKTtcbiAgICAgICAgICAgIC8vIHN1Ym1pdFxuICAgICAgICAgICAgJHNjb3BlLnN1Ym1pdFdlZWtseVRpY2tldHMoJ2FsZGEnKTtcbiAgICAgICAgICAgICRzY29wZS5lZGl0b3JfZXhwYW5kZWRbc2FsZXNfd2Vla10gPSBmYWxzZTtcblxuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAkbG9nLmxvZygnZXhwYW5kaW5nIGVkaXRvcicpO1xuICAgICAgICAgICAgLy8gc2V0IHNlbGVjdGVkXG4gICAgICAgICAgICAkc2NvcGUuc2VsZWN0ZWRXZWVrID0gc2FsZXNfd2VlaztcbiAgICAgICAgICAgICRzY29wZS5zZWxlY3RlZFllYXIgPSBzYWxlc195ZWFyO1xuXG4gICAgICAgICAgICAvLyBpcyB0aGlzIHdoYXQgd2Ugd2FudCA/Pz9cbiAgICAgICAgICAgIGZvcih2YXIgd2Vla2x5X25keCA9IDA7IHdlZWtseV9uZHggPCAkc2NvcGUuZWRpdG9yX2V4cGFuZGVkLmxlbmd0aDsgd2Vla2x5X25keCsrKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmVkaXRvcl9leHBhbmRlZFt3ZWVrbHlfbmR4XSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkc2NvcGUuZWRpdG9yX2V4cGFuZGVkW3NhbGVzX3dlZWtdID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcblxuICAgICAgICBpZigkKCcjdGlja2V0c1Jvb3QnKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB2YXIgY2IgPSAkc2NvcGUuaW5pdDtcbiAgICAgICAgICAgICRyb290U2NvcGUuaW5pdERhdGEoY2IpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbn1dKTtcblxuIiwid2luZG93LmFuZ3VsYXIubW9kdWxlKCdwcm9tb3RlcnNBcHAnKS5kaXJlY3RpdmUoXCJlZGF0ZXBpY2tlclwiLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAndXNlIHN0cmljdCc7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6IFwiQVwiLFxuICAgICAgICByZXF1aXJlOiBcIm5nTW9kZWxcIixcbiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtLCBhdHRycywgbmdNb2RlbEN0cmwpIHtcblxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnYXR0cnMnLCBhdHRycy52YWx1ZSk7XG4gICAgICAgICAgICB2YXIgdXBkYXRlTW9kZWwgPSBmdW5jdGlvbiAoZGF0ZVRleHQpIHtcbiAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBuZ01vZGVsQ3RybC4kc2V0Vmlld1ZhbHVlKGRhdGVUZXh0KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgICAgICAgIGRhdGVGb3JtYXQ6IFwiZGQtbW0teXlcIixcbiAgICAgICAgICAgICAgICBkZWZhdWx0RGF0ZTogc2NvcGUuY29udmVydERhdGUoc2NvcGUudGFzay5pbmZvLmR1ZV9kYXRlKSxcbiAgICAgICAgICAgICAgICBvblNlbGVjdDogZnVuY3Rpb24gKGRhdGVUZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZU1vZGVsKGRhdGVUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2VsZWN0RGF0ZShzY29wZS5kdCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvbkNsb3NlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmRhdGVwaWNrZXJfb3BlbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBlbGVtLmRhdGVwaWNrZXIob3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICB9O1xufSlcblxuLmRpcmVjdGl2ZShcInNkYXRlcGlja2VyXCIsIGZ1bmN0aW9uICgpIHtcblxuICAgICd1c2Ugc3RyaWN0JztcbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogXCJBXCIsXG4gICAgICAgIHJlcXVpcmU6IFwibmdNb2RlbFwiLFxuICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW0sIGF0dHJzLCBuZ01vZGVsQ3RybCkge1xuXG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdhdHRycycsIGF0dHJzLnZhbHVlKTtcbiAgICAgICAgICAgIHZhciB1cGRhdGVNb2RlbCA9IGZ1bmN0aW9uIChkYXRlVGV4dCkge1xuICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIG5nTW9kZWxDdHJsLiRzZXRWaWV3VmFsdWUoZGF0ZVRleHQpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgZGF0ZUZvcm1hdDogXCJ5eS1tbS1kZFwiLFxuICAgICAgICAgICAgICAgIG9uU2VsZWN0OiBmdW5jdGlvbiAoZGF0ZVRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlTW9kZWwoZGF0ZVRleHQpO1xuICAgICAgICAgICAgICAgICAgICAvL3Njb3BlLnNlbGVjdERhdGUoc2NvcGUuZHQpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25DbG9zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5kYXRlcGlja2VyX29wZW4gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZWxlbS5kYXRlcGlja2VyKG9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgfTtcbn0pXG5cbi5kaXJlY3RpdmUoXCJiZGF0ZXBpY2tlclwiLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAndXNlIHN0cmljdCc7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6IFwiQVwiLFxuICAgICAgICByZXF1aXJlOiBcIm5nTW9kZWxcIixcbiAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtLCBhdHRycywgbmdNb2RlbEN0cmwpIHtcblxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnYXR0cnMnLCBhdHRycy52YWx1ZSk7XG4gICAgICAgICAgICB2YXIgdXBkYXRlTW9kZWwgPSBmdW5jdGlvbiAoZGF0ZVRleHQpIHtcbiAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBuZ01vZGVsQ3RybC4kc2V0Vmlld1ZhbHVlKGRhdGVUZXh0KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAgICAgICAgIGRhdGVGb3JtYXQ6IFwieXktbW0tZGRcIixcbiAgICAgICAgICAgICAgICBvblNlbGVjdDogZnVuY3Rpb24gKGRhdGVUZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZU1vZGVsKGRhdGVUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgLy9zY29wZS5zZWxlY3REYXRlKHNjb3BlLmR0KTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuZGF0ZXBpY2tlcl9vcGVuID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGVsZW0uZGF0ZXBpY2tlcihvcHRpb25zKTtcbiAgICAgICAgfVxuICAgIH07XG59KVxuXG4uZGlyZWN0aXZlKCdkYXRlcGlja2VyUG9wdXAnLCBmdW5jdGlvbiAoZGF0ZUZpbHRlciwgZGF0ZXBpY2tlclBvcHVwQ29uZmlnKSB7XG5cbiAgICAndXNlIHN0cmljdCc7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgcHJpb3JpdHk6IDEsXG4gICAgICAgIHJlcXVpcmU6ICduZ01vZGVsJyxcbiAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHIsIG5nTW9kZWwpIHtcbiAgICAgICAgICAgIHZhciBkYXRlRm9ybWF0ID0gYXR0ci5kYXRlcGlja2VyUG9wdXAgfHwgZGF0ZXBpY2tlclBvcHVwQ29uZmlnLmRhdGVwaWNrZXJQb3B1cDtcbiAgICAgICAgICAgIG5nTW9kZWwuJGZvcm1hdHRlcnMucHVzaChmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0ZUZpbHRlcih2YWx1ZSwgZGF0ZUZvcm1hdCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG59KVxuXG4uZGlyZWN0aXZlKFwidGltZUZvcm1hdFwiLCBmdW5jdGlvbigkZmlsdGVyKSB7XG5cbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIGFuZ3VsYXIgPSB3aW5kb3cuYW5ndWxhcjtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0IDogJ0EnLFxuICAgICAgICByZXF1aXJlIDogJ25nTW9kZWwnLFxuICAgICAgICBzY29wZSA6IHtcbiAgICAgICAgICAgIHNob3dNZXJpZGlhbiA6ICc9JyxcbiAgICAgICAgfSxcbiAgICAgICAgbGluayA6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycywgbmdNb2RlbCkge1xuXG4gICAgICAgICAgICB2YXIgcGFyc2VUaW1lID0gZnVuY3Rpb24odmlld1ZhbHVlKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoIXZpZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiRzZXRWYWxpZGl0eSgndGltZScsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFuZ3VsYXIuaXNEYXRlKHZpZXdWYWx1ZSkgJiYgIWlzTmFOKHZpZXdWYWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgbmdNb2RlbC4kc2V0VmFsaWRpdHkoJ3RpbWUnLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdWYWx1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFuZ3VsYXIuaXNTdHJpbmcodmlld1ZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdGltZVJlZ2V4ID0gL14oMD9bMC05XXwxWzAtMl0pOlswLTVdWzAtOV0gP1thfHBdbSQvaTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFzY29wZS5zaG93TWVyaWRpYW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVSZWdleCA9IC9eKFswMV0/WzAtOV18MlswLTNdKTpbMC01XVswLTldJC87XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aW1lUmVnZXgudGVzdCh2aWV3VmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiRzZXRWYWxpZGl0eSgndGltZScsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZ01vZGVsLiRzZXRWYWxpZGl0eSgndGltZScsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNwID0gdmlld1ZhbHVlLnNwbGl0KFwiOlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhcG0gPSBzcFsxXS5tYXRjaCgvW2F8cF1tL2kpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFwbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwWzFdID0gc3BbMV0ucmVwbGFjZSgvW2F8cF1tL2ksICcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXBtWzBdLnRvTG93ZXJDYXNlKCkgPT09ICdwbScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BbMF0gPSBzcFswXSArIDEyO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGUuc2V0SG91cnMoc3BbMF0sIHNwWzFdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkYXRlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgbmdNb2RlbC4kc2V0VmFsaWRpdHkoJ3RpbWUnLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgbmdNb2RlbC4kcGFyc2Vycy5wdXNoKHBhcnNlVGltZSk7XG5cbiAgICAgICAgICAgIHZhciBzaG93VGltZSA9IGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBwYXJzZVRpbWUoZGF0YSk7XG4gICAgICAgICAgICAgICAgdmFyIHRpbWVGb3JtYXQgPSAoIXNjb3BlLnNob3dNZXJpZGlhbikgPyBcIkhIOm1tXCIgOiBcImhoOm1tIGFcIjtcbiAgICAgICAgICAgICAgICByZXR1cm4gJGZpbHRlcignZGF0ZScpKGRhdGEsIHRpbWVGb3JtYXQpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIG5nTW9kZWwuJGZvcm1hdHRlcnMucHVzaChzaG93VGltZSk7XG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3Nob3dNZXJpZGlhbicsIGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdmFyIG15VGltZSA9IG5nTW9kZWwuJG1vZGVsVmFsdWU7XG4gICAgICAgICAgICAgICAgaWYgKG15VGltZSkge1xuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnZhbChzaG93VGltZShteVRpbWUpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbn0pXG5cbi5kaXJlY3RpdmUoJ3RpbWVwaWNrZXJQb3AnLCBmdW5jdGlvbigkZG9jdW1lbnQsIHRpbWVwaWNrZXJTdGF0ZSkge1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIHZhciBhbmd1bGFyID0gd2luZG93LmFuZ3VsYXI7XG5cbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdCA6ICdFJyxcbiAgICAgICAgdHJhbnNjbHVkZSA6IGZhbHNlLFxuICAgICAgICBzY29wZSA6IHtcbiAgICAgICAgICAgIGlucHV0VGltZSA6IFwiPVwiLFxuICAgICAgICAgICAgc2hvd01lcmlkaWFuIDogXCI9XCIsXG4gICAgICAgICAgICBkaXNhYmxlZCA6IFwiPVwiXG4gICAgICAgIH0sXG4gICAgICAgIGNvbnRyb2xsZXIgOiBmdW5jdGlvbigkc2NvcGUsICRlbGVtZW50KSB7XG5cbiAgICAgICAgICAgICRzY29wZS5pc09wZW4gPSBmYWxzZTtcbiAgICAgICAgICAgICRzY29wZS5kaXNhYmxlZEludCA9IGFuZ3VsYXIuaXNVbmRlZmluZWQoJHNjb3BlLmRpc2FibGVkKT8gZmFsc2UgOiAkc2NvcGUuZGlzYWJsZWQ7XG5cbiAgICAgICAgICAgICRzY29wZS50b2dnbGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiAoJHNjb3BlLmlzT3Blbikge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUub3BlbigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG4gICAgICAgIGxpbmsgOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcblxuICAgICAgICAgICAgdmFyIHBpY2tlciA9IHtcbiAgICAgICAgICAgICAgICBvcGVuIDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB0aW1lcGlja2VyU3RhdGUuY2xvc2VBbGwoKTtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNPcGVuID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNsb3NlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzT3BlbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRpbWVwaWNrZXJTdGF0ZS5hZGRQaWNrZXIocGlja2VyKTtcblxuICAgICAgICAgICAgc2NvcGUub3BlbiA9IHBpY2tlci5vcGVuO1xuICAgICAgICAgICAgc2NvcGUuY2xvc2UgPSBwaWNrZXIuY2xvc2U7XG5cbiAgICAgICAgICAgIHNjb3BlLiR3YXRjaChcImRpc2FibGVkXCIsIGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUuZGlzYWJsZWRJbnQgPSBhbmd1bGFyLmlzVW5kZWZpbmVkKHNjb3BlLmRpc2FibGVkKT8gZmFsc2UgOiBzY29wZS5kaXNhYmxlZDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzY29wZS4kd2F0Y2goXCJpbnB1dFRpbWVcIiwgZnVuY3Rpb24odmFsdWUpIHtcblxuICAgICAgICAgICAgICAgIGlmICghc2NvcGUuaW5wdXRUaW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoJ2hhcy1lcnJvcicpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlQ2xhc3MoJ2hhcy1lcnJvcicpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGVsZW1lbnQuYmluZCgnY2xpY2snLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJGRvY3VtZW50LmJpbmQoJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBzY29wZS4kYXBwbHkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzT3BlbiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfSxcbiAgICAgICAgdGVtcGxhdGUgOiBcIjxpbnB1dCB0eXBlPSd0ZXh0JyBjbGFzcz0nZm9ybS1jb250cm9sJyBuZy1tb2RlbD0naW5wdXRUaW1lJyBuZy1kaXNhYmxlZD0nZGlzYWJsZWRJbnQnIHRpbWUtZm9ybWF0IHNob3ctbWVyaWRpYW49J3Nob3dNZXJpZGlhbicgbmctZm9jdXM9J29wZW4oKScgLz5cIiArXG4gICAgICAgICAgICBcIiAgPGRpdiBuZy1jbGFzcz0ne29wZW46aXNPcGVufSc+IFwiICtcbiAgICAgICAgICAgIC8vXCIgICAgPGJ1dHRvbiB0eXBlPSdidXR0b24nIG5nLWRpc2FibGVkPSdkaXNhYmxlZEludCcgc3R5bGU9J2hlaWdodDozNHB4OycgY2xhc3M9J2J0biBidG4tZGVmYXVsdCAnIG5nLWNsYXNzPVxcXCJ7J2J0bi1wcmltYXJ5Jzppc09wZW59XFxcIiBkYXRhLXRvZ2dsZT0nZHJvcGRvd24nIG5nLWNsaWNrPSd0b2dnbGUoKSc+IFwiICtcbiAgICAgICAgICAgIC8vXCIgICAgICAgIDxpIGNsYXNzPSdnbHlwaGljb24gZ2x5cGhpY29uLXRpbWUnPjwvaT48L2J1dHRvbj4gXCIgK1xuICAgICAgICAgICAgXCIgICAgICAgICAgPGRpdiBjbGFzcz0nZHJvcGRvd24tbWVudSBwdWxsLXJpZ2h0Jz4gXCIgK1xuICAgICAgICAgICAgXCIgICAgICAgICAgICA8dGltZXBpY2tlciBuZy1tb2RlbD0naW5wdXRUaW1lJyBzaG93LW1lcmlkaWFuPSdzaG93TWVyaWRpYW4nPjwvdGltZXBpY2tlcj4gXCIgK1xuICAgICAgICAgICAgXCIgICAgICAgICAgIDwvZGl2PiBcIiArXG4gICAgICAgICAgICBcIiA8L2Rpdj5cIlxuICAgIH07XG59KTtcbiIsIndpbmRvdy5hbmd1bGFyLm1vZHVsZSgncHJvbW90ZXJzQXBwJykuZmFjdG9yeSgnZXZlbnRzU2VydmljZScsIFsnJHJlc291cmNlJywgJyRxJywgJyRodHRwJywgZnVuY3Rpb24oJHJlc291cmNlLCAkcSwgJGh0dHApe1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgcmV0dXJuIHtcblxuICAgICAgICBnZXRTZXJ2ZXJEYXRhOiBmdW5jdGlvbih1cmwpIHtcblxuICAgICAgICAgICAgLy8gTGUgcHJvbWlzZVxuICAgICAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgJGh0dHAuZ2V0KHVybClcbiAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhzdGF0dXMpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIHJldHVybiBwcm9taXNlXG4gICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcbiAgICAgICAgfSxcbiAgICAgICAgZGVsZXRlU2VydmVyRGF0YTogZnVuY3Rpb24odXJsKSB7XG5cbiAgICAgICAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICRodHRwLmRlbGV0ZSh1cmwpXG4gICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coc3RhdHVzKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcbiAgICAgICAgfSxcbiAgICAgICAgcG9zdFNlcnZlckRhdGE6IGZ1bmN0aW9uKHVybCwgcG9zdF9kYXRhKSB7XG5cbiAgICAgICAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICRodHRwLnBvc3QodXJsLCBwb3N0X2RhdGEpXG4gICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coc3RhdHVzKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0VGVtcGxhdGU6IGZ1bmN0aW9uKHR5cGUpIHtcblxuICAgICAgICB9XG4gICAgfTtcbn1dKVxuXG4uZmFjdG9yeSgndGltZXBpY2tlclN0YXRlJywgZnVuY3Rpb24oKSB7XG5cbiAgICAndXNlIHN0cmljdCc7XG4gICAgdmFyIHBpY2tlcnMgPSBbXTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIGFkZFBpY2tlcjogZnVuY3Rpb24ocGlja2VyKSB7XG4gICAgICAgICAgICBwaWNrZXJzLnB1c2gocGlja2VyKTtcbiAgICAgICAgfSxcbiAgICAgICAgY2xvc2VBbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZm9yICh2YXIgaT0wOyBpPHBpY2tlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBwaWNrZXJzW2ldLmNsb3NlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xufSk7XG5cbiIsIndpbmRvdy5hbmd1bGFyLm1vZHVsZSgncHJvbW90ZXJzQXBwJykuZmlsdGVyKCdyZXZlcnNlJywgZnVuY3Rpb24oKSB7XG5cblx0J3VzZSBzdHJpY3QnO1xuXHRcbiAgICByZXR1cm4gZnVuY3Rpb24oaXRlbXMpIHtcbiAgICAgICAgcmV0dXJuIChpdGVtcyAmJiBpdGVtcy5sZW5ndGggPiAwID8gaXRlbXMuc2xpY2UoKS5yZXZlcnNlKCkgOiBpdGVtcyk7XG4gICAgfTtcbn0pOyIsIi8vIGFwcC5qc1xuXG4oZnVuY3Rpb24gKGFuZ3VsYXIpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAvLyBjcmVhdGUgb3VyIGFuZ3VsYXIgYXBwIGFuZCBpbmplY3QgbmdBbmltYXRlIGFuZCB1aS1yb3V0ZXJcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAgIHZhciBwcm9tb3Rlcl9yZWdpc3RyYXRpb25fYXBwID0gYW5ndWxhci5tb2R1bGUoJ3Byb21vdGVyc1JlZ2lzdHJhdGlvbkFwcCcsIFsnbmdBbmltYXRlJywgJ25nUmVzb3VyY2UnLCAndWkucm91dGVyJ10pO1xuXG4gICAgcHJvbW90ZXJfcmVnaXN0cmF0aW9uX2FwcC5mYWN0b3J5KCdldmVudHNTZXJ2aWNlJywgWyckcmVzb3VyY2UnLCAnJHEnLCAnJGh0dHAnLCBmdW5jdGlvbiAoJHJlc291cmNlLCAkcSwgJGh0dHApe1xuXG4gICAgICAgIC8vdmFyIHByb21vdGVyX2V2ZW50cztcbiAgICAgICAgcmV0dXJuIHtcblxuICAgICAgICAgICAgZ2V0U2VydmVyRGF0YTogZnVuY3Rpb24odXJsKSB7XG5cbiAgICAgICAgICAgICAgICAvLyBMZSBwcm9taXNlXG4gICAgICAgICAgICAgICAgdmFyIGRlZmVyID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgICAgICRodHRwLmdldCh1cmwpXG4gICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVyLnJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgfSkuZXJyb3IoZnVuY3Rpb24gKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHN0YXR1cyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyByZXR1cm4gcHJvbWlzZVxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlci5wcm9taXNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRlbGV0ZVNlcnZlckRhdGE6IGZ1bmN0aW9uKHVybCkge1xuXG4gICAgICAgICAgICAgICAgLy8gTGUgcHJvbWlzZVxuICAgICAgICAgICAgICAgIHZhciBkZWZlciA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgICAgICAkaHR0cC5kZWxldGUodXJsKVxuICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgICAgICAgICBkZWZlci5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pLmVycm9yKGZ1bmN0aW9uIChkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhzdGF0dXMpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gcmV0dXJuIHByb21pc2VcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXIucHJvbWlzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwb3N0U2VydmVyRGF0YTogZnVuY3Rpb24odXJsLCBwb3N0X2RhdGEpIHtcblxuICAgICAgICAgICAgICAgIC8vIExlIHByb21pc2VcbiAgICAgICAgICAgICAgICB2YXIgZGVmZXIgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCh1cmwsIHBvc3RfZGF0YSlcbiAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXIucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KS5lcnJvcihmdW5jdGlvbiAoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coc3RhdHVzKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIHJldHVybiBwcm9taXNlXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVyLnByb21pc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfV0pO1xuXG4gICAgLy8gY29uZmlndXJpbmcgb3VyIHJvdXRlc1xuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgcHJvbW90ZXJfcmVnaXN0cmF0aW9uX2FwcC5jb25maWcoZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xuXG4gICAgICAgICRzdGF0ZVByb3ZpZGVyXG5cbiAgICAgICAgICAgIC8vIHJvdXRlIHRvIHNob3cgb3VyIGJhc2ljIGZvcm0gKC9mb3JtKVxuICAgICAgICAgICAgLnN0YXRlKCdmb3JtJywge1xuICAgICAgICAgICAgICAgIHVybDogJy9zdGVwJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2Zvcm0uaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1Byb21vdGVyUmVnaXN0cmF0aW9uQ29udHJvbGxlcidcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIC8vIG5lc3RlZCBzdGF0ZXNcbiAgICAgICAgICAgIC8vIGVhY2ggb2YgdGhlc2Ugc2VjdGlvbnMgd2lsbCBoYXZlIHRoZWlyIG93biB2aWV3XG4gICAgICAgICAgICAvLyB1cmwgd2lsbCBiZSBuZXN0ZWQgKC9mb3JtL3Byb2ZpbGUpXG4gICAgICAgICAgICAuc3RhdGUoJ2Zvcm0uY29tcGFueV9kZXRhaWxzJywge1xuICAgICAgICAgICAgICAgIHVybDogJy9jb21wYW55JyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2NvbXBhbnkuaHRtbCcsXG4gICAgICAgICAgICAgICAgZGF0YTogeyBuZHg6IDAgfVxuICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgLnN0YXRlKCdmb3JtLnBlcnNvbmFsX2RldGFpbHMnLCB7XG4gICAgICAgICAgICAgICAgdXJsOiAnL3BlcnNvbmFsJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3BlcnNvbmFsLmh0bWwnLFxuICAgICAgICAgICAgICAgIGRhdGE6IHsgbmR4OiAxIH1cbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIC8vIHVybCB3aWxsIGJlIC9mb3JtL3BheW1lbnRcbiAgICAgICAgICAgIC5zdGF0ZSgnZm9ybS5vdmVydmlldycsIHtcbiAgICAgICAgICAgICAgICB1cmw6ICcvb3ZlcnZpZXcnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnb3ZlcnZpZXcuaHRtbCcsXG4gICAgICAgICAgICAgICAgZGF0YTogeyBuZHg6IDIgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gY2F0Y2ggYWxsIHJvdXRlXG4gICAgICAgIC8vIHNlbmQgdXNlcnMgdG8gdGhlIGZvcm0gcGFnZVxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvc3RlcC9jb21wYW55Jyk7XG4gICAgfSlcblxuICAgIC8vIG91ciBjb250cm9sbGVyIGZvciB0aGUgZm9ybVxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgLmNvbnRyb2xsZXIoJ1Byb21vdGVyUmVnaXN0cmF0aW9uQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRzdGF0ZScsICckbG9nJywgJ2V2ZW50c1NlcnZpY2UnLCBmdW5jdGlvbiAoJHNjb3BlLCAkc3RhdGUsICRsb2csIGV2ZW50c1NlcnZpY2UpIHtcblxuICAgICAgICAvLyB3ZSB3aWxsIHN0b3JlIGFsbCBvZiBvdXIgZm9ybSBkYXRhIGluIHRoaXMgb2JqZWN0XG5cbiAgICAgICAgJHNjb3BlLiRsb2cgPSAkbG9nO1xuXG4gICAgICAgICRzY29wZS5jb21wYW55RGF0YSA9IHt9O1xuICAgICAgICAkc2NvcGUucGVyc29uYWxEYXRhID0ge307XG4gICAgICAgICRzY29wZS5hZGRyZXNzRGF0YSA9IHt9O1xuXG4gICAgICAgICRzY29wZS5jb3VudHJpZXMgPSB1bmRlZmluZWQ7XG4gICAgICAgIGV2ZW50c1NlcnZpY2UuZ2V0U2VydmVyRGF0YSgnL2FwaS92MS9jb3VudHJpZXMnKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICRzY29wZS5jb3VudHJpZXMgPSBkYXRhO1xuXG4gICAgICAgICAgICB2YXIgJGxpX2VsID0gJChcIiNwcm9ncmVzc2JhciBsaVwiKTtcbiAgICAgICAgICAgICRsaV9lbC5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgIGZvcih2YXIgY3Vycl9uZHggPSAwOyBjdXJyX25keCA8PSAkc3RhdGUuY3VycmVudC5kYXRhLm5keDsgY3Vycl9uZHgrKyl7XG4gICAgICAgICAgICAgICAgaWYoISRsaV9lbC5lcShjdXJyX25keCkuaGFzQ2xhc3MoXCJhY3RpdmVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgJGxpX2VsLmVxKGN1cnJfbmR4KS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRzY29wZS5nZXRSZWdpc3RyYXRpb25JbmZvID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIGV2ZW50c1NlcnZpY2UuZ2V0U2VydmVyRGF0YSgnL3JlZ2lzdHJhdGlvbi9jb21wYW55JykudGhlbihmdW5jdGlvbihkYXRhKSB7XG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcblxuICAgICAgICAgICAgICAgICRzY29wZS5jb21wYW55RGF0YS5jb21wYW55X25hbWUgPSBkYXRhLnVzZXJfY29tcGFueS5uYW1lO1xuICAgICAgICAgICAgICAgICRzY29wZS5jb21wYW55RGF0YS5jb21wYW55X3R5cGUgPSBkYXRhLnVzZXJfY29tcGFueS50eXBlO1xuICAgICAgICAgICAgICAgICRzY29wZS5jb21wYW55RGF0YS5jb21wYW55X2JhbmtfZGV0YWlscyA9IGRhdGEudXNlcl9jb21wYW55LmJhbmtfZGV0YWlscztcbiAgICAgICAgICAgICAgICAkc2NvcGUuY29tcGFueURhdGEuY29tcGFueV90YXhfbnVtYmVyID0gZGF0YS51c2VyX2NvbXBhbnkudGF4X251bWJlcjtcbiAgICAgICAgICAgICAgICAkc2NvcGUuY29tcGFueURhdGEubm90ZXMgPSBkYXRhLnVzZXJfY29tcGFueS5ub3RlcztcblxuICAgICAgICAgICAgICAgICRzY29wZS5hZGRyZXNzRGF0YS5jb3VudHJ5X2lkID0gZGF0YS5jb21wYW55X2FkZHJlc3MuY291bnRyeV9pZDtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWRkcmVzc0RhdGEuYWRkcmVzcyA9IGRhdGEuY29tcGFueV9hZGRyZXNzLmFkZHJlc3M7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmFkZHJlc3NEYXRhLnBvc3RfY29kZSA9IGRhdGEuY29tcGFueV9hZGRyZXNzLnBvc3RhbF9jb2RlO1xuICAgICAgICAgICAgICAgICRzY29wZS5hZGRyZXNzRGF0YS5jaXR5ID0gZGF0YS5jb21wYW55X2FkZHJlc3MuY2l0eTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWRkcmVzc0RhdGEuc3RhdGVfcHJvdmluY2UgPSBkYXRhLmNvbXBhbnlfYWRkcmVzcy5zdGF0ZV9wcm92aW5jZTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWRkcmVzc0RhdGEucGhvbmUgPSBkYXRhLmNvbXBhbnlfYWRkcmVzcy5waG9uZTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuYWRkcmVzc0RhdGEuZmF4ID0gZGF0YS5jb21wYW55X2FkZHJlc3MuZmF4O1xuICAgICAgICAgICAgICAgICRzY29wZS5hZGRyZXNzRGF0YS53ZWJzaXRlID0gZGF0YS5jb21wYW55X2FkZHJlc3Mud2Vic2l0ZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBldmVudHNTZXJ2aWNlLmdldFNlcnZlckRhdGEoJy9yZWdpc3RyYXRpb24vcGVyc29uYWwnKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUucGVyc29uYWxEYXRhLnBlcnNvbmFsX3Bob25lID0gZGF0YS5wZXJzb25hbF9waG9uZTtcbiAgICAgICAgICAgICAgICAkc2NvcGUucGVyc29uYWxEYXRhLmVtYWlsID0gZGF0YS5lbWFpbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICAkc2NvcGUuZ2V0UmVnaXN0cmF0aW9uSW5mbygpO1xuXG5cbiAgICAgICAgJHNjb3BlLnJlZ2lzdHJhdGlvblN1Ym1pc3Npb24gPSBmdW5jdGlvbih0eXBlLCBzdGF0ZSkge1xuXG4gICAgICAgICAgICAvLyB0eXBlIGlzIHdoYXQgd2UgYXJlIHN1Ym1pdHRpbmcsIHN0YXRlIGlzIHdoZXJlIHdlIGFyZSBnb2luZ1xuICAgICAgICAgICAgdmFyIHBvc3RfdXJsLCBwb3N0X2RhdGE7XG4gICAgICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInByb21vdGVyc1JlZ2lzdHJhdGlvblJvb3RcIik7XG4gICAgICAgICAgICB2YXIgdG9rZW5fc3RyID0gYW5ndWxhci5lbGVtZW50KGVsKS5kYXRhKCd0b2tlbicpO1xuXG4gICAgICAgICAgICB2YXIgbmR4O1xuICAgICAgICAgICAgc3dpdGNoKHR5cGUpIHtcblxuICAgICAgICAgICAgICAgIGNhc2UgJ3BlcnNvbmFsJzpcbiAgICAgICAgICAgICAgICAgICAgcG9zdF91cmwgPSBcIi9yZWdpc3RyYXRpb24vcGVyc29uYWxcIjtcbiAgICAgICAgICAgICAgICAgICAgcG9zdF9kYXRhID0gYW5ndWxhci5leHRlbmQoe30sIHtfdG9rZW46IHRva2VuX3N0cn0sICRzY29wZS5wZXJzb25hbERhdGEpO1xuICAgICAgICAgICAgICAgICAgICBuZHggPSAyO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdjb21wYW55JzpcbiAgICAgICAgICAgICAgICAgICAgcG9zdF91cmwgPSBcIi9yZWdpc3RyYXRpb24vY29tcGFueVwiO1xuICAgICAgICAgICAgICAgICAgICBwb3N0X2RhdGEgPSBhbmd1bGFyLmV4dGVuZCh7fSwge190b2tlbjogdG9rZW5fc3RyfSwgJHNjb3BlLmNvbXBhbnlEYXRhLCAkc2NvcGUuYWRkcmVzc0RhdGEpO1xuICAgICAgICAgICAgICAgICAgICBuZHggPSAxO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZXZlbnRzU2VydmljZS5wb3N0U2VydmVyRGF0YShwb3N0X3VybCwgcG9zdF9kYXRhKS50aGVuKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncG9zdGVkICcrdHlwZSsnIHRvICcrcG9zdF91cmwsIHBvc3RfZGF0YSwgZGF0YSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdmFyICRsaV9lbCA9ICQoXCIjcHJvZ3Jlc3NiYXIgbGlcIik7XG4gICAgICAgICAgICBmb3IodmFyIGN1cnJfbmR4ID0gMDsgY3Vycl9uZHggPD0gbmR4OyBjdXJyX25keCsrKSB7XG4gICAgICAgICAgICAgICAgaWYoISRsaV9lbC5lcShjdXJyX25keCkuaGFzQ2xhc3MoXCJhY3RpdmVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgJGxpX2VsLmVxKGN1cnJfbmR4KS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGlmIHZhbGlkYXRpb24gb2sgZ28gdG8gbmV4dFxuICAgICAgICAgICAgJHN0YXRlLmdvKHN0YXRlKTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuZ29CYWNrID0gZnVuY3Rpb24odHlwZSwgc3RhdGUpIHtcblxuICAgICAgICAgICAgdmFyIG5keDtcbiAgICAgICAgICAgIHN3aXRjaCh0eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnb3ZlcnZpZXcnOlxuICAgICAgICAgICAgICAgICAgICBuZHggPSAyO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdwZXJzb25hbCc6XG4gICAgICAgICAgICAgICAgICAgIG5keCA9IDE7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgJ2NvbXBhbnknOlxuICAgICAgICAgICAgICAgICAgICBuZHggPSAwO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc29sZS5sb2codHlwZSwgbmR4KTtcblxuICAgICAgICAgICAgLy8gb3ZlcnZpZXcgaXMgbWF4IGF0bSA9IDRcbiAgICAgICAgICAgIGlmKG5keCA8IDQgJiYgbmR4ID4gMCkge1xuXG4gICAgICAgICAgICAgICAgJChcIiNwcm9ncmVzc2JhciBsaVwiKS5lcShuZHgpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuXG4gICAgICAgICAgICAgICAgLy8gaWYgdmFsaWRhdGlvbiBvayBnbyB0byBuZXh0XG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKHN0YXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgIH1dKTtcbn0od2luZG93LmFuZ3VsYXIpKTtcbiJdfQ==
